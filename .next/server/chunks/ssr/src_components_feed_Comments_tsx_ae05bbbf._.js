module.exports=[99828,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(46271),e=a.i(62036),f=a.i(38246),g=a.i(45222),h=a.i(5784),i=a.i(67552),j=a.i(92759),k=a.i(96221),l=a.i(33508);let m=(0,a.i(70106).default)("CornerDownRight",[["polyline",{points:"15 10 20 15 15 20",key:"1q7qjw"}],["path",{d:"M4 4v7a4 4 0 0 0 4 4h12",key:"z08zvw"}]]);var n=a.i(94632),o=a.i(13434),p=a.i(12469),q=a.i(3512);function r({comment:a,postId:g,depth:j,highlightId:l,onReply:s}){let{user:t}=(0,q.useAuth)(),[u,v]=(0,c.useState)(a.isLiked),[w,x]=(0,c.useState)(a.likesCount),[y,z]=(0,c.useState)(j<2),[A,B]=(0,c.useState)([]),[C,D]=(0,c.useState)(!1),[E,F]=(0,c.useState)(a.replyCount>0),[G,H]=(0,c.useState)(a.replyCount),I=(0,c.useRef)(null),J=l===a.id;(0,c.useEffect)(()=>{v(a.isLiked),x(a.likesCount)},[a.isLiked,a.likesCount]),(0,c.useEffect)(()=>{let b=(0,p.getSocket)(),c=b=>{b.comment&&b.postId===g&&b.comment.parentId===a.id&&(B(a=>a.some(a=>a.id===b.comment.id)?a:[b.comment,...a]),H(a=>a+1),F(!0))},d=b=>{b.commentId===a.id&&(x(b.likesCount),b.userId===t?.id&&v(b.liked)),B(a=>a.map(a=>a.id===b.commentId?{...a,likesCount:b.likesCount,isLiked:b.userId===t?.id?b.liked:a.isLiked}:a))};return b?.on("comment:created",c),b?.on("comment:liked",d),()=>{b?.off("comment:created",c),b?.off("comment:liked",d)}},[g,a.id,t?.id]),(0,c.useEffect)(()=>{J&&I.current&&I.current.scrollIntoView({behavior:"smooth",block:"center"})},[J]);let K=async()=>{if(!C&&!(A.length>=a.replyCount)){D(!0);try{let b=await (0,o.getComments)(g,a.id,1,10);B(b.comments),F(b.hasMore)}catch(a){console.error("Error loading replies:",a)}finally{D(!1)}}},L=async()=>{let b=!u;v(b),x(a=>b?a+1:a-1);try{let b=await (0,o.toggleCommentLike)(g,a.id);b&&(v(b.liked),x(b.likesCount))}catch(a){v(!b),x(w)}};return(0,b.jsx)("div",{ref:I,className:`${j>0?"ml-8 border-l-2 border-gray-100 dark:border-neutral-800 pl-4":""}`,children:(0,b.jsxs)(d.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`py-3 transition-colors ${J?"bg-yellow-50 dark:bg-yellow-900/20 -mx-2 px-2 rounded-lg":""}`,children:[(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)(f.default,{href:`/profile/${a.author.username}`,className:"flex-shrink-0",children:(0,b.jsx)("div",{className:"w-8 h-8 rounded-full overflow-hidden bg-gray-200 dark:bg-neutral-700",children:a.author.profileImage?(0,b.jsx)("img",{src:a.author.profileImage,alt:a.author.name,className:"w-full h-full object-cover"}):(0,b.jsx)("div",{className:"w-full h-full flex items-center justify-center text-sm font-bold text-gray-500",children:a.author.name.charAt(0).toUpperCase()})})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"bg-gray-100 dark:bg-neutral-800 rounded-2xl px-4 py-2",children:[(0,b.jsx)(f.default,{href:`/profile/${a.author.username}`,className:"font-semibold text-sm text-gray-900 dark:text-white hover:underline",children:a.author.name}),(0,b.jsx)("p",{className:"text-sm text-gray-700 dark:text-neutral-300 whitespace-pre-wrap",children:a.content.split(/(@\w+)/g).map((a,c)=>a.startsWith("@")?(0,b.jsx)(f.default,{href:`/profile/${a.slice(1)}`,className:"text-blue-600 dark:text-blue-400 hover:underline",children:a},c):(0,b.jsx)("span",{children:a},c))})]}),(0,b.jsxs)("div",{className:"flex items-center gap-4 mt-1 ml-2 text-xs",children:[(0,b.jsx)("span",{className:"text-gray-500 dark:text-neutral-500",children:(0,n.formatDistanceToNow)(new Date(a.createdAt),{addSuffix:!0})}),(0,b.jsxs)("button",{onClick:L,className:`font-semibold transition-colors ${u?"text-red-500":"text-gray-500 dark:text-neutral-400 hover:text-gray-700 dark:hover:text-neutral-300"}`,children:["Like",w>0&&` (${w})`]}),(0,b.jsx)("button",{onClick:()=>s(a.id,a.author.username),className:"font-semibold text-gray-500 dark:text-neutral-400 hover:text-gray-700 dark:hover:text-neutral-300 transition-colors",children:"Reply"})]}),G>0&&(0,b.jsxs)("button",{onClick:()=>{z(!y),y||0!==A.length||K()},className:"flex items-center gap-1 mt-2 ml-2 text-xs font-semibold text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300",children:[(0,b.jsx)(m,{className:"w-3 h-3"}),y?"Hide":"View"," ",G," ",1===G?"reply":"replies",y?(0,b.jsx)(i.ChevronUp,{className:"w-3 h-3"}):(0,b.jsx)(h.ChevronDown,{className:"w-3 h-3"})]})]})]}),(0,b.jsx)(e.AnimatePresence,{children:y&&(0,b.jsxs)(d.motion.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mt-2",children:[C&&0===A.length?(0,b.jsx)("div",{className:"flex justify-center py-4",children:(0,b.jsx)(k.Loader2,{className:"w-5 h-5 animate-spin text-gray-400"})}):A.map(a=>(0,b.jsx)(r,{comment:a,postId:g,depth:j+1,highlightId:l,onReply:s},a.id)),E&&A.length>0&&(0,b.jsx)("button",{onClick:K,disabled:C,className:"ml-8 mt-2 text-xs font-semibold text-blue-600 dark:text-blue-400 hover:text-blue-700",children:C?(0,b.jsx)(k.Loader2,{className:"w-4 h-4 animate-spin"}):"Load more replies"})]})})]})})}function s({postId:a,isOpen:f,onClose:h,highlightCommentId:i,onCommentCountChange:m}){let{user:n}=(0,q.useAuth)(),[s,t]=(0,c.useState)([]),[u,v]=(0,c.useState)(!0),[w,x]=(0,c.useState)(!1),[y,z]=(0,c.useState)(1),[A,B]=(0,c.useState)(!1),[C,D]=(0,c.useState)(null),[E,F]=(0,c.useState)(""),[G,H]=(0,c.useState)(!1),[I,J]=(0,c.useState)(""),[K,L]=(0,c.useState)([]),[M,N]=(0,c.useState)(!1),[O,P]=(0,c.useState)([]),Q=(0,c.useRef)(null),R=(0,c.useRef)(null);(0,c.useEffect)(()=>{if(f){(0,p.joinPostRoom)(a);let b=(0,p.getSocket)(),c=b=>{b.postId!==a||("number"==typeof b.commentsCount&&m?.(b.commentsCount),b.comment&&t(a=>{let c=a.some(a=>a.id===b.comment.id),d=a.some(a=>a.id.startsWith("temp-"));return c?a:d?a.map(a=>a.id.startsWith("temp-")?b.comment:a):b.comment.parentId?a:[b.comment,...a]}))},d=a=>{t(b=>b.map(b=>b.id===a.commentId?{...b,likesCount:a.likesCount,isLiked:a.userId===n?.id?a.liked:b.isLiked}:b))};return b?.on("comment:created",c),b?.on("comment:liked",d),()=>{(0,p.leavePostRoom)(a),b?.off("comment:created",c),b?.off("comment:liked",d)}}},[f,a,n?.id,m]),(0,c.useEffect)(()=>{f&&(async()=>{v(!0);try{let b=await (0,o.getComments)(a,void 0,1,20);t(b.comments),x(b.hasMore),z(1)}catch(a){console.error("Error fetching comments:",a)}finally{v(!1)}})()},[f,a]);let S=async()=>{if(!A&&w){B(!0);try{let b=y+1,c=await (0,o.getComments)(a,void 0,b,20);t(a=>[...a,...c.comments]),x(c.hasMore),z(b)}catch(a){console.error("Error loading more comments:",a)}finally{B(!1)}}},T=(a,b)=>{D({id:a,username:b}),F(`@${b} `),P([]),Q.current?.focus()},U=(0,c.useCallback)(async a=>{if(a.length<2){L([]),N(!1);return}try{let b=await (0,o.searchUsersForMention)(a);L(b),N(b.length>0)}catch(a){console.error("Error searching mentions:",a)}},[]),V=async()=>{if(E.trim()&&!G){H(!0);try{let b=await (0,o.createComment)(a,E.trim(),C?.id,O);t(a=>C?a.map(a=>a.id===C.id?{...a,replyCount:(a.replyCount||0)+1}:a):a.some(a=>a.id===b.id)?a:[b,...a]),m?.(s.length+1),F(""),P([]),D(null)}catch(a){console.error("Error creating comment:",a)}finally{H(!1)}}};return f?(0,b.jsx)(e.AnimatePresence,{children:(0,b.jsxs)(d.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-end sm:items-center justify-center",onClick:h,children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-black/50"}),(0,b.jsxs)(d.motion.div,{initial:{y:"100%"},animate:{y:0},exit:{y:"100%"},transition:{type:"spring",damping:25,stiffness:300},onClick:a=>a.stopPropagation(),className:"relative w-full sm:max-w-xl h-[80vh] sm:h-[70vh] sm:rounded-t-2xl sm:rounded-b-2xl bg-white dark:bg-neutral-900 flex flex-col",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-neutral-800",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Comments"}),(0,b.jsx)("button",{onClick:h,className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-neutral-800 transition-colors",children:(0,b.jsx)(l.X,{className:"w-5 h-5 text-gray-500"})})]}),(0,b.jsx)("div",{ref:R,className:"flex-1 overflow-y-auto p-4",children:u?(0,b.jsx)("div",{className:"flex justify-center py-8",children:(0,b.jsx)(k.Loader2,{className:"w-8 h-8 animate-spin text-gray-400"})}):0===s.length?(0,b.jsxs)("div",{className:"text-center py-8",children:[(0,b.jsx)(g.MessageCircle,{className:"w-12 h-12 mx-auto text-gray-300 dark:text-neutral-600 mb-2"}),(0,b.jsx)("p",{className:"text-gray-500 dark:text-neutral-400",children:"No comments yet"}),(0,b.jsx)("p",{className:"text-sm text-gray-400 dark:text-neutral-500",children:"Be the first to comment!"})]}):(0,b.jsxs)(b.Fragment,{children:[s.map(c=>(0,b.jsx)(r,{comment:c,postId:a,depth:0,highlightId:i,onReply:T},c.id)),w&&(0,b.jsx)("button",{onClick:S,disabled:A,className:"w-full py-3 text-sm font-semibold text-blue-600 dark:text-blue-400 hover:text-blue-700 transition-colors",children:A?(0,b.jsx)(k.Loader2,{className:"w-5 h-5 animate-spin mx-auto"}):"Load more comments"})]})}),C&&(0,b.jsxs)("div",{className:"px-4 py-2 bg-gray-50 dark:bg-neutral-800/50 border-t border-gray-200 dark:border-neutral-800 flex items-center justify-between",children:[(0,b.jsxs)("span",{className:"text-sm text-gray-500 dark:text-neutral-400",children:["Replying to ",(0,b.jsxs)("span",{className:"font-semibold text-gray-700 dark:text-neutral-300",children:["@",C.username]})]}),(0,b.jsx)("button",{onClick:()=>{D(null),F(""),P([])},className:"text-gray-400 hover:text-gray-600",children:(0,b.jsx)(l.X,{className:"w-4 h-4"})})]}),(0,b.jsx)("div",{className:"p-4 border-t border-gray-200 dark:border-neutral-800",children:(0,b.jsxs)("div",{className:"relative",children:[M&&(0,b.jsx)("div",{className:"absolute bottom-full left-0 right-0 mb-2 max-h-40 overflow-y-auto bg-white dark:bg-neutral-800 border border-gray-200 dark:border-neutral-700 rounded-lg shadow-lg z-10",children:K.map(a=>(0,b.jsxs)("button",{onClick:()=>{let b;return b=E.lastIndexOf("@"),void(F(E.slice(0,b)+`@${a.username} `),P([...O,a.id]),N(!1),Q.current?.focus())},className:"flex items-center gap-2 w-full px-4 py-2 hover:bg-gray-100 dark:hover:bg-neutral-700 transition-colors",children:[(0,b.jsx)("div",{className:"w-8 h-8 rounded-full overflow-hidden bg-gray-200 dark:bg-neutral-600",children:a.profileImage&&(0,b.jsx)("img",{src:a.profileImage,alt:"",className:"w-full h-full object-cover"})}),(0,b.jsxs)("div",{className:"text-left",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:a.name}),(0,b.jsxs)("p",{className:"text-xs text-gray-500",children:["@",a.username]})]})]},a.id))}),(0,b.jsxs)("div",{className:"flex items-end gap-2",children:[(0,b.jsx)("div",{className:"w-8 h-8 rounded-full overflow-hidden bg-gray-200 dark:bg-neutral-700 flex-shrink-0",children:n?.profileImage?(0,b.jsx)("img",{src:n.profileImage,alt:"",className:"w-full h-full object-cover"}):(0,b.jsx)("div",{className:"w-full h-full flex items-center justify-center text-sm font-bold text-gray-500",children:n?.name?.charAt(0).toUpperCase()})}),(0,b.jsx)("textarea",{ref:Q,value:E,onChange:a=>{let b=a.target.value;F(b);let c=b.lastIndexOf("@");if(-1!==c){let a=b.slice(c+1),d=-1===a.indexOf(" ")?a:"";d?(J(d),U(d)):N(!1)}else N(!1)},onKeyDown:a=>{"Enter"!==a.key||a.shiftKey||(a.preventDefault(),V())},placeholder:"Write a comment...",rows:1,className:"flex-1 px-4 py-2 rounded-full bg-gray-100 dark:bg-neutral-800 text-gray-900 dark:text-white placeholder-gray-500 resize-none outline-none focus:ring-2 focus:ring-blue-500 max-h-24",style:{minHeight:"40px"}}),(0,b.jsx)("button",{onClick:V,disabled:!E.trim()||G,className:"p-2 rounded-full bg-blue-500 text-white disabled:opacity-50 disabled:cursor-not-allowed hover:bg-blue-600 transition-colors",children:G?(0,b.jsx)(k.Loader2,{className:"w-5 h-5 animate-spin"}):(0,b.jsx)(j.Send,{className:"w-5 h-5"})})]})]})})]})]})}):null}a.s(["Comments",()=>s],99828)}];

//# sourceMappingURL=src_components_feed_Comments_tsx_ae05bbbf._.js.map