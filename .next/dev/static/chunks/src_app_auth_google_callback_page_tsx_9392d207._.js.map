{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/yasmanth/Pictures/vormex/vormex-web/src/app/auth/google/callback/page.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useState, Suspense } from 'react';\nimport { useRouter, useSearchParams } from 'next/navigation';\nimport { authAPI } from '@/lib/api/auth';\nimport { useAuthContext } from '@/lib/auth/authContext';\nimport { handleApiError } from '@/lib/utils/errorHandler';\nimport '../../../login/login.css';\n\nfunction GoogleCallbackContent() {\n  const router = useRouter();\n  const searchParams = useSearchParams();\n  const { setAuth } = useAuthContext();\n  const [error, setError] = useState<string | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n\n  useEffect(() => {\n    const handleCallback = async () => {\n      try {\n        // Get authorization code and state from URL\n        const code = searchParams.get('code');\n        const state = searchParams.get('state');\n        const errorParam = searchParams.get('error');\n\n        // Check for OAuth errors\n        if (errorParam) {\n          setError(`Google OAuth error: ${errorParam}`);\n          setIsLoading(false);\n          setTimeout(() => router.push('/login'), 3000);\n          return;\n        }\n\n        // Validate state (CSRF protection)\n        const storedState = sessionStorage.getItem('oauth_state');\n        if (!state || state !== storedState) {\n        setError('Invalid state parameter. Please try again.');\n        setIsLoading(false);\n        sessionStorage.removeItem('oauth_state');\n        sessionStorage.removeItem('oauth_code_verifier');\n        setTimeout(() => router.push('/login'), 3000);\n        return;\n      }\n\n      if (!code) {\n        setError('Authorization code not found. Please try again.');\n        setIsLoading(false);\n        sessionStorage.removeItem('oauth_state');\n        sessionStorage.removeItem('oauth_code_verifier');\n        setTimeout(() => router.push('/login'), 3000);\n        return;\n      }\n\n        // Exchange authorization code for tokens using PKCE via our API route\n        const redirectUri = `${window.location.origin}/auth/google/callback`;\n        const codeVerifier = sessionStorage.getItem('oauth_code_verifier');\n        \n        if (!codeVerifier) {\n          throw new Error('Code verifier not found. Please try signing in again.');\n        }\n\n        // Use our API route to exchange code for tokens (server-side, secure)\n        const tokenResponse = await fetch('/api/auth/google/callback', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify({\n            code: code,\n            codeVerifier: codeVerifier,\n            redirectUri: redirectUri,\n          }),\n        });\n\n        if (!tokenResponse.ok) {\n          const errorData = await tokenResponse.json().catch(() => ({}));\n          throw new Error(errorData.error || errorData.error_description || 'Failed to exchange authorization code');\n        }\n\n        const tokenData = await tokenResponse.json();\n\n        // Extract id_token from the response\n        const idToken = tokenData.idToken;\n\n        if (!idToken) {\n          throw new Error('ID token not found in token response');\n        }\n\n        // Send id_token to backend\n        const authResponse = await authAPI.googleSignIn(idToken);\n\n        // Update auth context with the response\n        setAuth(authResponse);\n\n        // Clean up\n        sessionStorage.removeItem('oauth_state');\n        sessionStorage.removeItem('oauth_code_verifier');\n\n        // Redirect to home\n        router.push('/');\n      } catch (err) {\n        console.error('Google OAuth callback error:', err);\n        setError(handleApiError(err));\n        setIsLoading(false);\n        sessionStorage.removeItem('oauth_state');\n        sessionStorage.removeItem('oauth_code_verifier');\n        setTimeout(() => router.push('/login'), 3000);\n      }\n    };\n\n    handleCallback();\n  }, [searchParams, router, setAuth]);\n\n  return (\n    <div className=\"auth-page-wrapper\">\n      <div className=\"main\" style={{ maxWidth: '500px', width: '100%' }}>\n        <div className=\"form\">\n          <h2 className=\"form_title title\">Signing in with Google...</h2>\n          {isLoading && (\n            <p className=\"description\" style={{ marginTop: '20px' }}>\n              Please wait while we complete your sign-in.\n            </p>\n          )}\n          {error && (\n            <>\n              <div className=\"error-message\" style={{ marginTop: '20px' }}>\n                {error}\n              </div>\n              <p className=\"description\" style={{ marginTop: '10px' }}>\n                Redirecting to login page...\n              </p>\n            </>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default function GoogleCallbackPage() {\n  return (\n    <Suspense fallback={\n      <div className=\"auth-page-wrapper\">\n        <div className=\"main\" style={{ maxWidth: '500px', width: '100%' }}>\n          <div className=\"form\">\n            <h2 className=\"form_title title\">Signing in with Google...</h2>\n            <p className=\"description\" style={{ marginTop: '20px' }}>\n              Loading...\n            </p>\n          </div>\n        </div>\n      </div>\n    }>\n      <GoogleCallbackContent />\n    </Suspense>\n  );\n}\n\n"],"names":["c","_c","useEffect","useState","Suspense","useRouter","useSearchParams","authAPI","useAuthContext","handleApiError","GoogleCallbackContent","router","searchParams","setAuth","error","setError","isLoading","setIsLoading","handleCallback","code","get","state","errorParam","setTimeout","push","storedState","sessionStorage","getItem","removeItem","redirectUri","window","location","origin","codeVerifier","Error","tokenResponse","fetch","method","headers","body","JSON","stringify","ok","errorData","json","catch","error_description","tokenData","idToken","authResponse","googleSignIn","err","console","maxWidth","width","marginTop","GoogleCallbackPage","$","$i","Symbol","for","t0","t1","t2"],"mappings":"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","ignoreList":[]}}]
}