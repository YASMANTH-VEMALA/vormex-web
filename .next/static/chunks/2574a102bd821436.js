(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,81174,71254,44171,21790,55306,19684,68527,e=>{"use strict";var t=e.i(43476),a=e.i(932),r=e.i(71645),s=e.i(18566),l=e.i(22651),n=e.i(13751),i=e.i(94913),o=e.i(75157);function d({selectedConversationId:e,onSelectConversation:a,currentUserId:i}){let o=(0,s.useRouter)(),[d,m]=(0,r.useState)([]),[g,x]=(0,r.useState)(!0),[u,h]=(0,r.useState)(null),[p,b]=(0,r.useState)(!1),[f,y]=(0,r.useState)(),v=(0,r.useCallback)(async e=>{try{0===d.length&&x(!0);let t=await (0,l.getConversations)(30,e);e?m(e=>[...e,...t.conversations]):m(t.conversations),b(t.hasMore),y(t.nextCursor)}catch(e){h(e.message||"Failed to load conversations")}finally{x(!1)}},[d.length]);return((0,r.useEffect)(()=>{v()},[v]),(0,r.useEffect)(()=>{let t=(0,n.getSocket)();if(!t)return;let a=new Set,r=t=>{if(!a.has(t.message.id)){if(a.add(t.message.id),a.size>50){let e=a.values().next().value;void 0!==e&&a.delete(e)}m(a=>{let r=a.findIndex(e=>e.id===t.conversationId);if(r>=0){let s=a[r];if(s.lastMessage?.id===t.message.id)return a;let l=[...a],n={...l[r]};return n.lastMessage={id:t.message.id,content:t.message.content,contentType:t.message.contentType,senderId:t.message.senderId,status:t.message.status,createdAt:t.message.createdAt},n.lastMessageAt=t.message.createdAt,t.message.senderId!==i&&t.conversationId!==e&&(n.unreadCount=(n.unreadCount||0)+1),l.splice(r,1),[n,...l]}return v(),a})}},s=e=>{"new_message"===e.type&&r({conversationId:e.conversationId,message:e.message})},l=e=>{m(t=>t.map(t=>t.id===e.conversationId?{...t,unreadCount:0}:t))};return t.on("chat:new_message",r),t.on("chat:notification",s),t.on("chat:messages_read",l),()=>{t.off("chat:new_message",r),t.off("chat:notification",s),t.off("chat:messages_read",l)}},[i,e,v]),g&&0===d.length)?(0,t.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):u?(0,t.jsxs)("div",{className:"p-4 text-center text-red-500",children:[u,(0,t.jsx)("button",{onClick:()=>v(),className:"block mx-auto mt-2 text-blue-500 hover:underline",children:"Retry"})]}):0===d.length?(0,t.jsxs)("div",{className:"p-8 text-center text-gray-500 dark:text-gray-400",children:[(0,t.jsx)("div",{className:"text-4xl mb-4",children:"ðŸ’¬"}),(0,t.jsx)("p",{children:"No conversations yet"}),(0,t.jsx)("p",{className:"text-sm mt-2",children:"Start a chat with someone!"})]}):(0,t.jsx)("div",{className:"flex flex-col h-full",children:(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto",children:[d.map(r=>(0,t.jsx)(c,{conversation:r,isSelected:e===r.id,currentUserId:i,onClick:()=>{a?a(r):o.push(`/messages/${r.id}`)}},r.id)),p&&(0,t.jsx)("button",{onClick:()=>{p&&f&&v(f)},disabled:g,className:"w-full py-3 text-sm text-blue-600 hover:bg-gray-50 dark:hover:bg-gray-800",children:g?"Loading...":"Load more"})]})})}function c(e){let r,s,l,n,d,c,m,g,x,u,h,p,b,f=(0,a.c)(39),{conversation:y,isSelected:v,currentUserId:j,onClick:w}=e,k=y.otherParticipant,N=y.lastMessage,C=y.unreadCount>0,S=N?.senderId===j,T=v?"bg-blue-50 dark:bg-blue-900/20":"hover:bg-gray-50 dark:hover:bg-gray-800/50",I=C&&!v&&"bg-gray-50 dark:bg-gray-800/30";f[0]!==T||f[1]!==I?(r=(0,o.cn)("flex items-center gap-3 p-3 cursor-pointer transition-colors border-b border-gray-100 dark:border-gray-800",T,I),f[0]=T,f[1]=I,f[2]=r):r=f[2],f[3]!==k.name||f[4]!==k.profileImage?(s=k.profileImage?(0,t.jsx)("img",{src:k.profileImage,alt:k.name,className:"w-12 h-12 rounded-full object-cover"}):k.name.charAt(0).toUpperCase(),f[3]=k.name,f[4]=k.profileImage,f[5]=s):s=f[5],f[6]!==s?(l=(0,t.jsx)("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center text-white font-semibold",children:s}),f[6]=s,f[7]=l):l=f[7],f[8]!==k.isOnline?(n=k.isOnline&&(0,t.jsx)("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white dark:border-gray-900"}),f[8]=k.isOnline,f[9]=n):n=f[9],f[10]!==l||f[11]!==n?(d=(0,t.jsxs)("div",{className:"relative flex-shrink-0",children:[l,n]}),f[10]=l,f[11]=n,f[12]=d):d=f[12];let M=C&&"text-gray-900 dark:text-white font-semibold";return f[13]!==M?(c=(0,o.cn)("font-medium truncate",M),f[13]=M,f[14]=c):c=f[14],f[15]!==k.name||f[16]!==c?(m=(0,t.jsx)("span",{className:c,children:k.name}),f[15]=k.name,f[16]=c,f[17]=m):m=f[17],f[18]!==N?(g=N&&(0,t.jsx)("span",{className:"text-xs text-gray-500 flex-shrink-0",children:(0,i.formatDistanceToNow)(new Date(N.createdAt),{addSuffix:!1})}),f[18]=N,f[19]=g):g=f[19],f[20]!==m||f[21]!==g?(x=(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[m,g]}),f[20]=m,f[21]=g,f[22]=x):x=f[22],f[23]!==S||f[24]!==C||f[25]!==N?(u=(0,t.jsx)("div",{className:"flex items-center gap-1",children:N?(0,t.jsxs)(t.Fragment,{children:[S&&(0,t.jsx)("span",{className:"text-gray-400 text-sm",children:"READ"===N.status||"DELIVERED"===N.status?"âœ“âœ“":"âœ“"}),(0,t.jsx)("p",{className:(0,o.cn)("text-sm truncate",C?"text-gray-900 dark:text-white font-medium":"text-gray-500 dark:text-gray-400"),children:"image"===N.contentType?"\uD83D\uDCF7 Photo":"file"===N.contentType?"\uD83D\uDCCE File":"voice"===N.contentType?"\uD83C\uDFA4 Voice message":"post"===N.contentType?"\uD83D\uDCC4 Shared a post":"reel"===N.contentType?"\uD83C\uDFAC Reel":"video"===N.contentType?"\uD83C\uDFAC Video":N.content})]}):(0,t.jsx)("p",{className:"text-sm text-gray-400 italic",children:"No messages yet"})}),f[23]=S,f[24]=C,f[25]=N,f[26]=u):u=f[26],f[27]!==x||f[28]!==u?(h=(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[x,u]}),f[27]=x,f[28]=u,f[29]=h):h=f[29],f[30]!==y.unreadCount||f[31]!==C?(p=C&&(0,t.jsx)("div",{className:"flex-shrink-0 w-5 h-5 bg-blue-600 rounded-full flex items-center justify-center",children:(0,t.jsx)("span",{className:"text-xs text-white font-medium",children:y.unreadCount>9?"9+":y.unreadCount})}),f[30]=y.unreadCount,f[31]=C,f[32]=p):p=f[32],f[33]!==w||f[34]!==h||f[35]!==p||f[36]!==r||f[37]!==d?(b=(0,t.jsxs)("div",{onClick:w,className:r,children:[d,h,p]}),f[33]=w,f[34]=h,f[35]=p,f[36]=r,f[37]=d,f[38]=b):b=f[38],b}e.s(["default",()=>d],71254);var m=e.i(1851),g=e.i(80797),x=e.i(83482),u=e.i(46932),h=e.i(88653),p=e.i(75254);let b=(0,p.default)("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]);var f=e.i(74886),y=e.i(88699),v=e.i(27612);let j=(0,p.default)("Forward",[["polyline",{points:"15 17 20 12 15 7",key:"1w3sku"}],["path",{d:"M4 18v-2a4 4 0 0 1 4-4h12",key:"jmiej9"}]]);var w=e.i(70273),k=e.i(40433),N=e.i(41071),C=e.i(40160);let S=["â¤ï¸","ðŸ‘","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ™"],T={"chat-reaction-startup-vibes":["ðŸš€","ðŸ’¡","ðŸ”¥","ðŸ™Œ","âš¡","ðŸ“ˆ"],"chat-reaction-desi-memes":["ðŸ¤£","ðŸ˜Ž","ðŸ«¡","ðŸ¤Œ","ðŸ’ƒ","ðŸ˜"],"chat-reaction-finance-bros":["ðŸ’¸","ðŸ¤‘","ðŸ“‰","ðŸ’°","ðŸ¦","ðŸ¤"]},I={"gradient-2":"chat-theme-vibrant-dms","gradient-5":"chat-theme-vibrant-dms","pattern-1":"chat-theme-vibrant-dms","gradient-4":"chat-theme-dark-variants","gradient-6":"chat-theme-dark-variants","pattern-2":"chat-theme-dark-variants"};function M(e){let t=new Set(e),a=new Set(S);for(let[e,r]of Object.entries(T))if(t.has(e))for(let e of r)a.add(e);return{ownedItemSlugs:e,ownedThemePacks:["chat-theme-vibrant-dms","chat-theme-dark-variants","chat-theme-animated-bubbles"].filter(e=>t.has(e)),availableReactions:Array.from(a),animatedBubbles:t.has("chat-theme-animated-bubbles"),messageEffects:{confetti:t.has("chat-effect-confetti"),fireworks:t.has("chat-effect-fireworks"),voiceSfx:t.has("chat-effect-voice-sfx")}}}function R(e,t){let a=I[e];return!a||t.includes(a)}function A({isOpen:e,onClose:a,isOwn:s,messageContent:l,hasMedia:n,mediaUrl:i,onReply:d,onEdit:c,onDelete:m,onReact:g,onCopy:x,onForward:p,onPin:N,onStar:T,availableReactions:I=S,position:M,anchorPosition:R="right"}){let[A,D]=(0,r.useState)(!1),E=(0,r.useRef)(null);(0,r.useEffect)(()=>{let t=e=>{E.current&&!E.current.contains(e.target)&&a()};return e&&document.addEventListener("mousedown",t),()=>{document.removeEventListener("mousedown",t)}},[e,a]),(0,r.useEffect)(()=>{let t=t=>{e&&("Escape"===t.key?a():"r"!==t.key||t.metaKey||t.ctrlKey?"c"===t.key&&(t.metaKey||t.ctrlKey)&&(x(),a()):(d(),a()))};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[e,a,d,x]);let L=[{id:"reply",label:"Reply",icon:b,onClick:()=>{d(),a()},shortcut:"R"},{id:"copy",label:"Copy",icon:f.Copy,onClick:()=>{navigator.clipboard.writeText(l),x(),a()},shortcut:"âŒ˜C"},...s?[{id:"edit",label:"Edit",icon:y.Pencil,onClick:()=>{c?.(),a()}}]:[],...n&&i?[{id:"download",label:"Download",icon:C.Download,onClick:()=>{if(i){let e=document.createElement("a");e.href=i,e.download="",e.target="_blank",document.body.appendChild(e),e.click(),document.body.removeChild(e)}a()}}]:[],{id:"forward",label:"Forward",icon:j,onClick:()=>{p?.(),a()},disabled:!0},{id:"pin",label:"Pin",icon:k.Pin,onClick:()=>{N?.(),a()},disabled:!0},{id:"star",label:"Star",icon:w.Star,onClick:()=>{T?.(),a()},disabled:!0},{id:"delete",label:"Delete",icon:v.Trash2,onClick:()=>D(!0),danger:!0}];return(0,t.jsx)(h.AnimatePresence,{children:e&&(0,t.jsxs)(u.motion.div,{ref:E,initial:{opacity:0,scale:.95,y:-10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:-10},transition:{duration:.15},className:(0,o.cn)("absolute z-50 min-w-[200px]","bg-white dark:bg-gray-800 rounded-xl shadow-xl","border border-gray-200 dark:border-gray-700","overflow-hidden"),style:M?{top:M.y,left:"left"===R?M.x:void 0,right:"right"===R?M.x:void 0}:{top:"-8px",["left"===R?"left":"right"]:"100%",marginLeft:"left"===R?"8px":void 0,marginRight:"right"===R?"8px":void 0},children:[!A&&(0,t.jsx)("div",{className:"p-2 border-b border-gray-200 dark:border-gray-700",children:(0,t.jsx)("div",{className:"flex items-center gap-1",children:I.map(e=>(0,t.jsx)("button",{onClick:()=>{g(e),a()},className:"p-1.5 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-all hover:scale-125",children:(0,t.jsx)("span",{className:"text-lg",children:e})},e))})}),A?(0,t.jsxs)("div",{className:"py-1",children:[(0,t.jsx)("div",{className:"px-3 py-2 text-sm font-medium text-gray-500 dark:text-gray-400",children:"Delete message?"}),(0,t.jsxs)("button",{onClick:()=>{m(!1),a()},className:"w-full flex items-center gap-3 px-3 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:[(0,t.jsx)(v.Trash2,{className:"w-4 h-4"}),(0,t.jsx)("span",{children:"Delete for me"})]}),s&&(0,t.jsxs)("button",{onClick:()=>{m(!0),a()},className:"w-full flex items-center gap-3 px-3 py-2 text-left text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors",children:[(0,t.jsx)(v.Trash2,{className:"w-4 h-4"}),(0,t.jsx)("span",{children:"Delete for everyone"})]}),(0,t.jsx)("button",{onClick:()=>D(!1),className:"w-full px-3 py-2 text-left text-sm text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:"Cancel"})]}):(0,t.jsx)("div",{className:"py-1",children:L.map(e=>(0,t.jsxs)("button",{onClick:e.onClick,disabled:e.disabled,className:(0,o.cn)("w-full flex items-center justify-between gap-3 px-3 py-2 text-left text-sm transition-colors",e.danger?"text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20":"text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700",e.disabled&&"opacity-50 cursor-not-allowed"),children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(e.icon,{className:"w-4 h-4"}),(0,t.jsx)("span",{children:e.label}),e.disabled&&(0,t.jsx)("span",{className:"text-xs text-gray-400",children:"(soon)"})]}),e.shortcut&&(0,t.jsx)("span",{className:"text-xs text-gray-400",children:e.shortcut})]},e.id))})]})})}function D(e){let r,s,l=(0,a.c)(8),{isVisible:n,isOwn:i,onReply:d,onReact:c,onMore:m}=e;return l[0]!==i||l[1]!==n||l[2]!==m||l[3]!==c||l[4]!==d?(r=n&&(0,t.jsxs)(u.motion.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},exit:{opacity:0,y:5},transition:{duration:.1},className:(0,o.cn)("absolute -top-8 flex items-center gap-0.5","bg-white dark:bg-gray-800 rounded-lg shadow-lg","border border-gray-200 dark:border-gray-700 p-0.5",i?"right-0":"left-8"),children:[(0,t.jsx)("button",{onClick:c,className:"p-1.5 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors",title:"Add reaction",children:(0,t.jsx)("span",{className:"text-sm",children:"ðŸ˜€"})}),(0,t.jsx)("button",{onClick:d,className:"p-1.5 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors",title:"Reply",children:(0,t.jsx)(b,{className:"w-4 h-4 text-gray-500"})}),(0,t.jsx)("button",{onClick:m,className:"p-1.5 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors",title:"More options",children:(0,t.jsx)(N.MoreHorizontal,{className:"w-4 h-4 text-gray-500"})})]}),l[0]=i,l[1]=n,l[2]=m,l[3]=c,l[4]=d,l[5]=r):r=l[5],l[6]!==r?(s=(0,t.jsx)(h.AnimatePresence,{children:r}),l[6]=r,l[7]=s):s=l[7],s}e.s(["DEFAULT_CHAT_CUSTOMIZATION_ENTITLEMENTS",0,{ownedItemSlugs:[],ownedThemePacks:[],availableReactions:S,animatedBubbles:!1,messageEffects:{confetti:!1,fireworks:!1,voiceSfx:!1}},"DEFAULT_CHAT_REACTIONS",0,S,"buildChatCustomizationEntitlements",()=>M,"isWallpaperUnlocked",()=>R],44171);var E=e.i(37727),L=e.i(73708),_=e.i(78583),U=e.i(78716),P=e.i(45423),F=e.i(26455);let O=(0,p.default)("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);var z=e.i(5899),V=e.i(55436),B=e.i(70756);let q=[{id:"default",name:"Default",color:"bg-gray-50 dark:bg-gray-900"},{id:"gradient-1",name:"Ocean",color:"bg-gradient-to-br from-blue-100 to-cyan-100 dark:from-blue-900/30 dark:to-cyan-900/30"},{id:"gradient-2",name:"Sunset",color:"bg-gradient-to-br from-orange-100 to-pink-100 dark:from-orange-900/30 dark:to-pink-900/30",requiredPackSlug:"chat-theme-vibrant-dms"},{id:"gradient-3",name:"Forest",color:"bg-gradient-to-br from-green-100 to-emerald-100 dark:from-green-900/30 dark:to-emerald-900/30"},{id:"gradient-4",name:"Lavender",color:"bg-gradient-to-br from-purple-100 to-violet-100 dark:from-purple-900/30 dark:to-violet-900/30",requiredPackSlug:"chat-theme-dark-variants"},{id:"gradient-5",name:"Rose",color:"bg-gradient-to-br from-rose-100 to-pink-100 dark:from-rose-900/30 dark:to-pink-900/30",requiredPackSlug:"chat-theme-vibrant-dms"},{id:"gradient-6",name:"Midnight",color:"bg-gradient-to-br from-slate-800 to-gray-900",requiredPackSlug:"chat-theme-dark-variants"},{id:"gradient-7",name:"Sky",color:"bg-gradient-to-br from-sky-100 to-indigo-100 dark:from-sky-900/30 dark:to-indigo-900/30"},{id:"gradient-8",name:"Amber",color:"bg-gradient-to-br from-amber-100 to-yellow-100 dark:from-amber-900/30 dark:to-yellow-900/30"},{id:"pattern-1",name:"Dots",color:"bg-gray-100 dark:bg-gray-800",pattern:"bg-[radial-gradient(circle,_#00000010_1px,_transparent_1px)] bg-[size:20px_20px]",requiredPackSlug:"chat-theme-vibrant-dms"},{id:"pattern-2",name:"Grid",color:"bg-gray-100 dark:bg-gray-800",pattern:"bg-[linear-gradient(#00000008_1px,_transparent_1px),linear-gradient(90deg,_#00000008_1px,_transparent_1px)] bg-[size:20px_20px]",requiredPackSlug:"chat-theme-dark-variants"}];function $(e){let s,l,n,i,d,c=(0,a.c)(12),{isOpen:m,onClose:g,conversationId:x,otherUser:p,currentWallpaper:b,onWallpaperChange:f,mediaItems:y,onClearChat:j,onBlockUser:w,onReportUser:k,ownedThemePacks:N,onOpenStore:C}=e;c[0]!==N?(s=void 0===N?[]:N,c[0]=N,c[1]=s):s=c[1];let S=s,[T,I]=(0,r.useState)("settings");c[2]!==x?(l=()=>"true"===localStorage.getItem(`chat_muted_${x}`),c[2]=x,c[3]=l):l=c[3];let[M,A]=(0,r.useState)(l),[D,$]=(0,r.useState)("all"),[W,K]=(0,r.useState)("");c[4]!==x||c[5]!==M?(n=()=>{let e=!M;A(e),localStorage.setItem(`chat_muted_${x}`,String(e))},c[4]=x,c[5]=M,c[6]=n):n=c[6];let G=n;c[7]!==D?(i=e=>"all"===D||("images"===D?"image"===e.type:"videos"===D?"video"===e.type:"files"!==D||"file"===e.type||"audio"===e.type),c[7]=D,c[8]=i):i=c[8];let X=(void 0===y?[]:y).filter(i),Y=h.AnimatePresence,Z=m&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:g,className:"fixed inset-0 bg-black/30 backdrop-blur-sm z-40"}),(0,t.jsxs)(u.motion.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{type:"spring",damping:25,stiffness:200},className:"fixed right-0 top-0 bottom-0 w-full max-w-md bg-white dark:bg-gray-900 shadow-xl z-50 flex flex-col",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Chat Info"}),(0,t.jsx)("button",{onClick:g,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition-colors",children:(0,t.jsx)(E.X,{className:"w-5 h-5"})})]}),(0,t.jsxs)("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700 flex flex-col items-center",children:[(0,t.jsx)("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center text-white text-2xl font-semibold mb-3",children:p.profileImage?(0,t.jsx)("img",{src:p.profileImage,alt:p.name,className:"w-20 h-20 rounded-full object-cover"}):p.name.charAt(0).toUpperCase()}),(0,t.jsx)("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:p.name}),(0,t.jsxs)("p",{className:"text-gray-500 dark:text-gray-400",children:["@",p.username]}),p.isOnline&&(0,t.jsx)("span",{className:"mt-2 px-2 py-0.5 bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 text-xs rounded-full",children:"Online"})]}),(0,t.jsx)("div",{className:"flex border-b border-gray-200 dark:border-gray-700",children:[{id:"settings",label:"Settings"},{id:"wallpaper",label:"Wallpaper"},{id:"media",label:"Media"}].map(e=>(0,t.jsxs)("button",{onClick:()=>I(e.id),className:(0,o.cn)("flex-1 py-3 text-sm font-medium transition-colors relative",T===e.id?"text-blue-600 dark:text-blue-400":"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"),children:[e.label,T===e.id&&(0,t.jsx)(u.motion.div,{layoutId:"activeTab",className:"absolute bottom-0 left-0 right-0 h-0.5 bg-blue-600 dark:bg-blue-400"})]},e.id))}),(0,t.jsxs)("div",{className:"flex-1 overflow-y-auto",children:["settings"===T&&(0,t.jsxs)("div",{className:"p-4 space-y-2",children:[(0,t.jsxs)("button",{onClick:G,className:"w-full flex items-center justify-between p-3 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[M?(0,t.jsx)(F.BellOff,{className:"w-5 h-5 text-gray-500"}):(0,t.jsx)(P.Bell,{className:"w-5 h-5 text-gray-500"}),(0,t.jsx)("span",{className:"text-gray-900 dark:text-white",children:"Mute Notifications"})]}),(0,t.jsx)("div",{className:(0,o.cn)("w-10 h-6 rounded-full transition-colors relative",M?"bg-blue-600":"bg-gray-300 dark:bg-gray-600"),children:(0,t.jsx)("div",{className:(0,o.cn)("absolute top-1 w-4 h-4 bg-white rounded-full transition-transform",M?"translate-x-5":"translate-x-1")})})]}),(0,t.jsx)("div",{className:"my-4 border-t border-gray-200 dark:border-gray-700"}),(0,t.jsxs)("button",{onClick:j,className:"w-full flex items-center gap-3 p-3 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors text-red-600 dark:text-red-400",children:[(0,t.jsx)(v.Trash2,{className:"w-5 h-5"}),(0,t.jsx)("span",{children:"Clear Chat History"})]}),(0,t.jsxs)("button",{onClick:w,className:"w-full flex items-center gap-3 p-3 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors text-red-600 dark:text-red-400",children:[(0,t.jsx)(O,{className:"w-5 h-5"}),(0,t.jsxs)("span",{children:["Block ",p.name]})]}),(0,t.jsxs)("button",{onClick:k,className:"w-full flex items-center gap-3 p-3 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors text-red-600 dark:text-red-400",children:[(0,t.jsx)(z.Flag,{className:"w-5 h-5"}),(0,t.jsx)("span",{children:"Report"})]})]}),"wallpaper"===T&&(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:"Choose a wallpaper for this chat"}),(0,t.jsx)("div",{className:"grid grid-cols-3 gap-3",children:q.map(e=>{let a=R(e.id,S),r=e.requiredPackSlug;return(0,t.jsxs)("button",{onClick:()=>{a?f(e.id):C?.()},className:(0,o.cn)("aspect-[3/4] rounded-xl overflow-hidden relative transition-all",e.color,e.pattern,!a&&"opacity-70",b===e.id?"ring-2 ring-blue-500 ring-offset-2 dark:ring-offset-gray-900":"hover:scale-105"),children:[e.preview&&(0,t.jsx)("img",{src:e.preview,alt:e.name,className:"w-full h-full object-cover"}),(0,t.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 p-2 bg-gradient-to-t from-black/50 to-transparent",children:[(0,t.jsx)("span",{className:"text-xs text-white font-medium",children:e.name}),!a&&(0,t.jsxs)("p",{className:"text-[10px] text-white/90",children:["Requires ","chat-theme-dark-variants"===r?"Dark Variants Pack":"Vibrant DMs Pack"]})]}),!a&&(0,t.jsx)("div",{className:"absolute top-2 left-2 w-6 h-6 bg-black/60 rounded-full flex items-center justify-center",children:(0,t.jsx)(B.Lock,{className:"w-3 h-3 text-white"})}),b===e.id&&(0,t.jsx)("div",{className:"absolute top-2 right-2 w-5 h-5 bg-blue-500 rounded-full flex items-center justify-center",children:(0,t.jsx)("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})})]},e.id)})})]}),"media"===T&&(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsxs)("div",{className:"relative mb-4",children:[(0,t.jsx)(V.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),(0,t.jsx)("input",{type:"text",value:W,onChange:e=>K(e.target.value),placeholder:"Search media...",className:"w-full pl-10 pr-4 py-2 bg-gray-100 dark:bg-gray-800 rounded-lg border-0 focus:ring-2 focus:ring-blue-500"})]}),(0,t.jsx)("div",{className:"flex gap-2 mb-4 overflow-x-auto pb-2",children:[{id:"all",label:"All",icon:null},{id:"images",label:"Images",icon:L.Image},{id:"videos",label:"Videos",icon:U.Video},{id:"files",label:"Files",icon:_.FileText}].map(e=>(0,t.jsxs)("button",{onClick:()=>$(e.id),className:(0,o.cn)("flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm whitespace-nowrap transition-colors",D===e.id?"bg-blue-600 text-white":"bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700"),children:[e.icon&&(0,t.jsx)(e.icon,{className:"w-4 h-4"}),e.label]},e.id))}),X.length>0?(0,t.jsx)("div",{className:"grid grid-cols-3 gap-2",children:X.map(H)}):(0,t.jsxs)("div",{className:"text-center py-12 text-gray-500",children:[(0,t.jsx)(L.Image,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),(0,t.jsx)("p",{children:"No media shared yet"}),(0,t.jsx)("p",{className:"text-sm",children:"Photos, videos, and files will appear here"})]})]})]})]})]});return c[9]!==Y||c[10]!==Z?(d=(0,t.jsx)(Y,{children:Z}),c[9]=Y,c[10]=Z,c[11]=d):d=c[11],d}function H(e){return(0,t.jsx)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"aspect-square rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-800 hover:opacity-80 transition-opacity relative group",children:"image"===e.type?(0,t.jsx)("img",{src:e.url,alt:"",className:"w-full h-full object-cover"}):"video"===e.type?(0,t.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gray-200 dark:bg-gray-700",children:(0,t.jsx)(U.Video,{className:"w-8 h-8 text-gray-500"})}):(0,t.jsxs)("div",{className:"w-full h-full flex flex-col items-center justify-center p-2",children:[(0,t.jsx)(_.FileText,{className:"w-8 h-8 text-gray-500 mb-1"}),(0,t.jsx)("span",{className:"text-xs text-gray-500 truncate w-full text-center",children:e.fileName||"File"})]})},e.id)}function W({conversationId:e,currentUserId:a,otherUser:s,wallpaper:i="default",availableReactions:d=S,animatedBubbles:c=!1,onReply:u,uploadingMessages:h=[],optimisticMessages:p=[],onLastMessageUpdate:b,onMessageConfirmed:f}){let[y,v]=(0,r.useState)([]),[j,w]=(0,r.useState)(!0),[k,N]=(0,r.useState)(!1),[C,T]=(0,r.useState)(!1),[I,M]=(0,r.useState)(),[R,A]=(0,r.useState)(null),[D,E]=(0,r.useState)(null),[L,_]=(0,r.useState)(null),[U,P]=(0,r.useState)(null),F=(0,r.useRef)(null),O=(0,r.useRef)(null),z=(0,r.useRef)(new Map),[V,B]=(0,r.useState)(!0),$=(0,r.useCallback)(e=>{let t=z.current.get(e);t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),E(e),setTimeout(()=>{E(null)},1500))},[]),H=(0,r.useCallback)((e,t)=>{t?z.current.set(e,t):z.current.delete(e)},[]),W=(0,r.useCallback)(async t=>{try{t?N(!0):w(!0);let r=await (0,l.getMessages)(e,50,t),s=r.messages.map(e=>({...e,isEdited:(e=>{if(!e.createdAt||!e.updatedAt)return!1;let t=new Date(e.createdAt).getTime();return new Date(e.updatedAt).getTime()-t>=1e3})(e)}));if(t)v(e=>[...s,...e]);else if(v(s),b){let e=[...r.messages].reverse().find(e=>e.senderId!==a&&e.content);e&&b(e.content)}T(r.hasMore),M(r.nextCursor)}catch(e){console.error("Failed to fetch messages:",e)}finally{w(!1),N(!1)}},[e,a,b]);(0,r.useEffect)(()=>(W(),(0,n.joinChatRoom)(e),(0,n.markChatAsRead)(e),()=>{(0,n.leaveChatRoom)(e)}),[e,W]),(0,r.useEffect)(()=>{let t=(0,n.getSocket)();if(!t)return;let r=t=>{t.conversationId===e&&(v(e=>e.some(e=>e.id===t.message.id)?e:[...e,t.message]),B(!0),t.message.senderId===a&&f&&f(t.message.content),t.message.senderId!==a&&((0,n.markChatAsRead)(e),t.message.content&&b&&b(t.message.content)))},s=t=>{t.conversationId===e&&t.userId!==a&&A(t.isTyping?t.userId:null)},l=t=>{t.conversationId===e&&v(e=>e.map(e=>e.senderId===a&&"READ"!==e.status?{...e,status:"READ",readAt:new Date(t.readAt).toISOString()}:e))},i=t=>{t.conversationId===e&&v(e=>e.map(e=>e.senderId===a&&"SENT"===e.status?{...e,status:"DELIVERED",deliveredAt:new Date(t.deliveredAt).toISOString()}:e))},o=e=>{console.error("Chat socket error:",e.message)},d=t=>{t.conversationId===e&&(t.forEveryone?v(e=>e.map(e=>e.id===t.messageId?{...e,isDeleted:!0,content:"This message was deleted"}:e)):v(e=>e.filter(e=>e.id!==t.messageId)))},c=t=>{t.conversationId===e&&v(e=>e.map(e=>e.id===t.messageId?{...e,content:t.content,updatedAt:String(t.editedAt),isEdited:!0}:e))},m=t=>{t.conversationId===e&&v(e=>e.map(e=>{if(e.id!==t.messageId)return e;let a=[...e.reactions||[]];if("removed"===t.action)a=a.filter(e=>e.userId!==t.userId);else if("added"===t.action)a.push({id:`temp-${Date.now()}`,userId:t.userId,emoji:t.emoji,user:{id:t.userId,username:"",name:""}});else if("updated"===t.action){let e=a.findIndex(e=>e.userId===t.userId);e>=0&&(a[e]={...a[e],emoji:t.emoji})}return{...e,reactions:a}}))},g=t=>{"new_message"===t.type&&t.conversationId===e&&(v(e=>e.some(e=>e.id===t.message.id)?e:[...e,t.message]),B(!0),t.message.senderId===a&&f&&f(t.message.content),t.message.senderId!==a&&((0,n.markChatAsRead)(e),t.message.content&&b&&b(t.message.content)))};return t.on("chat:new_message",r),t.on("chat:notification",g),t.on("chat:user_typing",s),t.on("chat:messages_read",l),t.on("chat:messages_delivered",i),t.on("chat:message_deleted",d),t.on("chat:message_edited",c),t.on("chat:message_reaction",m),t.on("error",o),()=>{t.off("chat:new_message",r),t.off("chat:notification",g),t.off("chat:user_typing",s),t.off("chat:messages_read",l),t.off("chat:messages_delivered",i),t.off("chat:message_deleted",d),t.off("chat:message_edited",c),t.off("chat:message_reaction",m),t.off("error",o)}},[e,a,s.id,b,f]),(0,r.useEffect)(()=>{V&&F.current&&(F.current.scrollIntoView({behavior:"smooth"}),B(!1))},[y,V]);let G=y.reduce((e,t)=>{let a=new Date(t.createdAt),r=(0,m.format)(a,"yyyy-MM-dd");return e[r]||(e[r]=[]),e[r].push(t),e},{});if(j)return(0,t.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})});let X=q.find(e=>e.id===i)||q[0],Y=(0,o.cn)(X.color,X.pattern);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{ref:O,className:(0,o.cn)("flex-1 overflow-y-auto p-4 space-y-4",Y),onScroll:e=>{e.currentTarget.scrollTop<100&&C&&!k&&W(I)},children:[k&&(0,t.jsx)("div",{className:"flex justify-center py-2",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"})}),Object.entries(G).map(([r,l])=>{var n;return(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"flex items-center justify-center my-4",children:(0,t.jsx)("div",{className:"bg-gray-200 dark:bg-gray-700 px-3 py-1 rounded-full text-xs text-gray-600 dark:text-gray-300",children:(n=new Date(r),(0,g.isToday)(n)?"Today":(0,x.isYesterday)(n)?"Yesterday":(0,m.format)(n,"MMMM d, yyyy"))})}),l.map((r,n)=>{let i=n>0?l[n-1]:null,o=!i||i.senderId!==r.senderId;return(0,t.jsx)(K,{message:r,isOwn:r.senderId===a,showAvatar:o,otherUser:s,conversationId:e,isHighlighted:D===r.id,onScrollToReply:$,registerRef:e=>H(r.id,e),onReply:u?()=>u({id:r.id,content:r.content,senderName:r.senderId===a?"You":s.name}):void 0,onViewImage:_,onViewVideo:P,availableReactions:d,animatedBubbles:c},r.id)})]},r)}),p.map(e=>(0,t.jsx)("div",{className:"flex justify-end mb-2",children:(0,t.jsxs)("div",{className:"max-w-[70%]",children:[e.replyTo&&(0,t.jsxs)("div",{className:"text-xs p-2 rounded-t-lg border-l-2 bg-blue-600/20 border-blue-400",children:[(0,t.jsx)("span",{className:"text-gray-500 text-[10px]",children:"â†© Replying to"}),(0,t.jsx)("p",{className:"truncate text-gray-700 dark:text-gray-300",children:e.replyTo.content})]}),(0,t.jsx)("div",{className:(0,o.cn)("bg-blue-600 text-white px-4 py-2 rounded-2xl rounded-br-sm",e.replyTo&&"rounded-t-none"),children:(0,t.jsx)("p",{className:"break-words whitespace-pre-wrap",children:e.content})}),(0,t.jsxs)("div",{className:"text-xs text-gray-500 mt-1 flex items-center gap-1 justify-end",children:[(0,t.jsx)("span",{children:(0,m.format)(new Date(e.createdAt),"HH:mm")}),(0,t.jsx)("span",{className:"animate-pulse",children:"â³"})]})]})},e.id)),h.map(e=>(0,t.jsx)("div",{className:"flex justify-end mb-2",children:(0,t.jsx)("div",{className:"relative max-w-[70%]",children:(0,t.jsxs)("div",{className:"bg-blue-600 text-white px-4 py-2 rounded-2xl rounded-br-sm",children:[e.preview&&("image"===e.type||"video"===e.type)&&(0,t.jsxs)("div",{className:"relative mb-2 rounded-lg overflow-hidden",children:["image"===e.type?(0,t.jsx)("img",{src:e.preview,alt:"Uploading",className:"max-w-full opacity-70",style:{maxHeight:"200px"}}):(0,t.jsx)("video",{src:e.preview,className:"max-w-full opacity-70",style:{maxHeight:"200px"},muted:!0}),(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/30",children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsxs)("svg",{className:"w-12 h-12",viewBox:"0 0 36 36",children:[(0,t.jsx)("circle",{cx:"18",cy:"18",r:"16",fill:"none",stroke:"rgba(255,255,255,0.3)",strokeWidth:"3"}),(0,t.jsx)("circle",{cx:"18",cy:"18",r:"16",fill:"none",stroke:"white",strokeWidth:"3",strokeDasharray:`${e.progress}, 100`,strokeLinecap:"round",transform:"rotate(-90 18 18)"})]}),(0,t.jsxs)("span",{className:"absolute inset-0 flex items-center justify-center text-white text-xs font-medium",children:[e.progress,"%"]})]})})]}),("audio"===e.type||"document"===e.type)&&(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)("div",{className:"relative w-10 h-10",children:[(0,t.jsxs)("svg",{className:"w-10 h-10",viewBox:"0 0 36 36",children:[(0,t.jsx)("circle",{cx:"18",cy:"18",r:"16",fill:"none",stroke:"rgba(255,255,255,0.3)",strokeWidth:"3"}),(0,t.jsx)("circle",{cx:"18",cy:"18",r:"16",fill:"none",stroke:"white",strokeWidth:"3",strokeDasharray:`${e.progress}, 100`,strokeLinecap:"round",transform:"rotate(-90 18 18)"})]}),(0,t.jsx)("span",{className:"absolute inset-0 flex items-center justify-center text-white text-xs",children:"audio"===e.type?"ðŸŽ¤":"ðŸ“„"})]}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"text-sm truncate",children:e.fileName||"Uploading..."}),(0,t.jsxs)("p",{className:"text-xs opacity-70",children:["Sending... ",e.progress,"%"]})]})]}),("image"===e.type||"video"===e.type)&&(0,t.jsx)("p",{className:"text-sm",children:"image"===e.type?"ðŸ“· Sending photo...":"ðŸŽ¥ Sending video..."})]})})},e.id)),R&&(0,t.jsxs)("div",{className:"flex items-center gap-2 text-gray-500 text-sm",children:[(0,t.jsxs)("div",{className:"flex gap-1",children:[(0,t.jsx)("span",{className:"animate-bounce",children:"â€¢"}),(0,t.jsx)("span",{className:"animate-bounce",style:{animationDelay:"0.1s"},children:"â€¢"}),(0,t.jsx)("span",{className:"animate-bounce",style:{animationDelay:"0.2s"},children:"â€¢"})]}),(0,t.jsxs)("span",{children:[s.name," is typing..."]})]}),(0,t.jsx)("div",{ref:F})]}),L&&(0,t.jsxs)("div",{className:"fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4",onClick:()=>_(null),children:[(0,t.jsx)("button",{onClick:()=>_(null),className:"absolute top-4 right-4 text-white hover:bg-white/10 p-2 rounded-full transition-colors",children:(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,t.jsx)("img",{src:L,alt:"Full size image",className:"max-w-full max-h-full object-contain rounded-lg",onClick:e=>e.stopPropagation()}),(0,t.jsxs)("a",{href:L,download:!0,target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),className:"absolute bottom-4 right-4 bg-white/10 hover:bg-white/20 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors",children:[(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Download"]})]}),U&&(0,t.jsxs)("div",{className:"fixed inset-0 bg-black/95 z-50 flex items-center justify-center p-4",onClick:()=>P(null),children:[(0,t.jsx)("button",{onClick:()=>P(null),className:"absolute top-4 right-4 text-white hover:bg-white/10 p-2 rounded-full transition-colors z-10",children:(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,t.jsx)("video",{src:U,controls:!0,autoPlay:!0,className:"max-w-full max-h-full rounded-lg",style:{maxHeight:"90vh",maxWidth:"90vw"},onClick:e=>e.stopPropagation()}),(0,t.jsxs)("a",{href:U,download:!0,target:"_blank",rel:"noopener noreferrer",onClick:e=>e.stopPropagation(),className:"absolute bottom-4 right-4 bg-white/10 hover:bg-white/20 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors",children:[(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Download"]})]})]})}function K({message:e,isOwn:a,showAvatar:s,otherUser:l,conversationId:i,isHighlighted:d=!1,onScrollToReply:c,registerRef:g,onReply:x,onViewImage:u,onViewVideo:h,availableReactions:p=S,animatedBubbles:b=!1}){let[f,y]=(0,r.useState)(!1),[v,j]=(0,r.useState)(!1),[w,k]=(0,r.useState)(!1),[N,C]=(0,r.useState)(!1),[T,I]=(0,r.useState)(e.content),[M,R]=(0,r.useState)(!1),E=()=>{T.trim()&&T!==e.content&&(0,n.editChatMessage)(e.id,i,T),C(!1)},L=t=>{(0,n.reactToChatMessage)(e.id,i,t),k(!1)};return e.isDeleted?(0,t.jsx)("div",{ref:g,className:(0,o.cn)("flex items-center gap-2",a?"justify-end":"justify-start"),children:(0,t.jsx)("div",{className:"bg-gray-100 dark:bg-gray-800 text-gray-500 italic px-4 py-2 rounded-lg text-sm",children:"This message was deleted"})}):(0,t.jsxs)("div",{ref:g,className:(0,o.cn)("flex gap-2 group transition-all duration-300",a?"justify-end":"justify-start",d&&"bg-yellow-100/50 dark:bg-yellow-900/30 -mx-2 px-2 py-1 rounded-lg"),onMouseEnter:()=>y(!0),onMouseLeave:()=>{y(!1),k(!1)},children:[!a&&(0,t.jsx)("div",{className:(0,o.cn)("w-8 h-8 flex-shrink-0",!s&&"invisible"),children:s&&(0,t.jsx)("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center text-white text-sm font-medium",children:l.profileImage?(0,t.jsx)("img",{src:l.profileImage,alt:l.name,className:"w-8 h-8 rounded-full object-cover"}):l.name.charAt(0).toUpperCase()})}),(0,t.jsxs)("div",{className:(0,o.cn)("max-w-[70%] relative",a&&"order-first"),children:[e.replyTo&&(0,t.jsxs)("button",{onClick:()=>c?.(e.replyTo.id),className:(0,o.cn)("text-xs p-2 rounded-t-lg border-l-2 w-full text-left cursor-pointer hover:opacity-80 transition-opacity",a?"bg-blue-600/20 border-blue-400":"bg-gray-100 dark:bg-gray-800 border-gray-400"),children:[(0,t.jsx)("span",{className:"text-gray-500 text-[10px]",children:"â†© Replying to"}),(0,t.jsx)("p",{className:"truncate text-gray-700 dark:text-gray-300",children:e.replyTo.content})]}),(0,t.jsxs)("div",{className:(0,o.cn)("px-4 py-2 rounded-2xl relative",b&&"shadow-sm shadow-blue-400/15 transition-transform duration-150 hover:scale-[1.01]",a?"bg-blue-600 text-white rounded-br-sm":"bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-white rounded-bl-sm",e.replyTo&&"rounded-t-none"),children:[e.mediaUrl&&"image"===e.contentType&&(0,t.jsx)("button",{onClick:()=>u?.(e.mediaUrl),className:"block w-full text-left",children:(0,t.jsx)("img",{src:e.mediaUrl,alt:"Shared image",className:"rounded-lg max-w-full mb-2 cursor-pointer hover:opacity-90 transition-opacity",style:{maxHeight:"300px"}})}),e.mediaUrl&&"video"===e.contentType&&(0,t.jsxs)("div",{className:"relative group cursor-pointer mb-2",onClick:()=>h?.(e.mediaUrl),children:[(0,t.jsx)("video",{src:e.mediaUrl,className:"rounded-lg max-w-full",style:{maxHeight:"300px"}}),(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/30 group-hover:bg-black/40 transition-colors rounded-lg",children:(0,t.jsx)("div",{className:"w-14 h-14 rounded-full bg-white/90 flex items-center justify-center",children:(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-gray-900 ml-1",fill:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{d:"M8 5v14l11-7z"})})})})]}),e.mediaUrl&&"audio"===e.contentType&&(0,t.jsxs)("div",{className:(0,o.cn)("flex items-center gap-3 p-2 rounded-lg mb-2",a?"bg-blue-700/50":"bg-gray-200 dark:bg-gray-700"),children:[(0,t.jsx)("div",{className:"w-10 h-10 rounded-full bg-green-500 flex items-center justify-center",children:(0,t.jsx)("span",{className:"text-white text-lg",children:"ðŸŽ¤"})}),(0,t.jsx)("audio",{src:e.mediaUrl,controls:!0,className:"flex-1 h-8",style:{maxWidth:"200px"}})]}),e.mediaUrl&&"document"===e.contentType&&(0,t.jsxs)("a",{href:e.mediaUrl,target:"_blank",rel:"noopener noreferrer",className:(0,o.cn)("flex items-center gap-3 p-3 rounded-lg mb-2 transition-colors",a?"bg-blue-700/50 hover:bg-blue-700/70":"bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600"),children:[(0,t.jsx)("div",{className:"w-10 h-10 rounded-lg bg-red-500 flex items-center justify-center",children:(0,t.jsx)("span",{className:"text-white text-lg",children:"ðŸ“„"})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:(0,o.cn)("font-medium truncate text-sm",a?"text-white":"text-gray-900 dark:text-white"),children:e.fileName||"Document"}),e.fileSize&&(0,t.jsxs)("p",{className:(0,o.cn)("text-xs",a?"text-blue-200":"text-gray-500"),children:[(e.fileSize/1024).toFixed(1)," KB"]})]})]}),e.mediaUrl&&"file"===e.contentType&&(0,t.jsxs)("a",{href:e.mediaUrl,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 bg-white/10 p-2 rounded mb-2 hover:bg-white/20",children:[(0,t.jsx)("span",{children:"ðŸ“Ž"}),(0,t.jsx)("span",{className:"truncate",children:e.fileName||"File"})]}),"reel"===e.contentType&&(()=>{let r=null;try{r=JSON.parse(e.content).reelId||null}catch{let t=e.content?.match(/\/reels\/([a-f0-9-]+)/i);r=t?.[1]||null}let s=e.mediaUrl,l=r?`/reels/${r}`:"/reels";return(0,t.jsxs)("a",{href:l,onClick:e=>{e.preventDefault(),window.location.href=l},className:(0,o.cn)("block relative rounded-xl overflow-hidden w-24 h-36 flex-shrink-0 cursor-pointer hover:opacity-90 transition-opacity",a?"ring-2 ring-white/30":"ring-2 ring-gray-300 dark:ring-gray-600"),children:[s?(0,t.jsx)("img",{src:s,alt:"Reel",className:"w-full h-full object-cover"}):(0,t.jsx)("div",{className:(0,o.cn)("w-full h-full flex items-center justify-center",a?"bg-blue-700/50":"bg-gray-200 dark:bg-gray-700"),children:(0,t.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 opacity-70",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:[(0,t.jsx)("rect",{width:"18",height:"18",x:"3",y:"3",rx:"2"}),(0,t.jsx)("path",{d:"M7 3v18"}),(0,t.jsx)("path",{d:"M17 3v18"}),(0,t.jsx)("path",{d:"M3 12h18"})]})}),(0,t.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-8 bg-gradient-to-t from-black/60 to-transparent flex items-end justify-center pb-1",children:(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{d:"M8 5v14l11-7z"})})})]})})(),("post"===e.contentType||"application/x-shared-post"===e.contentType)&&(()=>{try{let r=JSON.parse(e.content),s=r.postId,l=r.postUrl||(s?`/post/${s}`:null);return(0,t.jsxs)("a",{href:l||"#",onClick:e=>{l&&(e.preventDefault(),window.location.href=l)},className:(0,o.cn)("block rounded-lg p-3 mb-2 cursor-pointer transition-colors",a?"bg-blue-700/50 hover:bg-blue-700/70":"bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600"),children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2 text-xs opacity-70",children:[(0,t.jsx)("span",{children:"ðŸ“„"}),(0,t.jsx)("span",{children:"Shared Post"})]}),r.mediaUrl&&(0,t.jsx)("img",{src:r.mediaUrl,alt:"Post media",className:"rounded-md w-full h-24 object-cover mb-2"}),r.author&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[r.author.profileImage&&(0,t.jsx)("img",{src:r.author.profileImage,alt:r.author.name,className:"w-6 h-6 rounded-full object-cover"}),(0,t.jsx)("p",{className:(0,o.cn)("font-medium text-sm",a?"text-white":"text-gray-900 dark:text-white"),children:r.author.name})]}),r.author.username&&(0,t.jsxs)("p",{className:(0,o.cn)("text-xs opacity-60",a?"text-blue-200":"text-gray-500"),children:["@",r.author.username]})]}),!r.author&&r.authorName&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:(0,o.cn)("font-medium text-sm",a?"text-white":"text-gray-900 dark:text-white"),children:r.authorName}),r.authorUsername&&(0,t.jsxs)("p",{className:(0,o.cn)("text-xs opacity-60",a?"text-blue-200":"text-gray-500"),children:["@",r.authorUsername]})]}),(r.preview||r.contentPreview)&&(0,t.jsx)("p",{className:(0,o.cn)("text-sm mt-1 line-clamp-2",a?"text-blue-100":"text-gray-600 dark:text-gray-300"),children:r.preview||r.contentPreview}),(0,t.jsx)("p",{className:"text-xs opacity-50 mt-2 italic",children:"Tap to view post â†’"})]})}catch{return(0,t.jsx)("p",{className:"break-words whitespace-pre-wrap",children:e.content})}})(),"post"!==e.contentType&&"reel"!==e.contentType&&(N?(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("input",{type:"text",value:T,onChange:e=>I(e.target.value),className:"flex-1 bg-white/20 rounded px-2 py-1 text-sm",autoFocus:!0,onKeyDown:e=>{"Enter"===e.key&&E(),"Escape"===e.key&&C(!1)}}),(0,t.jsx)("button",{onClick:E,className:"text-xs",children:"Save"})]}):(0,t.jsx)("p",{className:"break-words whitespace-pre-wrap",children:e.content})),!e.isDeleted&&e.isEdited&&(0,t.jsx)("span",{className:"text-xs opacity-60 ml-1",children:"(edited)"})]}),e.reactions&&e.reactions.length>0&&(0,t.jsx)("div",{className:(0,o.cn)("flex flex-wrap gap-1 mt-1",a?"justify-end":"justify-start"),children:Array.from(new Set(e.reactions.map(e=>e.emoji))).map(a=>{let r=e.reactions.filter(e=>e.emoji===a).length;return(0,t.jsxs)("button",{onClick:()=>L(a),className:"bg-gray-100 dark:bg-gray-800 px-2 py-0.5 rounded-full text-sm flex items-center gap-1 hover:bg-gray-200 dark:hover:bg-gray-700",children:[(0,t.jsx)("span",{children:a}),(0,t.jsx)("span",{className:"text-xs text-gray-500",children:r})]},a)})}),(0,t.jsxs)("div",{className:(0,o.cn)("text-xs text-gray-500 mt-1 flex items-center gap-1",a?"justify-end":"justify-start"),children:[(0,t.jsx)("span",{children:(0,m.format)(new Date(e.createdAt),"HH:mm")}),a&&(0,t.jsx)("span",{className:(0,o.cn)("READ"===e.status&&"text-blue-500"),children:"READ"===e.status||"DELIVERED"===e.status?"âœ“âœ“":"âœ“"})]}),(0,t.jsx)(D,{isVisible:f&&!N&&!v,isOwn:a,onReply:()=>x?.(),onReact:()=>k(!w),onMore:()=>j(!0)}),(0,t.jsx)(A,{isOpen:v,onClose:()=>j(!1),isOwn:a,messageContent:e.content,hasMedia:!!e.mediaUrl,mediaUrl:e.mediaUrl,onReply:()=>x?.(),onEdit:()=>C(!0),onDelete:t=>{(0,n.deleteChatMessage)(e.id,i,t),y(!1),j(!1)},onReact:L,onCopy:()=>{R(!0),setTimeout(()=>R(!1),2e3)},availableReactions:p,anchorPosition:a?"right":"left"}),w&&!v&&(0,t.jsx)("div",{className:(0,o.cn)("absolute -top-10 flex items-center gap-1 bg-white dark:bg-gray-900 shadow-lg rounded-full px-2 py-1",a?"right-0":"left-0"),children:p.map(e=>(0,t.jsx)("button",{onClick:()=>L(e),className:"hover:scale-125 transition-transform p-1",children:e},e))}),M&&(0,t.jsx)("div",{className:"absolute -top-8 left-1/2 -translate-x-1/2 bg-black/70 text-white text-xs px-2 py-1 rounded",children:"Copied!"})]})]})}e.s(["WALLPAPER_OPTIONS",()=>q,"default",()=>$],21790),e.s(["default",()=>W],55306);var G=e.i(83079);let X=(0,p.default)("Paperclip",[["path",{d:"M13.234 20.252 21 12.3",key:"1cbrk9"}],["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 0 2.828 2 2 0 0 0 2.828 0l8.414-8.586a4 4 0 0 0 0-5.656 4 4 0 0 0-5.656 0l-8.415 8.585a6 6 0 1 0 8.486 8.486",key:"1pkts6"}]]),Y=(0,p.default)("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);var Z=e.i(14764);let J=(0,p.default)("Smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]),Q=(0,p.default)("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);var ee=e.i(83086),et=e.i(31278),ea=e.i(79002),er=e.i(94983),es=e.i(39312);let el=(0,p.default)("MessageSquarePlus",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}],["path",{d:"M12 7v6",key:"lw1j43"}],["path",{d:"M9 10h6",key:"9gxzsh"}]]);var en=e.i(16715);let ei=(0,p.default)("SpellCheck",[["path",{d:"m6 16 6-12 6 12",key:"1b4byz"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"m16 20 2 2 4-4",key:"13tcca"}]]),eo=(0,p.default)("Languages",[["path",{d:"m5 8 6 6",key:"1wu5hv"}],["path",{d:"m4 14 6-6 2-3",key:"1k1g8d"}],["path",{d:"M2 5h12",key:"or177f"}],["path",{d:"M7 2h1",key:"1t2jsx"}],["path",{d:"m22 22-5-10-5 10",key:"don7ne"}],["path",{d:"M14 18h6",key:"1m8k6r"}]]),ed=(0,p.default)("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);var ec=e.i(47780),em=e.i(43531),eg=e.i(64659),ex=e.i(61238);async function eu(e){return ex.default.post("/ai/chat/conversation-starters",{otherUserId:e})}async function eh(e,t){return ex.default.post("/ai/chat/revival-suggestions",{conversationId:e,otherUserId:t})}async function ep(e,t){return ex.default.post("/ai/chat/fix-grammar",{message:e,context:t})}async function eb(e,t){return ex.default.post("/ai/chat/smart-replies",{lastMessage:e,conversationId:t})}async function ef(e,t){return ex.default.post("/ai/chat/change-tone",{message:e,tone:t})}async function ey(e,t){return ex.default.post("/ai/chat/translate",{message:e,targetLanguage:t})}async function ev(e,t){return ex.default.post("/ai/chat/expand",{message:e,context:t})}let ej=[{id:"starters",label:"Ice Breakers",icon:(0,t.jsx)(el,{className:"w-4 h-4"}),description:"Personalized conversation starters"},{id:"revival",label:"Continue Chat",icon:(0,t.jsx)(en.RefreshCw,{className:"w-4 h-4"}),description:"Revive a stalled conversation"},{id:"smart-reply",label:"Quick Reply",icon:(0,t.jsx)(es.Zap,{className:"w-4 h-4"}),description:"Smart reply suggestions",requiresReceivedMessage:!0},{id:"grammar",label:"Fix Grammar",icon:(0,t.jsx)(ei,{className:"w-4 h-4"}),description:"Fix grammar & spelling",requiresMessage:!0},{id:"tone",label:"Change Tone",icon:(0,t.jsx)(ec.Palette,{className:"w-4 h-4"}),description:"Rewrite in different tone",requiresMessage:!0},{id:"translate",label:"Translate",icon:(0,t.jsx)(eo,{className:"w-4 h-4"}),description:"Translate to another language",requiresMessage:!0},{id:"expand",label:"Expand",icon:(0,t.jsx)(ed,{className:"w-4 h-4"}),description:"Expand short message",requiresMessage:!0}],ew=[{value:"professional",label:"Professional",emoji:"ðŸ’¼"},{value:"casual",label:"Casual",emoji:"ðŸ˜Ž"},{value:"friendly",label:"Friendly",emoji:"ðŸ¤—"},{value:"formal",label:"Formal",emoji:"ðŸŽ©"},{value:"enthusiastic",label:"Enthusiastic",emoji:"ðŸ”¥"},{value:"concise",label:"Concise",emoji:"âš¡"}],ek=[{value:"english",label:"English"},{value:"hindi",label:"Hindi"},{value:"telugu",label:"Telugu"},{value:"hinglish",label:"Hinglish"},{value:"tenglish",label:"Tenglish"}];function eN({conversationId:e,otherUserId:a,otherUserName:s,currentMessage:l,lastReceivedMessage:n,onSuggestionSelect:i,onClose:d}){let[c,m]=(0,r.useState)(null),[g,x]=(0,r.useState)(!1),[p,b]=(0,r.useState)(null),[f,y]=(0,r.useState)([]),[v,j]=(0,r.useState)("casual"),[w,k]=(0,r.useState)("english"),[N,C]=(0,r.useState)(!1),[S,T]=(0,r.useState)(!1),I=async e=>{ej.find(t=>t.id===e)?.requiresMessage&&!l.trim()?b("Please type a message first"):ej.find(t=>t.id===e)?.requiresReceivedMessage&&!n?b("No message to reply to"):(m(e),b(null),y([]),"tone"!==e&&"translate"!==e&&await M(e))},M=async(t,r)=>{x(!0),b(null);try{let s=[];switch(t){case"starters":s=(await eu(a)).suggestions;break;case"revival":s=(await eh(e,a)).suggestions;break;case"grammar":{let e=await ep(l);s=[e.corrected,...e.alternatives];break}case"smart-reply":s=(await eb(n||"",e)).suggestions;break;case"tone":s=[(await ef(l,r?.tone||v)).result];break;case"translate":s=[(await ey(l,r?.language||w)).translated];break;case"expand":s=[(await ev(l)).expanded]}y(s)}catch(e){console.error("AI suggestion error:",e),b(e.response?.data?.error||"Failed to generate suggestions")}finally{x(!1)}},R=async e=>{j(e),C(!1),await M("tone",{tone:e})},A=async e=>{k(e),T(!1),await M("translate",{language:e})};return(0,t.jsxs)(u.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"absolute bottom-full left-0 right-0 mb-3 mx-0 bg-white dark:bg-gray-800 rounded-2xl shadow-2xl border border-gray-200 dark:border-gray-700 overflow-hidden z-50",style:{maxHeight:"calc(100vh - 200px)"},children:[(0,t.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-purple-50 to-blue-50 dark:from-purple-900/20 dark:to-blue-900/20",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center",children:(0,t.jsx)(ee.Sparkles,{className:"w-4 h-4 text-white"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-semibold text-sm text-gray-900 dark:text-white",children:"AI Assistant"}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:c?ej.find(e=>e.id===c)?.description:"Choose an action"})]})]}),(0,t.jsx)("button",{onClick:d,className:"p-1.5 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors",children:(0,t.jsx)(E.X,{className:"w-4 h-4 text-gray-500"})})]}),(0,t.jsx)("div",{className:"p-3 max-h-80 overflow-y-auto",children:(0,t.jsx)(h.AnimatePresence,{mode:"wait",children:c?(0,t.jsxs)(u.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[(0,t.jsxs)("button",{onClick:()=>{m(null),y([]),b(null)},className:"flex items-center gap-1 text-sm text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 mb-3",children:[(0,t.jsx)(eg.ChevronDown,{className:"w-4 h-4 rotate-90"}),"Back to options"]}),"tone"===c&&(0,t.jsxs)("div",{className:"mb-3 relative",children:[(0,t.jsxs)("button",{onClick:()=>C(!N),className:"w-full flex items-center justify-between px-4 py-2.5 bg-gray-100 dark:bg-gray-700 rounded-xl text-sm",children:[(0,t.jsxs)("span",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{children:ew.find(e=>e.value===v)?.emoji}),(0,t.jsx)("span",{children:ew.find(e=>e.value===v)?.label})]}),(0,t.jsx)(eg.ChevronDown,{className:(0,o.cn)("w-4 h-4 transition-transform",N&&"rotate-180")})]}),N&&(0,t.jsx)("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden z-10",children:ew.map(e=>(0,t.jsxs)("button",{onClick:()=>R(e.value),className:"w-full flex items-center gap-2 px-4 py-2.5 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 text-left",children:[(0,t.jsx)("span",{children:e.emoji}),(0,t.jsx)("span",{children:e.label}),v===e.value&&(0,t.jsx)(em.Check,{className:"w-4 h-4 ml-auto text-green-500"})]},e.value))})]}),"translate"===c&&(0,t.jsxs)("div",{className:"mb-3 relative",children:[(0,t.jsxs)("button",{onClick:()=>T(!S),className:"w-full flex items-center justify-between px-4 py-2.5 bg-gray-100 dark:bg-gray-700 rounded-xl text-sm",children:[(0,t.jsx)("span",{children:ek.find(e=>e.value===w)?.label}),(0,t.jsx)(eg.ChevronDown,{className:(0,o.cn)("w-4 h-4 transition-transform",S&&"rotate-180")})]}),S&&(0,t.jsx)("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden z-10",children:ek.map(e=>(0,t.jsxs)("button",{onClick:()=>A(e.value),className:"w-full flex items-center gap-2 px-4 py-2.5 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 text-left",children:[(0,t.jsx)("span",{children:e.label}),w===e.value&&(0,t.jsx)(em.Check,{className:"w-4 h-4 ml-auto text-green-500"})]},e.value))})]}),g&&(0,t.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,t.jsx)(et.Loader2,{className:"w-6 h-6 animate-spin text-blue-500"}),(0,t.jsx)("span",{className:"ml-2 text-sm text-gray-500",children:"Generating suggestions..."})]}),p&&(0,t.jsxs)("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 rounded-xl text-center",children:[(0,t.jsx)("p",{className:"text-sm text-red-600 dark:text-red-400",children:p}),(0,t.jsx)("button",{onClick:()=>M(c),className:"mt-2 text-sm text-blue-600 hover:underline",children:"Try again"})]}),!g&&!p&&f.length>0&&(0,t.jsx)("div",{className:"space-y-2",children:f.map((e,a)=>(0,t.jsxs)(u.motion.button,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.1*a},onClick:()=>{i(e),d?.()},className:(0,o.cn)("w-full p-3 text-left rounded-xl transition-all","bg-gray-50 dark:bg-gray-700/50 hover:bg-gray-100 dark:hover:bg-gray-700","hover:shadow-md hover:scale-[1.01]","border border-transparent hover:border-blue-200 dark:hover:border-blue-800"),children:[(0,t.jsx)("p",{className:"text-sm text-gray-800 dark:text-gray-200 leading-relaxed",children:e}),0===a&&"grammar"===c&&(0,t.jsxs)("span",{className:"inline-flex items-center gap-1 mt-1 text-xs text-green-600 dark:text-green-400",children:[(0,t.jsx)(em.Check,{className:"w-3 h-3"}),"Best correction"]})]},a))}),!g&&f.length>0&&"tone"!==c&&"translate"!==c&&(0,t.jsxs)("button",{onClick:()=>M(c),className:"w-full mt-3 flex items-center justify-center gap-2 py-2.5 text-sm text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl transition-colors",children:[(0,t.jsx)(en.RefreshCw,{className:"w-4 h-4"}),"Generate new suggestions"]})]},"suggestions"):(0,t.jsx)(u.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"grid grid-cols-2 gap-2",children:ej.map(e=>{let a=e.requiresMessage&&!l.trim()||e.requiresReceivedMessage&&!n;return(0,t.jsxs)("button",{onClick:()=>I(e.id),disabled:a,className:(0,o.cn)("flex items-center gap-3 p-3 rounded-xl text-left transition-all",a?"opacity-50 cursor-not-allowed bg-gray-50 dark:bg-gray-800":"hover:bg-gray-100 dark:hover:bg-gray-700 bg-gray-50 dark:bg-gray-800/50 hover:scale-[1.02]"),children:[(0,t.jsx)("div",{className:(0,o.cn)("w-9 h-9 rounded-xl flex items-center justify-center","starters"===e.id&&"bg-green-100 dark:bg-green-900/30 text-green-600","revival"===e.id&&"bg-orange-100 dark:bg-orange-900/30 text-orange-600","smart-reply"===e.id&&"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-600","grammar"===e.id&&"bg-blue-100 dark:bg-blue-900/30 text-blue-600","tone"===e.id&&"bg-purple-100 dark:bg-purple-900/30 text-purple-600","translate"===e.id&&"bg-pink-100 dark:bg-pink-900/30 text-pink-600","expand"===e.id&&"bg-cyan-100 dark:bg-cyan-900/30 text-cyan-600"),children:e.icon}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"font-medium text-sm text-gray-900 dark:text-white truncate",children:e.label}),(0,t.jsx)("p",{className:"text-xs text-gray-500 truncate",children:e.description})]})]},e.id)})},"features")})}),(0,t.jsx)("div",{className:"px-4 py-2 bg-gray-50 dark:bg-gray-900/50 border-t border-gray-200 dark:border-gray-700",children:(0,t.jsx)("p",{className:"text-xs text-gray-500 text-center",children:l.trim()?`Message: "${l.slice(0,30)}${l.length>30?"...":""}"`:"Type a message to use grammar, tone, or translate features"})})]})}let eC={image:["image/jpeg","image/png","image/gif","image/webp"],video:["video/mp4","video/webm","video/quicktime"],document:["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],audio:["audio/mpeg","audio/wav","audio/ogg","audio/webm"]};function eS({conversationId:a,currentUserId:s,replyTo:i,onCancelReply:d,disabled:c=!1,onUploadingMessagesChange:m,onOptimisticMessage:g,otherUserId:x,otherUserName:p,lastReceivedMessage:b,enabledMessageEffects:f}){let[j,w]=(0,r.useState)(""),[k,N]=(0,r.useState)(!1),[C,S]=(0,r.useState)(!1),[T,I]=(0,r.useState)(!1),[M,R]=(0,r.useState)(!1),[A,D]=(0,r.useState)(!1),[P,F]=(0,r.useState)([]),[O,z]=(0,r.useState)(!1),[V,q]=(0,r.useState)(0),[$,H]=(0,r.useState)(null),[W,K]=(0,r.useState)([]),[el,en]=(0,r.useState)(null),[ei,eo]=(0,r.useState)(!1),[ed,ec]=(0,r.useState)(!1),[em,eg]=(0,r.useState)(!1),[ex,eu]=(0,r.useState)("none"),eh=(0,r.useRef)(null),eb=(0,r.useRef)(null),ef=(0,r.useRef)(null),ey=(0,r.useRef)(null),ev=(0,r.useRef)(null),ej=(0,r.useRef)([]),ew=(0,r.useRef)(null);(0,r.useEffect)(()=>{(async()=>{if(x)try{let e=await (0,l.getMessageLimitStatus)(x);en(e),e.isConnected||e.canSend||eo(!0)}catch(e){console.error("Failed to check message limit:",e)}})()},[a,x]);let ek=(0,r.useMemo)(()=>[...f?.confetti?["confetti"]:[],...f?.fireworks?["fireworks"]:[]],[f?.confetti,f?.fireworks]);(0,r.useEffect)(()=>{"none"!==ex&&(ek.includes(ex)||eu("none"))},[ek,ex]);let eS=(0,r.useCallback)(async t=>{try{let a=(await e.A(80233)).default;if("confetti"===t)return void a({particleCount:60,spread:55,origin:{y:.7},colors:["#22c55e","#38bdf8","#f59e0b","#f43f5e"]});a({particleCount:80,spread:70,origin:{x:.2,y:.7},colors:["#f97316","#facc15","#fb7185","#60a5fa"]}),a({particleCount:80,spread:70,origin:{x:.8,y:.7},colors:["#f97316","#facc15","#fb7185","#60a5fa"]})}catch{}},[]),eT=(0,r.useCallback)(()=>{if(f?.voiceSfx)try{let e=window.AudioContext||window.webkitAudioContext;if(!e)return;let t=new e,a=t.createOscillator(),r=t.createGain();a.type="triangle",a.frequency.setValueAtTime(660,t.currentTime),a.frequency.exponentialRampToValueAtTime(440,t.currentTime+.12),r.gain.setValueAtTime(1e-4,t.currentTime),r.gain.exponentialRampToValueAtTime(.12,t.currentTime+.01),r.gain.exponentialRampToValueAtTime(1e-4,t.currentTime+.14),a.connect(r),r.connect(t.destination),a.start(),a.stop(t.currentTime+.14)}catch{}},[f?.voiceSfx]),eI=async()=>{if(x&&!ed){ec(!0);try{await (0,G.sendConnectionRequest)(x),eg(!0)}catch(t){console.error("Failed to send connection request:",t);let e=t instanceof Error?t.message:"";e.includes("already")||e.includes("pending")?eg(!0):alert("Failed to send connection request. Please try again.")}finally{ec(!1)}}};(0,r.useEffect)(()=>{eh.current&&(eh.current.style.height="auto",eh.current.style.height=`${Math.min(eh.current.scrollHeight,120)}px`)},[j]),(0,r.useEffect)(()=>{let e=e=>{ey.current&&!ey.current.contains(e.target)&&I(!1)};return T&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[T]);let eM=(0,r.useCallback)(()=>{k||(N(!0),(0,n.sendChatTyping)(a,!0)),ef.current&&clearTimeout(ef.current),ef.current=setTimeout(()=>{N(!1),(0,n.sendChatTyping)(a,!1)},2e3)},[a,k]);(0,r.useEffect)(()=>()=>{ef.current&&clearTimeout(ef.current)},[]);let eR=e=>{for(let[t,a]of Object.entries(eC))if(a.includes(e.type))return t;return null},eA=e=>new Promise(t=>{let a=document.createElement("video");a.preload="metadata",a.onloadedmetadata=()=>{URL.revokeObjectURL(a.src),a.duration>60?(alert(`Video "${e.name}" is too long. Maximum duration is 60 seconds.`),t(!1)):t(!0)},a.onerror=()=>{URL.revokeObjectURL(a.src),t(!0)},a.src=URL.createObjectURL(e)}),eD=async e=>{let t=Array.from(e.target.files||[]),a=[];for(let e of t){if(e.size>0x3200000){alert(`File "${e.name}" is too large. Maximum size is 50MB.`);continue}let t=eR(e);if(!t){alert(`File type not supported: ${e.name}`);continue}if("video"===t&&!await eA(e))continue;let r="";("image"===t||"video"===t)&&(r=URL.createObjectURL(e)),a.push({file:e,preview:r,type:t})}F(e=>[...e,...a]),I(!1),eb.current&&(eb.current.value="")},eE=e=>{eb.current&&(eb.current.accept=e,eb.current.click()),I(!1)},eL=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:!0}),t=new MediaRecorder(e,{mimeType:"audio/webm"});ev.current=t,ej.current=[],t.ondataavailable=e=>{e.data.size>0&&ej.current.push(e.data)},t.onstop=()=>{let t=new Blob(ej.current,{type:"audio/webm"});H(t),e.getTracks().forEach(e=>e.stop())},t.start(),z(!0),q(0),ew.current=setInterval(()=>{q(e=>e+1)},1e3)}catch(e){console.error("Failed to start recording:",e),alert("Could not access microphone. Please grant permission.")}},e_=e=>{let t=Math.floor(e/60);return`${t}:${(e%60).toString().padStart(2,"0")}`};(0,r.useEffect)(()=>{m?.(W)},[W,m]);let eU=async()=>{let e=j.trim(),t=P.length>0,r=null!==$;if(!e&&!t&&!r)return;if(el&&!el.isConnected&&!el.canSend)return void eo(!0);ef.current&&(clearTimeout(ef.current),ef.current=null),N(!1),(0,n.sendChatTyping)(a,!1),el&&!el.isConnected&&en(e=>e?{...e,messagesSent:e.messagesSent+1,messagesRemaining:Math.max(0,e.messagesRemaining-1),canSend:e.messagesRemaining>1}:null);let o=[...P];if(w(""),F([]),H(null),q(0),d?.(),eh.current?.focus(),r&&$){let e=`upload-audio-${Date.now()}`;K(t=>[...t,{id:e,type:"audio",fileName:"Voice message",progress:0}]);try{let t=new globalThis.File([$],`voice-${Date.now()}.webm`,{type:"audio/webm"}),r=await (0,l.uploadChatMedia)(t,"audio",t=>{K(a=>a.map(a=>a.id===e?{...a,progress:t}:a))});K(t=>t.filter(t=>t.id!==e)),(0,n.sendChatMessage)({conversationId:a,content:"ðŸŽ¤ Voice message",contentType:"audio",mediaUrl:r.mediaUrl,fileName:r.fileName,fileSize:r.fileSize,replyToId:i?.id}),eT()}catch(t){console.error("Failed to upload audio:",t),K(t=>t.filter(t=>t.id!==e)),alert("Failed to send voice message")}}t&&Promise.all(o.map(async(e,t)=>{let r=`upload-${Date.now()}-${t}`;K(t=>[...t,{id:r,type:e.type,preview:e.preview,fileName:e.file.name,progress:0}]);try{let s=await (0,l.uploadChatMedia)(e.file,e.type,e=>{K(t=>t.map(t=>t.id===r?{...t,progress:e}:t))});K(e=>e.filter(e=>e.id!==r)),(0,n.sendChatMessage)({conversationId:a,content:"image"===e.type?"ðŸ“· Photo":"video"===e.type?"ðŸŽ¥ Video":"document"===e.type?`ðŸ“„ ${e.file.name}`:`ðŸ“Ž ${e.file.name}`,contentType:e.type,mediaUrl:s.mediaUrl,fileName:s.fileName,fileSize:s.fileSize,replyToId:0===t?i?.id:void 0}),e.preview&&URL.revokeObjectURL(e.preview)}catch(t){console.error("Failed to upload file:",t),K(e=>e.filter(e=>e.id!==r)),alert(`Failed to send ${e.file.name}`)}})),e&&(g&&s&&g({id:`optimistic-${Date.now()}`,conversationId:a,senderId:s,content:e,contentType:"text",replyToId:i?.id,replyTo:i?{id:i.id,content:i.content,senderName:i.senderName}:void 0,status:"SENDING",createdAt:new Date().toISOString()}),(0,n.sendChatMessage)({conversationId:a,content:e,contentType:"text",replyToId:i?.id}),"none"!==ex&&eS(ex))},eP=async()=>{if(j.trim()&&!A){D(!0);try{let e=await ep(j);w(e.corrected),eh.current?.focus()}catch(e){console.error("Grammar fix error:",e)}finally{D(!1)}}};return(0,t.jsxs)("div",{className:"relative border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 p-4",children:[(0,t.jsx)(h.AnimatePresence,{children:M&&x&&(0,t.jsx)(eN,{conversationId:a,otherUserId:x,otherUserName:p||"User",currentMessage:j,lastReceivedMessage:b,onSuggestionSelect:e=>{w(e),R(!1),eh.current?.focus()},onClose:()=>R(!1)})}),(0,t.jsx)(h.AnimatePresence,{children:ei&&el&&!el.isConnected&&!el.canSend&&(0,t.jsx)(u.motion.div,{initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:20,scale:.95},className:"absolute bottom-full left-0 right-0 mb-2 mx-4",children:(0,t.jsx)("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/30 dark:to-indigo-900/30 border border-blue-200 dark:border-blue-700 rounded-xl p-4 shadow-lg",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"flex-shrink-0 w-10 h-10 rounded-full bg-blue-100 dark:bg-blue-800 flex items-center justify-center",children:(0,t.jsx)(B.Lock,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("h4",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-1",children:"Connect to Continue Messaging"}),(0,t.jsxs)("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-3",children:["You've sent ",el.messagesSent," of ",el.limit," messages. Connect with ",(0,t.jsx)("span",{className:"font-medium",children:p||"this user"})," to send unlimited messages."]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[em?(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-green-600 dark:text-green-400",children:[(0,t.jsx)("div",{className:"w-5 h-5 rounded-full bg-green-100 dark:bg-green-800 flex items-center justify-center",children:(0,t.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),(0,t.jsx)("span",{className:"font-medium",children:"Connection request sent!"})]}):(0,t.jsx)("button",{onClick:eI,disabled:ed,className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-white text-sm font-medium rounded-lg transition-colors",children:ed?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(et.Loader2,{className:"w-4 h-4 animate-spin"}),"Sending..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ea.UserPlus,{className:"w-4 h-4"}),"Send Connection Request"]})}),(0,t.jsx)("button",{onClick:()=>eo(!1),className:"px-3 py-2 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors",children:"Dismiss"})]})]}),(0,t.jsx)("button",{onClick:()=>eo(!1),className:"flex-shrink-0 p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors",children:(0,t.jsx)(E.X,{className:"w-4 h-4"})})]})})})}),(0,t.jsx)(h.AnimatePresence,{children:el&&!el.isConnected&&el.canSend&&1===el.messagesRemaining&&(0,t.jsx)(u.motion.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mb-3 overflow-hidden",children:(0,t.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-700 rounded-lg",children:[(0,t.jsx)(er.MessageCircle,{className:"w-4 h-4 text-amber-600 dark:text-amber-400 flex-shrink-0"}),(0,t.jsxs)("p",{className:"text-xs text-amber-700 dark:text-amber-300",children:[(0,t.jsx)("span",{className:"font-medium",children:"Last message!"})," Connect with ",p||"this user"," to continue the conversation."]}),(0,t.jsx)("button",{onClick:eI,disabled:ed||em,className:"ml-auto text-xs font-medium text-amber-700 dark:text-amber-300 hover:text-amber-800 dark:hover:text-amber-200 underline disabled:opacity-50",children:em?"Request Sent":"Connect"})]})})}),(0,t.jsx)("input",{ref:eb,type:"file",multiple:!0,onChange:eD,className:"hidden"}),(0,t.jsx)(h.AnimatePresence,{children:P.length>0&&(0,t.jsx)(u.motion.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"mb-3 overflow-hidden",children:(0,t.jsx)("div",{className:"flex gap-2 overflow-x-auto py-2",children:P.map((e,a)=>(0,t.jsxs)("div",{className:"relative flex-shrink-0 w-20 h-20 rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-800 border border-gray-200 dark:border-gray-700",children:["image"===e.type?(0,t.jsx)("img",{src:e.preview,alt:e.file.name,className:"w-full h-full object-cover"}):(0,t.jsxs)("div",{className:"w-full h-full flex flex-col items-center justify-center p-1",children:["video"===e.type&&(0,t.jsx)(U.Video,{className:"w-6 h-6 text-gray-500"}),"document"===e.type&&(0,t.jsx)(_.FileText,{className:"w-6 h-6 text-gray-500"}),"audio"===e.type&&(0,t.jsx)(Y,{className:"w-6 h-6 text-gray-500"}),(0,t.jsxs)("span",{className:"text-[10px] text-gray-500 truncate w-full text-center mt-1",children:[e.file.name.slice(0,10),"..."]})]}),(0,t.jsx)("button",{onClick:()=>{F(e=>{let t=[...e];return t[a].preview&&URL.revokeObjectURL(t[a].preview),t.splice(a,1),t})},className:"absolute top-1 right-1 w-5 h-5 bg-red-500 text-white rounded-full flex items-center justify-center hover:bg-red-600",children:(0,t.jsx)(E.X,{className:"w-3 h-3"})})]},a))})})}),i&&(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2 p-2 bg-gray-100 dark:bg-gray-800 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 min-w-0",children:[(0,t.jsx)("div",{className:"w-1 h-8 bg-blue-500 rounded-full"}),(0,t.jsxs)("div",{className:"min-w-0",children:[(0,t.jsxs)("p",{className:"text-xs text-blue-600 dark:text-blue-400 font-medium",children:["Replying to ",i.senderName]}),(0,t.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 truncate",children:i.content})]})]}),(0,t.jsx)("button",{onClick:d,className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded",children:(0,t.jsx)(E.X,{className:"w-4 h-4"})})]}),(0,t.jsxs)("div",{className:"flex items-end gap-2",children:[(0,t.jsxs)("div",{className:"relative",ref:ey,children:[(0,t.jsx)("button",{onClick:()=>I(!T),className:(0,o.cn)("p-2 rounded-full transition-colors",T?"bg-blue-100 dark:bg-blue-900/30 text-blue-600":"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800"),title:"Attach file",children:(0,t.jsx)(X,{className:"w-5 h-5"})}),(0,t.jsx)(h.AnimatePresence,{children:T&&(0,t.jsx)(u.motion.div,{initial:{opacity:0,y:10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.95},className:"absolute bottom-full left-0 mb-2 w-48 bg-white dark:bg-gray-800 shadow-xl rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden z-20",children:(0,t.jsxs)("div",{className:"p-2 space-y-1",children:[(0,t.jsxs)("button",{onClick:()=>eE("image/*"),className:"w-full flex items-center gap-3 px-3 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:[(0,t.jsx)("div",{className:"w-8 h-8 rounded-full bg-purple-100 dark:bg-purple-900/30 flex items-center justify-center",children:(0,t.jsx)(L.Image,{className:"w-4 h-4 text-purple-600"})}),(0,t.jsx)("span",{children:"Photos"})]}),(0,t.jsxs)("button",{onClick:()=>eE("video/*"),className:"w-full flex items-center gap-3 px-3 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:[(0,t.jsx)("div",{className:"w-8 h-8 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center",children:(0,t.jsx)(U.Video,{className:"w-4 h-4 text-red-600"})}),(0,t.jsx)("span",{children:"Videos"})]}),(0,t.jsxs)("button",{onClick:()=>eE(".pdf,.doc,.docx"),className:"w-full flex items-center gap-3 px-3 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:[(0,t.jsx)("div",{className:"w-8 h-8 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center",children:(0,t.jsx)(_.FileText,{className:"w-4 h-4 text-blue-600"})}),(0,t.jsx)("span",{children:"Documents"})]}),(0,t.jsxs)("button",{onClick:()=>{I(!1),eL()},className:"w-full flex items-center gap-3 px-3 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:[(0,t.jsx)("div",{className:"w-8 h-8 rounded-full bg-orange-100 dark:bg-orange-900/30 flex items-center justify-center",children:(0,t.jsx)(Y,{className:"w-4 h-4 text-orange-600"})}),(0,t.jsx)("span",{children:"Voice Mail"})]})]})})})]}),x&&(0,t.jsx)("button",{onClick:()=>{R(!M),S(!1),I(!1)},className:(0,o.cn)("p-2 rounded-full transition-colors",M?"bg-gradient-to-br from-purple-100 to-blue-100 dark:from-purple-900/30 dark:to-blue-900/30 text-purple-600":"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800"),title:"AI Assistant",children:(0,t.jsx)(ee.Sparkles,{className:"w-5 h-5"})}),ek.length>0&&(0,t.jsxs)("button",{onClick:()=>{let e=["none",...ek];if(e.length<=1)return;let t=e.indexOf(ex),a=-1===t?0:(t+1)%e.length;eu(e[a])},className:(0,o.cn)("p-2 rounded-full transition-colors relative","none"!==ex?"bg-orange-100 dark:bg-orange-900/30 text-orange-600":"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800"),title:"none"===ex?"Message effect: Off (tap to cycle)":`Message effect: ${ex} (tap to cycle)`,children:[(0,t.jsx)(es.Zap,{className:"w-5 h-5"}),"none"!==ex&&(0,t.jsx)("span",{className:"absolute -bottom-1.5 left-1/2 -translate-x-1/2 px-1 py-0.5 rounded bg-orange-600 text-white text-[9px] leading-none uppercase tracking-wide",children:"confetti"===ex?"C":"F"})]}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("button",{onClick:()=>S(!C),className:(0,o.cn)("p-2 rounded-full transition-colors",C?"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-600":"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800"),title:"Add emoji",children:(0,t.jsx)(J,{className:"w-5 h-5"})}),(0,t.jsx)(h.AnimatePresence,{children:C&&(0,t.jsx)(u.motion.div,{initial:{opacity:0,y:10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.95},className:"absolute bottom-full left-0 mb-2 p-3 bg-white dark:bg-gray-800 shadow-xl rounded-xl border border-gray-200 dark:border-gray-700 z-20",children:(0,t.jsx)("div",{className:"grid grid-cols-5 gap-1 w-[200px]",children:["ðŸ˜€","ðŸ˜‚","â¤ï¸","ðŸ‘","ðŸ”¥","ðŸŽ‰","ðŸ˜Š","ðŸ™","ðŸ’¯","âœ¨","ðŸ˜","ðŸ¤”","ðŸ‘€","ðŸ™Œ","ðŸ’ª"].map(e=>(0,t.jsx)("button",{onClick:()=>{w(t=>t+e),S(!1),eh.current?.focus()},className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg text-xl transition-transform hover:scale-110",children:e},e))})})})]}),O?(0,t.jsxs)("div",{className:"flex-1 flex items-center gap-3 px-4 py-2.5 bg-red-50 dark:bg-red-900/20 rounded-2xl",children:[(0,t.jsx)("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}),(0,t.jsx)("span",{className:"text-red-600 dark:text-red-400 font-medium",children:e_(V)}),(0,t.jsx)("span",{className:"text-sm text-gray-500 flex-1",children:"Recording..."}),(0,t.jsx)("button",{onClick:()=>{ev.current&&ev.current.stream.getTracks().forEach(e=>e.stop()),z(!1),H(null),q(0),ew.current&&(clearInterval(ew.current),ew.current=null)},className:"p-2 text-gray-500 hover:text-red-500 hover:bg-red-100 dark:hover:bg-red-900/30 rounded-full transition-colors",title:"Cancel",children:(0,t.jsx)(v.Trash2,{className:"w-5 h-5"})}),(0,t.jsx)("button",{onClick:()=>{ev.current&&O&&(ev.current.stop(),z(!1),ew.current&&(clearInterval(ew.current),ew.current=null))},className:"p-2 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors",title:"Stop recording",children:(0,t.jsx)(Q,{className:"w-4 h-4"})})]}):$?(0,t.jsxs)("div",{className:"flex-1 flex items-center gap-3 px-4 py-2.5 bg-green-50 dark:bg-green-900/20 rounded-2xl",children:[(0,t.jsx)(Y,{className:"w-5 h-5 text-green-600"}),(0,t.jsxs)("span",{className:"text-sm text-green-700 dark:text-green-400 flex-1",children:["Voice message (",e_(V),")"]}),(0,t.jsx)("button",{onClick:()=>{H(null),q(0)},className:"p-1.5 text-gray-500 hover:text-red-500 hover:bg-red-100 dark:hover:bg-red-900/30 rounded-full transition-colors",title:"Delete recording",children:(0,t.jsx)(E.X,{className:"w-4 h-4"})})]}):(0,t.jsx)("div",{className:"flex-1 relative",children:(0,t.jsx)("textarea",{ref:eh,value:j,onChange:e=>{w(e.target.value),eM()},onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),eU())},placeholder:"Type a message...",disabled:c,rows:1,className:(0,o.cn)("w-full resize-none rounded-2xl px-4 py-2.5","bg-gray-100 dark:bg-gray-800","border border-transparent focus:border-blue-500","focus:outline-none focus:ring-2 focus:ring-blue-500/20","text-gray-900 dark:text-white placeholder-gray-500","disabled:opacity-50 disabled:cursor-not-allowed","max-h-32")})}),j.trim()||0!==P.length||$||O?(0,t.jsxs)(t.Fragment,{children:[j.trim()&&x&&(0,t.jsx)("button",{onClick:eP,disabled:A||c,className:(0,o.cn)("p-3 rounded-full transition-all","bg-purple-100 dark:bg-purple-900/30 text-purple-600 hover:bg-purple-200 dark:hover:bg-purple-800/40","disabled:opacity-50 disabled:cursor-not-allowed"),title:"Fix grammar with AI",children:A?(0,t.jsx)(et.Loader2,{className:"w-5 h-5 animate-spin"}):(0,t.jsx)(y.Pencil,{className:"w-5 h-5"})}),(0,t.jsx)("button",{onClick:eU,disabled:!j.trim()&&0===P.length&&!$||c||O,className:(0,o.cn)("p-3 rounded-full transition-all",j.trim()||P.length>0||$?"bg-blue-600 text-white hover:bg-blue-700 scale-100":"bg-gray-200 dark:bg-gray-700 text-gray-400 scale-95","disabled:opacity-50 disabled:cursor-not-allowed"),children:(0,t.jsx)(Z.Send,{className:"w-5 h-5"})})]}):(0,t.jsx)("button",{onClick:eL,disabled:c,className:(0,o.cn)("p-3 rounded-full transition-all","bg-gray-200 dark:bg-gray-700 text-gray-500 hover:bg-gray-300 dark:hover:bg-gray-600","disabled:opacity-50 disabled:cursor-not-allowed"),title:"Record voice message",children:(0,t.jsx)(Y,{className:"w-5 h-5"})})]})]})}e.s(["default",()=>eS],19684);var eT=e.i(22016),eI=e.i(78244),eM=e.i(23585);function eR(e){let s,l,o,d,c,m,g,x,u,h,p,b,f,y,v,j,w,k,N,C,S,T,I,M,R,A,D,E=(0,a.c)(63),{user:L,conversationId:_,onBack:U,onInfo:P}=e,[F,O]=(0,r.useState)(L.isOnline||!1),[V,B]=(0,r.useState)(L.lastActiveAt),[q,$]=(0,r.useState)(!1),[H,W]=(0,r.useState)(!1),K=(0,r.useRef)(null);E[0]===Symbol.for("react.memo_cache_sentinel")?(s=()=>{let e=e=>{K.current&&!K.current.contains(e.target)&&$(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},l=[],E[0]=s,E[1]=l):(s=E[0],l=E[1]),(0,r.useEffect)(s,l),E[2]!==L.id?(o=()=>{let e=(0,n.getSocket)();if(!e)return;let t=e=>{e.userId===L.id&&O(!0)},a=e=>{e.userId===L.id&&(O(!1),B(new Date().toISOString()))},r=e=>{e.userId===L.id&&(O(e.isOnline),e.isOnline||B(new Date().toISOString()))};return e.on("user:online",t),e.on("user:offline",a),e.on("user:status",r),()=>{e.off("user:online",t),e.off("user:offline",a),e.off("user:status",r)}},d=[L.id],E[2]=L.id,E[3]=o,E[4]=d):(o=E[3],d=E[4]),(0,r.useEffect)(o,d),E[5]!==L.isOnline||E[6]!==L.lastActiveAt?(c=()=>{O(L.isOnline||!1),B(L.lastActiveAt)},m=[L.isOnline,L.lastActiveAt],E[5]=L.isOnline,E[6]=L.lastActiveAt,E[7]=c,E[8]=m):(c=E[7],m=E[8]),(0,r.useEffect)(c,m),E[9]!==U?(g=U&&(0,t.jsx)("button",{onClick:U,className:"p-2 -ml-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full md:hidden",children:(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),E[9]=U,E[10]=g):g=E[10];let G=`/profile/${L.username}`;E[11]!==L.name||E[12]!==L.profileImage?(x=L.profileImage?(0,t.jsx)("img",{src:L.profileImage,alt:L.name,className:"w-10 h-10 rounded-full object-cover"}):L.name.charAt(0).toUpperCase(),E[11]=L.name,E[12]=L.profileImage,E[13]=x):x=E[13],E[14]!==x?(u=(0,t.jsx)("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center text-white font-semibold",children:x}),E[14]=x,E[15]=u):u=E[15],E[16]!==F?(h=F&&(0,t.jsx)("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white dark:border-gray-900"}),E[16]=F,E[17]=h):h=E[17],E[18]!==u||E[19]!==h||E[20]!==G?(p=(0,t.jsxs)(eT.default,{href:G,className:"relative flex-shrink-0",children:[u,h]}),E[18]=u,E[19]=h,E[20]=G,E[21]=p):p=E[21];let X=`/profile/${L.username}`;return E[22]!==X||E[23]!==L.name?(b=(0,t.jsx)(eT.default,{href:X,className:"font-semibold text-gray-900 dark:text-white hover:underline truncate block",children:L.name}),E[22]=X,E[23]=L.name,E[24]=b):b=E[24],E[25]!==F||E[26]!==V||E[27]!==L.username?(f=F?(0,t.jsx)("span",{className:"text-green-600 dark:text-green-400",children:"Online"}):V?`Last seen ${(0,i.formatDistanceToNow)(new Date(V),{addSuffix:!0})}`:`@${L.username}`,E[25]=F,E[26]=V,E[27]=L.username,E[28]=f):f=E[28],E[29]!==f?(y=(0,t.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:f}),E[29]=f,E[30]=y):y=E[30],E[31]!==b||E[32]!==y?(v=(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[b,y]}),E[31]=b,E[32]=y,E[33]=v):v=E[33],E[34]===Symbol.for("react.memo_cache_sentinel")?(j=(0,t.jsx)("button",{className:"p-2 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition-colors",title:"Voice call (coming soon)",disabled:!0,children:(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})})}),E[34]=j):j=E[34],E[35]===Symbol.for("react.memo_cache_sentinel")?(w=(0,t.jsx)("button",{className:"p-2 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition-colors",title:"Video call (coming soon)",disabled:!0,children:(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),E[35]=w):w=E[35],E[36]!==P?(k=P&&(0,t.jsx)("button",{onClick:P,className:"p-2 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition-colors",title:"Chat info",children:(0,t.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),E[36]=P,E[37]=k):k=E[37],E[38]!==q?(N=()=>$(!q),E[38]=q,E[39]=N):N=E[39],E[40]===Symbol.for("react.memo_cache_sentinel")?(C=(0,t.jsx)(eM.MoreVertical,{className:"w-5 h-5"}),E[40]=C):C=E[40],E[41]!==N?(S=(0,t.jsx)("button",{onClick:N,className:"p-2 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition-colors",title:"More options",children:C}),E[41]=N,E[42]=S):S=E[42],E[43]!==q?(T=q&&(0,t.jsx)("div",{className:"absolute right-0 top-full mt-1 w-48 py-1 rounded-lg bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 shadow-lg z-50",children:(0,t.jsxs)("button",{onClick:()=>{W(!0),$(!1)},className:"flex items-center gap-2 w-full px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-gray-100 dark:hover:bg-gray-700",children:[(0,t.jsx)(z.Flag,{className:"w-4 h-4"}),"Report User"]})}),E[43]=q,E[44]=T):T=E[44],E[45]!==S||E[46]!==T?(I=(0,t.jsxs)("div",{className:"relative",ref:K,children:[S,T]}),E[45]=S,E[46]=T,E[47]=I):I=E[47],E[48]!==k||E[49]!==I?(M=(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[j,w,k,I]}),E[48]=k,E[49]=I,E[50]=M):M=E[50],E[51]===Symbol.for("react.memo_cache_sentinel")?(R=()=>W(!1),E[51]=R):R=E[51],E[52]!==_||E[53]!==H||E[54]!==L.id||E[55]!==L.name?(A=(0,t.jsx)(eI.default,{isOpen:H,onClose:R,type:"chat",targetId:_,targetName:L.name,conversationId:_,reportedUserId:L.id}),E[52]=_,E[53]=H,E[54]=L.id,E[55]=L.name,E[56]=A):A=E[56],E[57]!==p||E[58]!==v||E[59]!==M||E[60]!==A||E[61]!==g?(D=(0,t.jsxs)("div",{className:"flex items-center gap-3 p-4 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900",children:[g,p,v,M,A]}),E[57]=p,E[58]=v,E[59]=M,E[60]=A,E[61]=g,E[62]=D):D=E[62],D}e.s(["default",()=>eR],68527),e.s([],81174)}]);