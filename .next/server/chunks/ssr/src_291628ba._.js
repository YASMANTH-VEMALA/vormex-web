module.exports=[44933,a=>{"use strict";var b=a.i(92415);let c=async a=>(await b.default.get("/store/items",{params:{category:a}})).data,d=async a=>await b.default.post("/store/purchase",{itemSlug:a}),e=async()=>{let a=await b.default.get("/store/inventory");return Array.isArray(a.data)?a.data:[]},f=async()=>(await b.default.get("/store/history")).data,g=async()=>{let a=await b.default.get("/store/balance");return a.data?.balance??a.data??0};a.s(["getMyInventory",0,e,"getMyPurchases",0,f,"getStoreItems",0,c,"getXPBalance",0,g,"purchaseItem",0,d])},27339,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(3512);a.i(96331);var f=a.i(95102),f=f,g=a.i(92368),g=g,h=a.i(46296),h=h,i=a.i(42056),j=a.i(72764),k=a.i(12469),l=a.i(44933),m=a.i(98251);function n({params:a}){let n=(0,c.use)(a),o=(0,d.useRouter)(),{user:p}=(0,e.useAuth)(),[q,r]=(0,c.useState)(null),[s,t]=(0,c.useState)(!0),[u,v]=(0,c.useState)(null),[w,x]=(0,c.useState)(null),[y,z]=(0,c.useState)(!1),[A,B]=(0,c.useState)("default"),[C,D]=(0,c.useState)([]),[E,F]=(0,c.useState)([]),[G,H]=(0,c.useState)(""),[I,J]=(0,c.useState)(m.DEFAULT_CHAT_CUSTOMIZATION_ENTITLEMENTS),K=(0,c.useCallback)(a=>{H(a)},[]),L=(0,c.useCallback)(a=>{F(b=>[...b,a])},[]),M=(0,c.useCallback)(a=>{F(b=>{let c=b.findIndex(b=>b.content===a);if(c>=0){let a=[...b];return a.splice(c,1),a}return b})},[]);(0,c.useEffect)(()=>{if(n.conversationId){let a=localStorage.getItem(`chat_wallpaper_${n.conversationId}`);a?B(a):B("default")}},[n.conversationId]),(0,c.useEffect)(()=>{(async()=>{if(p?.id)try{let a=await l.getMyInventory(),b=Array.isArray(a)?a.map(a=>a.itemSlug):[];J((0,m.buildChatCustomizationEntitlements)(b))}catch(a){console.error("Failed to load chat customization packs:",a),J(m.DEFAULT_CHAT_CUSTOMIZATION_ENTITLEMENTS)}})()},[p?.id]),(0,c.useEffect)(()=>{(0,m.isWallpaperUnlocked)(A,I.ownedThemePacks)||(B("default"),localStorage.setItem(`chat_wallpaper_${n.conversationId}`,"default"))},[A,I.ownedThemePacks,n.conversationId]),(0,c.useEffect)(()=>{p?.id&&(0,k.initializeSocket)()},[p?.id]),(0,c.useEffect)(()=>{let a=async()=>{try{t(!0),v(null);let a=await (0,j.getConversation)(n.conversationId);r(a),x(null),D([]),F([])}catch(a){v(a instanceof Error?a.message:"Failed to load conversation")}finally{t(!1)}};n.conversationId&&p?.id&&a()},[n.conversationId,p?.id]);let N=()=>{o.push("/messages")},O=q?.otherParticipant;return s?(0,b.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,b.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):!u&&q&&O?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"flex-1 flex flex-col h-full overflow-hidden",children:[(0,b.jsx)(h.default,{user:O,conversationId:n.conversationId,onBack:N,onInfo:()=>z(!0)}),(0,b.jsx)(f.default,{conversationId:n.conversationId,currentUserId:p.id,otherUser:O,wallpaper:A,availableReactions:I.availableReactions,animatedBubbles:I.animatedBubbles,onReply:a=>x(a),uploadingMessages:C,optimisticMessages:E,onLastMessageUpdate:K,onMessageConfirmed:M},n.conversationId),(0,b.jsx)(g.default,{conversationId:n.conversationId,currentUserId:p.id,replyTo:w||void 0,onCancelReply:()=>x(null),onUploadingMessagesChange:D,onOptimisticMessage:L,otherUserId:O.id,otherUserName:O.name,lastReceivedMessage:G,enabledMessageEffects:I.messageEffects},`input-${n.conversationId}`)]}),(0,b.jsx)(i.default,{isOpen:y,onClose:()=>z(!1),conversationId:n.conversationId,otherUser:O,currentWallpaper:A,onWallpaperChange:a=>{B(a),localStorage.setItem(`chat_wallpaper_${n.conversationId}`,a)},ownedThemePacks:I.ownedThemePacks,onOpenStore:()=>o.push("/store")},`settings-${n.conversationId}`)]}):(0,b.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-red-500 mb-4",children:u||"Conversation not found"}),(0,b.jsx)("button",{onClick:N,className:"text-blue-600 hover:underline",children:"Go back to messages"})]})})}a.s(["default",()=>n],27339)}];

//# sourceMappingURL=src_291628ba._.js.map