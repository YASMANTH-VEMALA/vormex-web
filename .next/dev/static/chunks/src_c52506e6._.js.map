{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 31, "column": 0}, "map": {"version":3,"sources":["file:///home/yasmanth/Pictures/vormex/vormex-web/src/app/messages/%5BconversationId%5D/page.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useState, use, useCallback } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { useAuth } from '@/lib/auth/useAuth';\nimport { ChatMessages, ChatInput, ChatHeader, type UploadingMessage } from '@/components/chat';\nimport ChatSettingsPanel from '@/components/chat/ChatSettingsPanel';\nimport { getConversation, Conversation } from '@/lib/api/chat';\nimport { initializeSocket } from '@/lib/socket';\n\ninterface ConversationPageProps {\n  params: Promise<{ conversationId: string }>;\n}\n\n// This page only renders the chat area - the layout.tsx handles the sidebar with ChatList\nexport default function ConversationPage({ params }: ConversationPageProps) {\n  const resolvedParams = use(params);\n  const router = useRouter();\n  const { user } = useAuth();\n  const [conversation, setConversation] = useState<Conversation | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [replyTo, setReplyTo] = useState<{ id: string; content: string; senderName: string } | null>(null);\n  const [showSettings, setShowSettings] = useState(false);\n  const [wallpaper, setWallpaper] = useState('default');\n  const [uploadingMessages, setUploadingMessages] = useState<UploadingMessage[]>([]);\n  const [lastReceivedMessage, setLastReceivedMessage] = useState<string>('');\n\n  // Callback to track the last message received from other user\n  const handleLastMessageUpdate = useCallback((message: string) => {\n    setLastReceivedMessage(message);\n  }, []);\n\n  // Load wallpaper preference from localStorage\n  useEffect(() => {\n    if (resolvedParams.conversationId) {\n      const savedWallpaper = localStorage.getItem(`chat_wallpaper_${resolvedParams.conversationId}`);\n      if (savedWallpaper) {\n        setWallpaper(savedWallpaper);\n      } else {\n        setWallpaper('default');\n      }\n    }\n  }, [resolvedParams.conversationId]);\n\n  // Save wallpaper preference\n  const handleWallpaperChange = (newWallpaper: string) => {\n    setWallpaper(newWallpaper);\n    localStorage.setItem(`chat_wallpaper_${resolvedParams.conversationId}`, newWallpaper);\n  };\n\n  // Initialize socket\n  useEffect(() => {\n    if (user?.id) {\n      initializeSocket();\n    }\n  }, [user?.id]);\n\n  // Fetch conversation\n  useEffect(() => {\n    const fetchConversation = async () => {\n      try {\n        setLoading(true);\n        setError(null);\n        const conv = await getConversation(resolvedParams.conversationId);\n        setConversation(conv);\n        // Clear reply and uploading messages when switching conversations\n        setReplyTo(null);\n        setUploadingMessages([]);\n      } catch (err: any) {\n        setError(err.message || 'Failed to load conversation');\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    if (resolvedParams.conversationId && user?.id) {\n      fetchConversation();\n    }\n  }, [resolvedParams.conversationId, user?.id]);\n\n  const handleBack = () => {\n    router.push('/messages');\n  };\n\n  const otherUser = conversation?.otherParticipant;\n\n  // Loading state\n  if (loading) {\n    return (\n      <div className=\"flex-1 flex items-center justify-center\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\n      </div>\n    );\n  }\n\n  // Error state\n  if (error || !conversation || !otherUser) {\n    return (\n      <div className=\"flex-1 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <p className=\"text-red-500 mb-4\">{error || 'Conversation not found'}</p>\n          <button\n            onClick={handleBack}\n            className=\"text-blue-600 hover:underline\"\n          >\n            Go back to messages\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <>\n      <div className=\"flex-1 flex flex-col h-full overflow-hidden\">\n        {/* Chat Header */}\n        <ChatHeader \n          user={otherUser}\n          conversationId={resolvedParams.conversationId}\n          onBack={handleBack}\n          onInfo={() => setShowSettings(true)}\n        />\n\n        {/* Messages */}\n        <ChatMessages\n          key={resolvedParams.conversationId}\n          conversationId={resolvedParams.conversationId}\n          currentUserId={user!.id}\n          otherUser={otherUser}\n          wallpaper={wallpaper}\n          onReply={(msg) => setReplyTo(msg)}\n          uploadingMessages={uploadingMessages}\n          onLastMessageUpdate={handleLastMessageUpdate}\n        />\n\n        {/* Input */}\n        <ChatInput\n          key={`input-${resolvedParams.conversationId}`}\n          conversationId={resolvedParams.conversationId}\n          replyTo={replyTo || undefined}\n          onCancelReply={() => setReplyTo(null)}\n          onUploadingMessagesChange={setUploadingMessages}\n          otherUserId={otherUser.id}\n          otherUserName={otherUser.name}\n          lastReceivedMessage={lastReceivedMessage}\n        />\n      </div>\n\n      {/* Settings Panel */}\n      <ChatSettingsPanel\n        isOpen={showSettings}\n        onClose={() => setShowSettings(false)}\n        conversationId={resolvedParams.conversationId}\n        otherUser={otherUser}\n        currentWallpaper={wallpaper}\n        onWallpaperChange={handleWallpaperChange}\n      />\n    </>\n  );\n}\n"],"names":["useEffect","useState","use","useCallback","useRouter","useAuth","ChatMessages","ChatInput","ChatHeader","UploadingMessage","ChatSettingsPanel","getConversation","Conversation","initializeSocket","ConversationPageProps","params","Promise","conversationId","ConversationPage","resolvedParams","router","user","conversation","setConversation","loading","setLoading","error","setError","replyTo","setReplyTo","id","content","senderName","showSettings","setShowSettings","wallpaper","setWallpaper","uploadingMessages","setUploadingMessages","lastReceivedMessage","setLastReceivedMessage","handleLastMessageUpdate","message","savedWallpaper","localStorage","getItem","handleWallpaperChange","newWallpaper","setItem","fetchConversation","conv","err","handleBack","push","otherUser","otherParticipant","msg","undefined","name"],"mappings":"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","ignoreList":[]}}]
}