{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/yasmanth/Pictures/vormex/vormex-web/src/app/auth/google/callback/page.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useState, Suspense } from 'react';\nimport { useRouter, useSearchParams } from 'next/navigation';\nimport { authAPI } from '@/lib/api/auth';\nimport { useAuthContext } from '@/lib/auth/authContext';\nimport { handleApiError } from '@/lib/utils/errorHandler';\nimport '../../../login/login.css';\n\nfunction GoogleCallbackContent() {\n  const router = useRouter();\n  const searchParams = useSearchParams();\n  const { setAuth } = useAuthContext();\n  const [error, setError] = useState<string | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n\n  useEffect(() => {\n    const handleCallback = async () => {\n      try {\n        // Get authorization code and state from URL\n        const code = searchParams.get('code');\n        const state = searchParams.get('state');\n        const errorParam = searchParams.get('error');\n\n        // Check for OAuth errors\n        if (errorParam) {\n          setError(`Google OAuth error: ${errorParam}`);\n          setIsLoading(false);\n          setTimeout(() => router.push('/login'), 3000);\n          return;\n        }\n\n        // Validate state (CSRF protection)\n        const storedState = sessionStorage.getItem('oauth_state');\n        if (!state || state !== storedState) {\n        setError('Invalid state parameter. Please try again.');\n        setIsLoading(false);\n        sessionStorage.removeItem('oauth_state');\n        sessionStorage.removeItem('oauth_code_verifier');\n        setTimeout(() => router.push('/login'), 3000);\n        return;\n      }\n\n      if (!code) {\n        setError('Authorization code not found. Please try again.');\n        setIsLoading(false);\n        sessionStorage.removeItem('oauth_state');\n        sessionStorage.removeItem('oauth_code_verifier');\n        setTimeout(() => router.push('/login'), 3000);\n        return;\n      }\n\n        // Exchange authorization code for tokens using PKCE via our API route\n        const redirectUri = `${window.location.origin}/auth/google/callback`;\n        const codeVerifier = sessionStorage.getItem('oauth_code_verifier');\n        \n        if (!codeVerifier) {\n          throw new Error('Code verifier not found. Please try signing in again.');\n        }\n\n        // Use our API route to exchange code for tokens (server-side, secure)\n        const tokenResponse = await fetch('/api/auth/google/callback', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify({\n            code: code,\n            codeVerifier: codeVerifier,\n            redirectUri: redirectUri,\n          }),\n        });\n\n        if (!tokenResponse.ok) {\n          const errorData = await tokenResponse.json().catch(() => ({}));\n          throw new Error(errorData.error || errorData.error_description || 'Failed to exchange authorization code');\n        }\n\n        const tokenData = await tokenResponse.json();\n\n        // Extract id_token from the response\n        const idToken = tokenData.idToken;\n\n        if (!idToken) {\n          throw new Error('ID token not found in token response');\n        }\n\n        // Send id_token to backend\n        const authResponse = await authAPI.googleSignIn(idToken);\n\n        // Update auth context with the response\n        setAuth(authResponse);\n\n        // Clean up\n        sessionStorage.removeItem('oauth_state');\n        sessionStorage.removeItem('oauth_code_verifier');\n\n        // Redirect to home\n        router.push('/');\n      } catch (err) {\n        console.error('Google OAuth callback error:', err);\n        setError(handleApiError(err));\n        setIsLoading(false);\n        sessionStorage.removeItem('oauth_state');\n        sessionStorage.removeItem('oauth_code_verifier');\n        setTimeout(() => router.push('/login'), 3000);\n      }\n    };\n\n    handleCallback();\n  }, [searchParams, router, setAuth]);\n\n  return (\n    <div className=\"auth-page-wrapper\">\n      <div className=\"main\" style={{ maxWidth: '500px', width: '100%' }}>\n        <div className=\"form\">\n          <h2 className=\"form_title title\">Signing in with Google...</h2>\n          {isLoading && (\n            <p className=\"description\" style={{ marginTop: '20px' }}>\n              Please wait while we complete your sign-in.\n            </p>\n          )}\n          {error && (\n            <>\n              <div className=\"error-message\" style={{ marginTop: '20px' }}>\n                {error}\n              </div>\n              <p className=\"description\" style={{ marginTop: '10px' }}>\n                Redirecting to login page...\n              </p>\n            </>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default function GoogleCallbackPage() {\n  return (\n    <Suspense fallback={\n      <div className=\"auth-page-wrapper\">\n        <div className=\"main\" style={{ maxWidth: '500px', width: '100%' }}>\n          <div className=\"form\">\n            <h2 className=\"form_title title\">Signing in with Google...</h2>\n            <p className=\"description\" style={{ marginTop: '20px' }}>\n              Loading...\n            </p>\n          </div>\n        </div>\n      </div>\n    }>\n      <GoogleCallbackContent />\n    </Suspense>\n  );\n}\n\n"],"names":[],"mappings":"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"}}]
}