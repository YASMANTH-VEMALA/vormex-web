{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/yasmanth/Pictures/vormex/vormex-web/src/components/auth/ProtectedRoute.tsx"],"sourcesContent":["'use client';\n\nimport React from 'react';\nimport { useRouter } from 'next/navigation';\nimport { useAuth } from '@/lib/auth/useAuth';\n\ninterface ProtectedRouteProps {\n  children: React.ReactNode;\n}\n\nexport function ProtectedRoute({ children }: ProtectedRouteProps) {\n  const { isAuthenticated, loading } = useAuth();\n  const router = useRouter();\n\n  React.useEffect(() => {\n    if (!loading && !isAuthenticated) {\n      router.push('/login');\n    }\n  }, [isAuthenticated, loading, router]);\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900 mx-auto\"></div>\n          <p className=\"mt-4 text-gray-600\">Loading...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (!isAuthenticated) {\n    return null;\n  }\n\n  return <>{children}</>;\n}\n\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAJA;;;;;AAUO,SAAS,eAAe,EAAE,QAAQ,EAAuB;IAC9D,MAAM,EAAE,eAAe,EAAE,OAAO,EAAE,GAAG,IAAA,wIAAO;IAC5C,MAAM,SAAS,IAAA,+IAAS;IAExB,gNAAK,CAAC,SAAS,CAAC;QACd,IAAI,CAAC,WAAW,CAAC,iBAAiB;YAChC,OAAO,IAAI,CAAC;QACd;IACF,GAAG;QAAC;QAAiB;QAAS;KAAO;IAErC,IAAI,SAAS;QACX,qBACE,8OAAC;YAAI,WAAU;sBACb,cAAA,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAI,WAAU;;;;;;kCACf,8OAAC;wBAAE,WAAU;kCAAqB;;;;;;;;;;;;;;;;;IAI1C;IAEA,IAAI,CAAC,iBAAiB;QACpB,OAAO;IACT;IAEA,qBAAO;kBAAG;;AACZ"}},
    {"offset": {"line": 73, "column": 0}, "map": {"version":3,"sources":["file:///home/yasmanth/Pictures/vormex/vormex-web/src/lib/api/chat.ts"],"sourcesContent":["import apiClient from './client';\n\n// ============================================\n// Types\n// ============================================\n\nexport interface ChatUser {\n  id: string;\n  username: string;\n  name: string;\n  profileImage: string | null;\n  isOnline: boolean;\n  lastActiveAt: string | null;\n}\n\nexport interface Message {\n  id: string;\n  conversationId: string;\n  senderId: string;\n  receiverId: string;\n  content: string;\n  contentType: string;\n  mediaUrl?: string;\n  mediaType?: string;\n  fileName?: string;\n  fileSize?: number;\n  status: 'SENT' | 'DELIVERED' | 'READ';\n  deliveredAt?: string;\n  readAt?: string;\n  isDeleted: boolean;\n  isEdited?: boolean; // Client-side flag to track if message was edited\n  replyToId?: string;\n  replyTo?: {\n    id: string;\n    content: string;\n    contentType: string;\n    senderId: string;\n  };\n  sender: ChatUser;\n  reactions: MessageReaction[];\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport interface MessageReaction {\n  id: string;\n  userId: string;\n  emoji: string;\n  user: {\n    id: string;\n    username: string;\n    name: string;\n  };\n}\n\nexport interface Conversation {\n  id: string;\n  participant1Id: string;\n  participant2Id: string;\n  participant1: ChatUser;\n  participant2: ChatUser;\n  otherParticipant: ChatUser;\n  lastMessage?: {\n    id: string;\n    content: string;\n    contentType: string;\n    senderId: string;\n    status: 'SENT' | 'DELIVERED' | 'READ';\n    createdAt: string;\n  };\n  lastMessageAt?: string;\n  unreadCount: number;\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport interface ConversationsResponse {\n  conversations: Conversation[];\n  hasMore: boolean;\n  nextCursor?: string;\n}\n\nexport interface MessagesResponse {\n  messages: Message[];\n  hasMore: boolean;\n  nextCursor?: string;\n}\n\n// ============================================\n// Chat API Functions\n// ============================================\n\n/**\n * Get all conversations for the current user\n */\nexport async function getConversations(\n  limit?: number,\n  cursor?: string\n): Promise<ConversationsResponse> {\n  const params = new URLSearchParams();\n  if (limit) params.append('limit', String(limit));\n  if (cursor) params.append('cursor', cursor);\n  \n  return apiClient.get(`/chat/conversations?${params.toString()}`);\n}\n\n/**\n * Get or create a conversation with another user\n */\nexport async function getOrCreateConversation(participantId: string): Promise<Conversation> {\n  return apiClient.post('/chat/conversations', { participantId });\n}\n\n/**\n * Get a specific conversation\n */\nexport async function getConversation(conversationId: string): Promise<Conversation> {\n  return apiClient.get(`/chat/conversations/${conversationId}`);\n}\n\n/**\n * Get messages for a conversation\n */\nexport async function getMessages(\n  conversationId: string,\n  limit?: number,\n  cursor?: string\n): Promise<MessagesResponse> {\n  const params = new URLSearchParams();\n  if (limit) params.append('limit', String(limit));\n  if (cursor) params.append('cursor', cursor);\n  \n  return apiClient.get(`/chat/conversations/${conversationId}/messages?${params.toString()}`);\n}\n\n/**\n * Send a message (REST fallback - prefer WebSocket)\n */\nexport async function sendMessage(\n  conversationId: string,\n  data: {\n    content: string;\n    contentType?: string;\n    mediaUrl?: string;\n    mediaType?: string;\n    fileName?: string;\n    fileSize?: number;\n    replyToId?: string;\n  }\n): Promise<Message> {\n  return apiClient.post(`/chat/conversations/${conversationId}/messages`, data);\n}\n\n/**\n * Mark messages as read\n */\nexport async function markAsRead(conversationId: string): Promise<{ updatedCount: number; readAt: string }> {\n  return apiClient.post(`/chat/conversations/${conversationId}/read`);\n}\n\n/**\n * Delete a message\n */\nexport async function deleteMessage(\n  messageId: string,\n  forEveryone?: boolean\n): Promise<{ success: boolean }> {\n  return apiClient.delete(`/chat/messages/${messageId}`, { \n    data: { forEveryone } \n  });\n}\n\n/**\n * Edit a message\n */\nexport async function editMessage(messageId: string, content: string): Promise<Message> {\n  return apiClient.patch(`/chat/messages/${messageId}`, { content });\n}\n\n/**\n * Add reaction to a message\n */\nexport async function addReaction(\n  messageId: string,\n  emoji: string\n): Promise<{ action: 'added' | 'removed' | 'updated'; emoji: string }> {\n  return apiClient.post(`/chat/messages/${messageId}/reactions`, { emoji });\n}\n\n/**\n * Get unread message count\n */\nexport async function getUnreadCount(): Promise<{ unreadCount: number }> {\n  return apiClient.get('/chat/unread-count');\n}\n\n/**\n * Search messages\n */\nexport async function searchMessages(\n  query: string,\n  limit?: number\n): Promise<{ messages: Message[] }> {\n  const params = new URLSearchParams();\n  params.append('q', query);\n  if (limit) params.append('limit', String(limit));\n  \n  return apiClient.get(`/chat/search?${params.toString()}`);\n}\n\n/**\n * Upload chat media (image, video, document, audio)\n */\nexport async function uploadChatMedia(\n  file: File,\n  mediaType: 'image' | 'video' | 'document' | 'audio',\n  onProgress?: (progress: number) => void\n): Promise<{\n  mediaUrl: string;\n  fileName: string;\n  fileSize: number;\n  mediaType: string;\n}> {\n  const formData = new FormData();\n  formData.append('file', file);\n  formData.append('mediaType', mediaType);\n  \n  // Use axios with proper config for file uploads\n  return apiClient.post('/chat/upload', formData, {\n    timeout: 120000, // 2 minutes timeout for large files\n    maxContentLength: Infinity,\n    maxBodyLength: Infinity,\n    onUploadProgress: (progressEvent) => {\n      if (onProgress && progressEvent.total) {\n        const progress = Math.round((progressEvent.loaded / progressEvent.total) * 100);\n        onProgress(progress);\n      }\n    },\n  });\n}\n\n// ============================================\n// Message Limit (Connection-based)\n// ============================================\n\nexport interface MessageLimitStatus {\n  canSend: boolean;\n  isConnected: boolean;\n  messagesSent: number;\n  messagesRemaining: number;\n  limit: number;\n}\n\n/**\n * Get message limit status for a user\n * Non-connected users can only send 2 messages\n * Connected users have unlimited messaging\n */\nexport async function getMessageLimitStatus(userId: string): Promise<MessageLimitStatus> {\n  return apiClient.get(`/chat/message-limit/${userId}`);\n}\n\n// ============================================\n// Message Requests (from non-connected users)\n// ============================================\n\nexport interface MessageRequest extends Conversation {\n  isMessageRequest: boolean;\n  messageRequestAcceptedAt: string | null;\n}\n\nexport interface MessageRequestsResponse {\n  messageRequests: MessageRequest[];\n  hasMore: boolean;\n  nextCursor?: string;\n}\n\n/**\n * Get message requests (conversations from non-connected users)\n */\nexport async function getMessageRequests(\n  limit?: number,\n  cursor?: string\n): Promise<MessageRequestsResponse> {\n  const params = new URLSearchParams();\n  if (limit) params.append('limit', String(limit));\n  if (cursor) params.append('cursor', cursor);\n  \n  return apiClient.get(`/chat/requests?${params.toString()}`);\n}\n\n/**\n * Get message requests count\n */\nexport async function getMessageRequestsCount(): Promise<{ count: number }> {\n  return apiClient.get('/chat/requests/count');\n}\n\n/**\n * Accept a message request\n */\nexport async function acceptMessageRequest(\n  conversationId: string\n): Promise<{ message: string; conversation: Conversation }> {\n  return apiClient.post(`/chat/requests/${conversationId}/accept`);\n}\n\n/**\n * Decline a message request\n */\nexport async function declineMessageRequest(\n  conversationId: string\n): Promise<{ message: string }> {\n  return apiClient.delete(`/chat/requests/${conversationId}`);\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 202, "column": 0}, "map": {"version":3,"sources":["file:///home/yasmanth/Pictures/vormex/vormex-web/src/components/chat/ChatList.tsx"],"sourcesContent":["'use client';\n\nimport React, { useEffect, useState, useCallback } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { getConversations, Conversation } from '@/lib/api/chat';\nimport { initializeSocket, getSocket } from '@/lib/socket';\nimport { formatDistanceToNow } from 'date-fns';\nimport { cn } from '@/lib/utils';\n\ninterface ChatListProps {\n  selectedConversationId?: string;\n  onSelectConversation?: (conversation: Conversation) => void;\n  currentUserId?: string;\n}\n\nexport default function ChatList({ \n  selectedConversationId, \n  onSelectConversation,\n  currentUserId \n}: ChatListProps) {\n  const router = useRouter();\n  const [conversations, setConversations] = useState<Conversation[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [hasMore, setHasMore] = useState(false);\n  const [nextCursor, setNextCursor] = useState<string | undefined>();\n\n  const fetchConversations = useCallback(async (cursor?: string) => {\n    try {\n      // Only show loading if we don't have any conversations yet\n      if (conversations.length === 0) {\n        setLoading(true);\n      }\n      const result = await getConversations(30, cursor);\n      \n      if (cursor) {\n        setConversations(prev => [...prev, ...result.conversations]);\n      } else {\n        setConversations(result.conversations);\n      }\n      \n      setHasMore(result.hasMore);\n      setNextCursor(result.nextCursor);\n    } catch (err: any) {\n      setError(err.message || 'Failed to load conversations');\n    } finally {\n      setLoading(false);\n    }\n  }, [conversations.length]);\n\n  useEffect(() => {\n    fetchConversations();\n  }, [fetchConversations]);\n\n  // Listen for new messages to update conversation list\n  useEffect(() => {\n    const socket = getSocket();\n    \n    if (!socket) return;\n\n    const handleNewMessage = (data: { conversationId: string; message: any }) => {\n      setConversations(prev => {\n        const existingIndex = prev.findIndex(c => c.id === data.conversationId);\n        \n        if (existingIndex >= 0) {\n          // Update existing conversation and move to top\n          const updated = [...prev];\n          const conv = { ...updated[existingIndex] };\n          conv.lastMessage = {\n            id: data.message.id,\n            content: data.message.content,\n            contentType: data.message.contentType,\n            senderId: data.message.senderId,\n            status: data.message.status,\n            createdAt: data.message.createdAt,\n          };\n          conv.lastMessageAt = data.message.createdAt;\n          \n          // Increment unread if not the sender\n          if (data.message.senderId !== currentUserId && data.conversationId !== selectedConversationId) {\n            conv.unreadCount = (conv.unreadCount || 0) + 1;\n          }\n          \n          updated.splice(existingIndex, 1);\n          return [conv, ...updated];\n        }\n        \n        // Refresh to get new conversation\n        fetchConversations();\n        return prev;\n      });\n    };\n\n    const handleMessagesRead = (data: { conversationId: string }) => {\n      setConversations(prev => \n        prev.map(c => \n          c.id === data.conversationId \n            ? { ...c, unreadCount: 0 } \n            : c\n        )\n      );\n    };\n\n    socket.on('chat:new_message', handleNewMessage);\n    socket.on('chat:notification', handleNewMessage);\n    socket.on('chat:messages_read', handleMessagesRead);\n\n    return () => {\n      socket.off('chat:new_message', handleNewMessage);\n      socket.off('chat:notification', handleNewMessage);\n      socket.off('chat:messages_read', handleMessagesRead);\n    };\n  }, [currentUserId, selectedConversationId, fetchConversations]);\n\n  const handleSelectConversation = (conversation: Conversation) => {\n    if (onSelectConversation) {\n      onSelectConversation(conversation);\n    } else {\n      router.push(`/messages/${conversation.id}`);\n    }\n  };\n\n  const loadMore = () => {\n    if (hasMore && nextCursor) {\n      fetchConversations(nextCursor);\n    }\n  };\n\n  if (loading && conversations.length === 0) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"p-4 text-center text-red-500\">\n        {error}\n        <button \n          onClick={() => fetchConversations()}\n          className=\"block mx-auto mt-2 text-blue-500 hover:underline\"\n        >\n          Retry\n        </button>\n      </div>\n    );\n  }\n\n  if (conversations.length === 0) {\n    return (\n      <div className=\"p-8 text-center text-gray-500 dark:text-gray-400\">\n        <div className=\"text-4xl mb-4\">ðŸ’¬</div>\n        <p>No conversations yet</p>\n        <p className=\"text-sm mt-2\">Start a chat with someone!</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex flex-col h-full\">\n      <div className=\"flex-1 overflow-y-auto\">\n        {conversations.map((conversation) => (\n          <ConversationItem\n            key={conversation.id}\n            conversation={conversation}\n            isSelected={selectedConversationId === conversation.id}\n            currentUserId={currentUserId}\n            onClick={() => handleSelectConversation(conversation)}\n          />\n        ))}\n        \n        {hasMore && (\n          <button\n            onClick={loadMore}\n            disabled={loading}\n            className=\"w-full py-3 text-sm text-blue-600 hover:bg-gray-50 dark:hover:bg-gray-800\"\n          >\n            {loading ? 'Loading...' : 'Load more'}\n          </button>\n        )}\n      </div>\n    </div>\n  );\n}\n\n// ============================================\n// Conversation Item Component\n// ============================================\ninterface ConversationItemProps {\n  conversation: Conversation;\n  isSelected: boolean;\n  currentUserId?: string;\n  onClick: () => void;\n}\n\nfunction ConversationItem({ \n  conversation, \n  isSelected, \n  currentUserId,\n  onClick \n}: ConversationItemProps) {\n  const other = conversation.otherParticipant;\n  const lastMessage = conversation.lastMessage;\n  const isUnread = conversation.unreadCount > 0;\n  const isSentByMe = lastMessage?.senderId === currentUserId;\n\n  return (\n    <div\n      onClick={onClick}\n      className={cn(\n        'flex items-center gap-3 p-3 cursor-pointer transition-colors border-b border-gray-100 dark:border-gray-800',\n        isSelected \n          ? 'bg-blue-50 dark:bg-blue-900/20' \n          : 'hover:bg-gray-50 dark:hover:bg-gray-800/50',\n        isUnread && !isSelected && 'bg-gray-50 dark:bg-gray-800/30'\n      )}\n    >\n      {/* Avatar */}\n      <div className=\"relative flex-shrink-0\">\n        <div className=\"w-12 h-12 rounded-full bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center text-white font-semibold\">\n          {other.profileImage ? (\n            <img\n              src={other.profileImage}\n              alt={other.name}\n              className=\"w-12 h-12 rounded-full object-cover\"\n            />\n          ) : (\n            other.name.charAt(0).toUpperCase()\n          )}\n        </div>\n        {/* Online indicator */}\n        {other.isOnline && (\n          <div className=\"absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white dark:border-gray-900\"></div>\n        )}\n      </div>\n\n      {/* Content */}\n      <div className=\"flex-1 min-w-0\">\n        <div className=\"flex items-center justify-between\">\n          <span className={cn(\n            'font-medium truncate',\n            isUnread && 'text-gray-900 dark:text-white font-semibold'\n          )}>\n            {other.name}\n          </span>\n          {lastMessage && (\n            <span className=\"text-xs text-gray-500 flex-shrink-0\">\n              {formatDistanceToNow(new Date(lastMessage.createdAt), { addSuffix: false })}\n            </span>\n          )}\n        </div>\n        \n        <div className=\"flex items-center gap-1\">\n          {lastMessage ? (\n            <>\n              {isSentByMe && (\n                <span className=\"text-gray-400 text-sm\">\n                  {lastMessage.status === 'READ' ? 'âœ“âœ“' : lastMessage.status === 'DELIVERED' ? 'âœ“âœ“' : 'âœ“'}\n                </span>\n              )}\n              <p className={cn(\n                'text-sm truncate',\n                isUnread \n                  ? 'text-gray-900 dark:text-white font-medium' \n                  : 'text-gray-500 dark:text-gray-400'\n              )}>\n                {lastMessage.contentType === 'image' ? 'ðŸ“· Photo' :\n                 lastMessage.contentType === 'file' ? 'ðŸ“Ž File' :\n                 lastMessage.contentType === 'voice' ? 'ðŸŽ¤ Voice message' :\n                 lastMessage.content}\n              </p>\n            </>\n          ) : (\n            <p className=\"text-sm text-gray-400 italic\">No messages yet</p>\n          )}\n        </div>\n      </div>\n\n      {/* Unread badge */}\n      {isUnread && (\n        <div className=\"flex-shrink-0 w-5 h-5 bg-blue-600 rounded-full flex items-center justify-center\">\n          <span className=\"text-xs text-white font-medium\">\n            {conversation.unreadCount > 9 ? '9+' : conversation.unreadCount}\n          </span>\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 573, "column": 0}, "map": {"version":3,"sources":["file:///home/yasmanth/Pictures/vormex/vormex-web/src/components/chat/MessageMenu.tsx"],"sourcesContent":["'use client';\n\nimport React, { useState, useRef, useEffect } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { cn } from '@/lib/utils';\nimport {\n  Reply,\n  Copy,\n  Pencil,\n  Trash2,\n  Forward,\n  Star,\n  Pin,\n  MoreHorizontal,\n  Download,\n} from 'lucide-react';\n\nconst REACTION_EMOJIS = ['â¤ï¸', 'ðŸ‘', 'ðŸ˜‚', 'ðŸ˜®', 'ðŸ˜¢', 'ðŸ™', 'ðŸ”¥', 'ðŸ‘'];\n\ninterface MessageMenuProps {\n  isOpen: boolean;\n  onClose: () => void;\n  isOwn: boolean;\n  messageId: string;\n  messageContent: string;\n  hasMedia?: boolean;\n  mediaUrl?: string;\n  onReply: () => void;\n  onEdit?: () => void;\n  onDelete: (forEveryone: boolean) => void;\n  onReact: (emoji: string) => void;\n  onCopy: () => void;\n  onForward?: () => void;\n  onPin?: () => void;\n  onStar?: () => void;\n  position?: { x: number; y: number };\n  anchorPosition?: 'left' | 'right';\n}\n\nexport default function MessageMenu({\n  isOpen,\n  onClose,\n  isOwn,\n  messageId,\n  messageContent,\n  hasMedia,\n  mediaUrl,\n  onReply,\n  onEdit,\n  onDelete,\n  onReact,\n  onCopy,\n  onForward,\n  onPin,\n  onStar,\n  position,\n  anchorPosition = 'right',\n}: MessageMenuProps) {\n  const [showDeleteOptions, setShowDeleteOptions] = useState(false);\n  const [showReactions, setShowReactions] = useState(true);\n  const menuRef = useRef<HTMLDivElement>(null);\n\n  // Close menu when clicking outside\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (menuRef.current && !menuRef.current.contains(event.target as Node)) {\n        onClose();\n      }\n    };\n\n    if (isOpen) {\n      document.addEventListener('mousedown', handleClickOutside);\n    }\n\n    return () => {\n      document.removeEventListener('mousedown', handleClickOutside);\n    };\n  }, [isOpen, onClose]);\n\n  // Handle keyboard shortcuts\n  useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (!isOpen) return;\n      \n      if (event.key === 'Escape') {\n        onClose();\n      } else if (event.key === 'r' && !event.metaKey && !event.ctrlKey) {\n        onReply();\n        onClose();\n      } else if (event.key === 'c' && (event.metaKey || event.ctrlKey)) {\n        onCopy();\n        onClose();\n      }\n    };\n\n    document.addEventListener('keydown', handleKeyDown);\n    return () => document.removeEventListener('keydown', handleKeyDown);\n  }, [isOpen, onClose, onReply, onCopy]);\n\n  const handleCopy = () => {\n    navigator.clipboard.writeText(messageContent);\n    onCopy();\n    onClose();\n  };\n\n  const handleDownload = () => {\n    if (mediaUrl) {\n      const link = document.createElement('a');\n      link.href = mediaUrl;\n      link.download = '';\n      link.target = '_blank';\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n    }\n    onClose();\n  };\n\n  const menuItems = [\n    {\n      id: 'reply',\n      label: 'Reply',\n      icon: Reply,\n      onClick: () => { onReply(); onClose(); },\n      shortcut: 'R',\n    },\n    {\n      id: 'copy',\n      label: 'Copy',\n      icon: Copy,\n      onClick: handleCopy,\n      shortcut: 'âŒ˜C',\n    },\n    ...(isOwn ? [{\n      id: 'edit',\n      label: 'Edit',\n      icon: Pencil,\n      onClick: () => { onEdit?.(); onClose(); },\n    }] : []),\n    ...(hasMedia && mediaUrl ? [{\n      id: 'download',\n      label: 'Download',\n      icon: Download,\n      onClick: handleDownload,\n    }] : []),\n    {\n      id: 'forward',\n      label: 'Forward',\n      icon: Forward,\n      onClick: () => { onForward?.(); onClose(); },\n      disabled: true, // Coming soon\n    },\n    {\n      id: 'pin',\n      label: 'Pin',\n      icon: Pin,\n      onClick: () => { onPin?.(); onClose(); },\n      disabled: true, // Coming soon\n    },\n    {\n      id: 'star',\n      label: 'Star',\n      icon: Star,\n      onClick: () => { onStar?.(); onClose(); },\n      disabled: true, // Coming soon\n    },\n    {\n      id: 'delete',\n      label: 'Delete',\n      icon: Trash2,\n      onClick: () => setShowDeleteOptions(true),\n      danger: true,\n    },\n  ];\n\n  return (\n    <AnimatePresence>\n      {isOpen && (\n        <motion.div\n          ref={menuRef}\n          initial={{ opacity: 0, scale: 0.95, y: -10 }}\n          animate={{ opacity: 1, scale: 1, y: 0 }}\n          exit={{ opacity: 0, scale: 0.95, y: -10 }}\n          transition={{ duration: 0.15 }}\n          className={cn(\n            'absolute z-50 min-w-[200px]',\n            'bg-white dark:bg-gray-800 rounded-xl shadow-xl',\n            'border border-gray-200 dark:border-gray-700',\n            'overflow-hidden'\n          )}\n          style={position ? {\n            top: position.y,\n            left: anchorPosition === 'left' ? position.x : undefined,\n            right: anchorPosition === 'right' ? position.x : undefined,\n          } : {\n            top: '-8px',\n            [anchorPosition === 'left' ? 'left' : 'right']: '100%',\n            marginLeft: anchorPosition === 'left' ? '8px' : undefined,\n            marginRight: anchorPosition === 'right' ? '8px' : undefined,\n          }}\n        >\n          {/* Reaction bar */}\n          {showReactions && !showDeleteOptions && (\n            <div className=\"p-2 border-b border-gray-200 dark:border-gray-700\">\n              <div className=\"flex items-center gap-1\">\n                {REACTION_EMOJIS.map((emoji) => (\n                  <button\n                    key={emoji}\n                    onClick={() => { onReact(emoji); onClose(); }}\n                    className=\"p-1.5 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-all hover:scale-125\"\n                  >\n                    <span className=\"text-lg\">{emoji}</span>\n                  </button>\n                ))}\n              </div>\n            </div>\n          )}\n\n          {/* Delete options submenu */}\n          {showDeleteOptions ? (\n            <div className=\"py-1\">\n              <div className=\"px-3 py-2 text-sm font-medium text-gray-500 dark:text-gray-400\">\n                Delete message?\n              </div>\n              <button\n                onClick={() => { onDelete(false); onClose(); }}\n                className=\"w-full flex items-center gap-3 px-3 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors\"\n              >\n                <Trash2 className=\"w-4 h-4\" />\n                <span>Delete for me</span>\n              </button>\n              {isOwn && (\n                <button\n                  onClick={() => { onDelete(true); onClose(); }}\n                  className=\"w-full flex items-center gap-3 px-3 py-2 text-left text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors\"\n                >\n                  <Trash2 className=\"w-4 h-4\" />\n                  <span>Delete for everyone</span>\n                </button>\n              )}\n              <button\n                onClick={() => setShowDeleteOptions(false)}\n                className=\"w-full px-3 py-2 text-left text-sm text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors\"\n              >\n                Cancel\n              </button>\n            </div>\n          ) : (\n            /* Main menu items */\n            <div className=\"py-1\">\n              {menuItems.map((item) => (\n                <button\n                  key={item.id}\n                  onClick={item.onClick}\n                  disabled={item.disabled}\n                  className={cn(\n                    'w-full flex items-center justify-between gap-3 px-3 py-2 text-left text-sm transition-colors',\n                    item.danger\n                      ? 'text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20'\n                      : 'text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700',\n                    item.disabled && 'opacity-50 cursor-not-allowed'\n                  )}\n                >\n                  <div className=\"flex items-center gap-3\">\n                    <item.icon className=\"w-4 h-4\" />\n                    <span>{item.label}</span>\n                    {item.disabled && (\n                      <span className=\"text-xs text-gray-400\">(soon)</span>\n                    )}\n                  </div>\n                  {item.shortcut && (\n                    <span className=\"text-xs text-gray-400\">{item.shortcut}</span>\n                  )}\n                </button>\n              ))}\n            </div>\n          )}\n        </motion.div>\n      )}\n    </AnimatePresence>\n  );\n}\n\n// Simple hover-based quick actions component (Discord style)\ninterface QuickActionsProps {\n  isVisible: boolean;\n  isOwn: boolean;\n  onReply: () => void;\n  onReact: () => void;\n  onMore: () => void;\n}\n\nexport function MessageQuickActions({\n  isVisible,\n  isOwn,\n  onReply,\n  onReact,\n  onMore,\n}: QuickActionsProps) {\n  return (\n    <AnimatePresence>\n      {isVisible && (\n        <motion.div\n          initial={{ opacity: 0, y: 5 }}\n          animate={{ opacity: 1, y: 0 }}\n          exit={{ opacity: 0, y: 5 }}\n          transition={{ duration: 0.1 }}\n          className={cn(\n            'absolute -top-8 flex items-center gap-0.5',\n            'bg-white dark:bg-gray-800 rounded-lg shadow-lg',\n            'border border-gray-200 dark:border-gray-700 p-0.5',\n            isOwn ? 'right-0' : 'left-8'\n          )}\n        >\n          <button\n            onClick={onReact}\n            className=\"p-1.5 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors\"\n            title=\"Add reaction\"\n          >\n            <span className=\"text-sm\">ðŸ˜€</span>\n          </button>\n          <button\n            onClick={onReply}\n            className=\"p-1.5 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors\"\n            title=\"Reply\"\n          >\n            <Reply className=\"w-4 h-4 text-gray-500\" />\n          </button>\n          <button\n            onClick={onMore}\n            className=\"p-1.5 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors\"\n            title=\"More options\"\n          >\n            <MoreHorizontal className=\"w-4 h-4 text-gray-500\" />\n          </button>\n        </motion.div>\n      )}\n    </AnimatePresence>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1043, "column": 0}, "map": {"version":3,"sources":["file:///home/yasmanth/Pictures/vormex/vormex-web/src/components/chat/ChatSettingsPanel.tsx"],"sourcesContent":["'use client';\n\nimport React, { useState, useEffect } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { cn } from '@/lib/utils';\nimport {\n  X,\n  Image as ImageIcon,\n  FileText,\n  Video,\n  Music,\n  Trash2,\n  Bell,\n  BellOff,\n  ChevronRight,\n  Palette,\n  Shield,\n  Ban,\n  Flag,\n  Search,\n} from 'lucide-react';\n\n// Wallpaper option type\ninterface WallpaperOption {\n  id: string;\n  name: string;\n  color: string;\n  preview?: string | null;\n  pattern?: string;\n}\n\n// Default wallpaper options\nconst WALLPAPER_OPTIONS: WallpaperOption[] = [\n  { id: 'default', name: 'Default', color: 'bg-gray-50 dark:bg-gray-900' },\n  { id: 'gradient-1', name: 'Ocean', color: 'bg-gradient-to-br from-blue-100 to-cyan-100 dark:from-blue-900/30 dark:to-cyan-900/30' },\n  { id: 'gradient-2', name: 'Sunset', color: 'bg-gradient-to-br from-orange-100 to-pink-100 dark:from-orange-900/30 dark:to-pink-900/30' },\n  { id: 'gradient-3', name: 'Forest', color: 'bg-gradient-to-br from-green-100 to-emerald-100 dark:from-green-900/30 dark:to-emerald-900/30' },\n  { id: 'gradient-4', name: 'Lavender', color: 'bg-gradient-to-br from-purple-100 to-violet-100 dark:from-purple-900/30 dark:to-violet-900/30' },\n  { id: 'gradient-5', name: 'Rose', color: 'bg-gradient-to-br from-rose-100 to-pink-100 dark:from-rose-900/30 dark:to-pink-900/30' },\n  { id: 'gradient-6', name: 'Midnight', color: 'bg-gradient-to-br from-slate-800 to-gray-900' },\n  { id: 'gradient-7', name: 'Sky', color: 'bg-gradient-to-br from-sky-100 to-indigo-100 dark:from-sky-900/30 dark:to-indigo-900/30' },\n  { id: 'gradient-8', name: 'Amber', color: 'bg-gradient-to-br from-amber-100 to-yellow-100 dark:from-amber-900/30 dark:to-yellow-900/30' },\n  { id: 'pattern-1', name: 'Dots', color: 'bg-gray-100 dark:bg-gray-800', pattern: 'bg-[radial-gradient(circle,_#00000010_1px,_transparent_1px)] bg-[size:20px_20px]' },\n  { id: 'pattern-2', name: 'Grid', color: 'bg-gray-100 dark:bg-gray-800', pattern: 'bg-[linear-gradient(#00000008_1px,_transparent_1px),linear-gradient(90deg,_#00000008_1px,_transparent_1px)] bg-[size:20px_20px]' },\n];\n\ninterface MediaItem {\n  id: string;\n  type: 'image' | 'video' | 'file' | 'audio';\n  url: string;\n  fileName?: string;\n  createdAt: string;\n}\n\ninterface ChatSettingsPanelProps {\n  isOpen: boolean;\n  onClose: () => void;\n  conversationId: string;\n  otherUser: {\n    id: string;\n    name: string;\n    username: string;\n    profileImage?: string | null;\n    isOnline?: boolean;\n  };\n  currentWallpaper: string;\n  onWallpaperChange: (wallpaperId: string) => void;\n  mediaItems?: MediaItem[];\n  onClearChat?: () => void;\n  onBlockUser?: () => void;\n  onReportUser?: () => void;\n}\n\ntype TabType = 'settings' | 'wallpaper' | 'media';\n\nexport default function ChatSettingsPanel({\n  isOpen,\n  onClose,\n  conversationId,\n  otherUser,\n  currentWallpaper,\n  onWallpaperChange,\n  mediaItems = [],\n  onClearChat,\n  onBlockUser,\n  onReportUser,\n}: ChatSettingsPanelProps) {\n  const [activeTab, setActiveTab] = useState<TabType>('settings');\n  const [isMuted, setIsMuted] = useState(false);\n  const [mediaFilter, setMediaFilter] = useState<'all' | 'images' | 'videos' | 'files'>('all');\n  const [searchQuery, setSearchQuery] = useState('');\n\n  // Load mute preference from localStorage\n  useEffect(() => {\n    const muted = localStorage.getItem(`chat_muted_${conversationId}`);\n    setIsMuted(muted === 'true');\n  }, [conversationId]);\n\n  const handleMuteToggle = () => {\n    const newMuted = !isMuted;\n    setIsMuted(newMuted);\n    localStorage.setItem(`chat_muted_${conversationId}`, String(newMuted));\n  };\n\n  // Filter media items\n  const filteredMedia = mediaItems.filter(item => {\n    if (mediaFilter === 'all') return true;\n    if (mediaFilter === 'images') return item.type === 'image';\n    if (mediaFilter === 'videos') return item.type === 'video';\n    if (mediaFilter === 'files') return item.type === 'file' || item.type === 'audio';\n    return true;\n  });\n\n  return (\n    <AnimatePresence>\n      {isOpen && (\n        <>\n          {/* Backdrop */}\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            onClick={onClose}\n            className=\"fixed inset-0 bg-black/30 backdrop-blur-sm z-40\"\n          />\n\n          {/* Panel */}\n          <motion.div\n            initial={{ x: '100%' }}\n            animate={{ x: 0 }}\n            exit={{ x: '100%' }}\n            transition={{ type: 'spring', damping: 25, stiffness: 200 }}\n            className=\"fixed right-0 top-0 bottom-0 w-full max-w-md bg-white dark:bg-gray-900 shadow-xl z-50 flex flex-col\"\n          >\n            {/* Header */}\n            <div className=\"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700\">\n              <h2 className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n                Chat Info\n              </h2>\n              <button\n                onClick={onClose}\n                className=\"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition-colors\"\n              >\n                <X className=\"w-5 h-5\" />\n              </button>\n            </div>\n\n            {/* User Info */}\n            <div className=\"p-6 border-b border-gray-200 dark:border-gray-700 flex flex-col items-center\">\n              <div className=\"w-20 h-20 rounded-full bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center text-white text-2xl font-semibold mb-3\">\n                {otherUser.profileImage ? (\n                  <img\n                    src={otherUser.profileImage}\n                    alt={otherUser.name}\n                    className=\"w-20 h-20 rounded-full object-cover\"\n                  />\n                ) : (\n                  otherUser.name.charAt(0).toUpperCase()\n                )}\n              </div>\n              <h3 className=\"text-xl font-semibold text-gray-900 dark:text-white\">{otherUser.name}</h3>\n              <p className=\"text-gray-500 dark:text-gray-400\">@{otherUser.username}</p>\n              {otherUser.isOnline && (\n                <span className=\"mt-2 px-2 py-0.5 bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 text-xs rounded-full\">\n                  Online\n                </span>\n              )}\n            </div>\n\n            {/* Tabs */}\n            <div className=\"flex border-b border-gray-200 dark:border-gray-700\">\n              {[\n                { id: 'settings', label: 'Settings' },\n                { id: 'wallpaper', label: 'Wallpaper' },\n                { id: 'media', label: 'Media' },\n              ].map((tab) => (\n                <button\n                  key={tab.id}\n                  onClick={() => setActiveTab(tab.id as TabType)}\n                  className={cn(\n                    'flex-1 py-3 text-sm font-medium transition-colors relative',\n                    activeTab === tab.id\n                      ? 'text-blue-600 dark:text-blue-400'\n                      : 'text-gray-500 hover:text-gray-700 dark:hover:text-gray-300'\n                  )}\n                >\n                  {tab.label}\n                  {activeTab === tab.id && (\n                    <motion.div\n                      layoutId=\"activeTab\"\n                      className=\"absolute bottom-0 left-0 right-0 h-0.5 bg-blue-600 dark:bg-blue-400\"\n                    />\n                  )}\n                </button>\n              ))}\n            </div>\n\n            {/* Tab Content */}\n            <div className=\"flex-1 overflow-y-auto\">\n              {/* Settings Tab */}\n              {activeTab === 'settings' && (\n                <div className=\"p-4 space-y-2\">\n                  {/* Mute Notifications */}\n                  <button\n                    onClick={handleMuteToggle}\n                    className=\"w-full flex items-center justify-between p-3 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors\"\n                  >\n                    <div className=\"flex items-center gap-3\">\n                      {isMuted ? (\n                        <BellOff className=\"w-5 h-5 text-gray-500\" />\n                      ) : (\n                        <Bell className=\"w-5 h-5 text-gray-500\" />\n                      )}\n                      <span className=\"text-gray-900 dark:text-white\">Mute Notifications</span>\n                    </div>\n                    <div className={cn(\n                      'w-10 h-6 rounded-full transition-colors relative',\n                      isMuted ? 'bg-blue-600' : 'bg-gray-300 dark:bg-gray-600'\n                    )}>\n                      <div className={cn(\n                        'absolute top-1 w-4 h-4 bg-white rounded-full transition-transform',\n                        isMuted ? 'translate-x-5' : 'translate-x-1'\n                      )} />\n                    </div>\n                  </button>\n\n                  {/* Divider */}\n                  <div className=\"my-4 border-t border-gray-200 dark:border-gray-700\" />\n\n                  {/* Clear Chat */}\n                  <button\n                    onClick={onClearChat}\n                    className=\"w-full flex items-center gap-3 p-3 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors text-red-600 dark:text-red-400\"\n                  >\n                    <Trash2 className=\"w-5 h-5\" />\n                    <span>Clear Chat History</span>\n                  </button>\n\n                  {/* Block User */}\n                  <button\n                    onClick={onBlockUser}\n                    className=\"w-full flex items-center gap-3 p-3 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors text-red-600 dark:text-red-400\"\n                  >\n                    <Ban className=\"w-5 h-5\" />\n                    <span>Block {otherUser.name}</span>\n                  </button>\n\n                  {/* Report User */}\n                  <button\n                    onClick={onReportUser}\n                    className=\"w-full flex items-center gap-3 p-3 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors text-red-600 dark:text-red-400\"\n                  >\n                    <Flag className=\"w-5 h-5\" />\n                    <span>Report</span>\n                  </button>\n                </div>\n              )}\n\n              {/* Wallpaper Tab */}\n              {activeTab === 'wallpaper' && (\n                <div className=\"p-4\">\n                  <p className=\"text-sm text-gray-500 dark:text-gray-400 mb-4\">\n                    Choose a wallpaper for this chat\n                  </p>\n                  <div className=\"grid grid-cols-3 gap-3\">\n                    {WALLPAPER_OPTIONS.map((wallpaper) => (\n                      <button\n                        key={wallpaper.id}\n                        onClick={() => onWallpaperChange(wallpaper.id)}\n                        className={cn(\n                          'aspect-[3/4] rounded-xl overflow-hidden relative transition-all',\n                          wallpaper.color,\n                          wallpaper.pattern,\n                          currentWallpaper === wallpaper.id\n                            ? 'ring-2 ring-blue-500 ring-offset-2 dark:ring-offset-gray-900'\n                            : 'hover:scale-105'\n                        )}\n                      >\n                        {wallpaper.preview && (\n                          <img\n                            src={wallpaper.preview}\n                            alt={wallpaper.name}\n                            className=\"w-full h-full object-cover\"\n                          />\n                        )}\n                        <div className=\"absolute bottom-0 left-0 right-0 p-2 bg-gradient-to-t from-black/50 to-transparent\">\n                          <span className=\"text-xs text-white font-medium\">{wallpaper.name}</span>\n                        </div>\n                        {currentWallpaper === wallpaper.id && (\n                          <div className=\"absolute top-2 right-2 w-5 h-5 bg-blue-500 rounded-full flex items-center justify-center\">\n                            <svg className=\"w-3 h-3 text-white\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n                              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={3} d=\"M5 13l4 4L19 7\" />\n                            </svg>\n                          </div>\n                        )}\n                      </button>\n                    ))}\n                  </div>\n                </div>\n              )}\n\n              {/* Media Tab */}\n              {activeTab === 'media' && (\n                <div className=\"p-4\">\n                  {/* Search */}\n                  <div className=\"relative mb-4\">\n                    <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400\" />\n                    <input\n                      type=\"text\"\n                      value={searchQuery}\n                      onChange={(e) => setSearchQuery(e.target.value)}\n                      placeholder=\"Search media...\"\n                      className=\"w-full pl-10 pr-4 py-2 bg-gray-100 dark:bg-gray-800 rounded-lg border-0 focus:ring-2 focus:ring-blue-500\"\n                    />\n                  </div>\n\n                  {/* Filter buttons */}\n                  <div className=\"flex gap-2 mb-4 overflow-x-auto pb-2\">\n                    {[\n                      { id: 'all', label: 'All', icon: null },\n                      { id: 'images', label: 'Images', icon: ImageIcon },\n                      { id: 'videos', label: 'Videos', icon: Video },\n                      { id: 'files', label: 'Files', icon: FileText },\n                    ].map((filter) => (\n                      <button\n                        key={filter.id}\n                        onClick={() => setMediaFilter(filter.id as any)}\n                        className={cn(\n                          'flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm whitespace-nowrap transition-colors',\n                          mediaFilter === filter.id\n                            ? 'bg-blue-600 text-white'\n                            : 'bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700'\n                        )}\n                      >\n                        {filter.icon && <filter.icon className=\"w-4 h-4\" />}\n                        {filter.label}\n                      </button>\n                    ))}\n                  </div>\n\n                  {/* Media Grid */}\n                  {filteredMedia.length > 0 ? (\n                    <div className=\"grid grid-cols-3 gap-2\">\n                      {filteredMedia.map((item) => (\n                        <a\n                          key={item.id}\n                          href={item.url}\n                          target=\"_blank\"\n                          rel=\"noopener noreferrer\"\n                          className=\"aspect-square rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-800 hover:opacity-80 transition-opacity relative group\"\n                        >\n                          {item.type === 'image' ? (\n                            <img\n                              src={item.url}\n                              alt=\"\"\n                              className=\"w-full h-full object-cover\"\n                            />\n                          ) : item.type === 'video' ? (\n                            <div className=\"w-full h-full flex items-center justify-center bg-gray-200 dark:bg-gray-700\">\n                              <Video className=\"w-8 h-8 text-gray-500\" />\n                            </div>\n                          ) : (\n                            <div className=\"w-full h-full flex flex-col items-center justify-center p-2\">\n                              <FileText className=\"w-8 h-8 text-gray-500 mb-1\" />\n                              <span className=\"text-xs text-gray-500 truncate w-full text-center\">\n                                {item.fileName || 'File'}\n                              </span>\n                            </div>\n                          )}\n                        </a>\n                      ))}\n                    </div>\n                  ) : (\n                    <div className=\"text-center py-12 text-gray-500\">\n                      <ImageIcon className=\"w-12 h-12 mx-auto mb-3 opacity-50\" />\n                      <p>No media shared yet</p>\n                      <p className=\"text-sm\">Photos, videos, and files will appear here</p>\n                    </div>\n                  )}\n                </div>\n              )}\n            </div>\n          </motion.div>\n        </>\n      )}\n    </AnimatePresence>\n  );\n}\n\n// Export wallpaper options for use in other components\nexport { WALLPAPER_OPTIONS };\nexport type { MediaItem };\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1747, "column": 0}, "map": {"version":3,"sources":["file:///home/yasmanth/Pictures/vormex/vormex-web/src/components/chat/ChatMessages.tsx"],"sourcesContent":["'use client';\n\nimport React, { useEffect, useRef, useState, useCallback } from 'react';\nimport { Message, getMessages, MessagesResponse } from '@/lib/api/chat';\nimport { \n  getSocket, \n  joinChatRoom, \n  leaveChatRoom, \n  markChatAsRead,\n  deleteChatMessage,\n  editChatMessage,\n  reactToChatMessage\n} from '@/lib/socket';\nimport { format, isToday, isYesterday, isSameDay } from 'date-fns';\nimport { cn } from '@/lib/utils';\nimport MessageMenu, { MessageQuickActions } from './MessageMenu';\nimport { WALLPAPER_OPTIONS } from './ChatSettingsPanel';\nimport type { UploadingMessage } from './ChatInput';\n\ninterface ChatMessagesProps {\n  conversationId: string;\n  currentUserId: string;\n  otherUser: {\n    id: string;\n    name: string;\n    username: string;\n    profileImage?: string | null;\n    isOnline?: boolean;\n  };\n  wallpaper?: string;\n  onReply?: (message: { id: string; content: string; senderName: string }) => void;\n  uploadingMessages?: UploadingMessage[];\n  onLastMessageUpdate?: (message: string) => void;\n}\n\nconst REACTION_EMOJIS = ['â¤ï¸', 'ðŸ‘', 'ðŸ˜‚', 'ðŸ˜®', 'ðŸ˜¢', 'ðŸ™'];\n\nexport default function ChatMessages({\n  conversationId,\n  currentUserId,\n  otherUser,\n  wallpaper = 'default',\n  onReply,\n  uploadingMessages = [],\n  onLastMessageUpdate,\n}: ChatMessagesProps) {\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [loadingMore, setLoadingMore] = useState(false);\n  const [hasMore, setHasMore] = useState(false);\n  const [nextCursor, setNextCursor] = useState<string | undefined>();\n  const [typingUser, setTypingUser] = useState<string | null>(null);\n  const [highlightedMessageId, setHighlightedMessageId] = useState<string | null>(null);\n  const [viewingImage, setViewingImage] = useState<string | null>(null);\n  const [viewingVideo, setViewingVideo] = useState<string | null>(null);\n  \n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const messagesContainerRef = useRef<HTMLDivElement>(null);\n  const messageRefs = useRef<Map<string, HTMLDivElement>>(new Map());\n  const [shouldAutoScroll, setShouldAutoScroll] = useState(true);\n\n  // Scroll to a specific message and highlight it\n  const scrollToMessage = useCallback((messageId: string) => {\n    const messageElement = messageRefs.current.get(messageId);\n    if (messageElement) {\n      messageElement.scrollIntoView({ behavior: 'smooth', block: 'center' });\n      setHighlightedMessageId(messageId);\n      // Remove highlight after 1.5 seconds\n      setTimeout(() => {\n        setHighlightedMessageId(null);\n      }, 1500);\n    }\n  }, []);\n\n  // Register message ref\n  const registerMessageRef = useCallback((messageId: string, element: HTMLDivElement | null) => {\n    if (element) {\n      messageRefs.current.set(messageId, element);\n    } else {\n      messageRefs.current.delete(messageId);\n    }\n  }, []);\n\n  // Fetch messages\n  // Helper to determine if a message was edited based on timestamp difference\n  const wasMessageEdited = (message: Message): boolean => {\n    if (!message.createdAt || !message.updatedAt) return false;\n    const created = new Date(message.createdAt).getTime();\n    const updated = new Date(message.updatedAt).getTime();\n    // Consider edited if there's at least 1 second difference\n    // Prisma sets both timestamps at the exact same moment on creation\n    return updated - created >= 1000;\n  };\n\n  const fetchMessages = useCallback(async (cursor?: string) => {\n    try {\n      if (cursor) {\n        setLoadingMore(true);\n      } else {\n        setLoading(true);\n      }\n\n      const result = await getMessages(conversationId, 50, cursor);\n      \n      // Add isEdited flag to each message\n      const messagesWithEditFlag = result.messages.map(msg => ({\n        ...msg,\n        isEdited: wasMessageEdited(msg),\n      }));\n\n      if (cursor) {\n        // Prepend older messages\n        setMessages(prev => [...messagesWithEditFlag, ...prev]);\n      } else {\n        setMessages(messagesWithEditFlag);\n        \n        // Find the last message from the other user for AI assistant\n        if (onLastMessageUpdate) {\n          const lastFromOther = [...result.messages]\n            .reverse()\n            .find(m => m.senderId !== currentUserId && m.content);\n          if (lastFromOther) {\n            onLastMessageUpdate(lastFromOther.content);\n          }\n        }\n      }\n\n      setHasMore(result.hasMore);\n      setNextCursor(result.nextCursor);\n    } catch (err: any) {\n      console.error('Failed to fetch messages:', err);\n    } finally {\n      setLoading(false);\n      setLoadingMore(false);\n    }\n  }, [conversationId, currentUserId, onLastMessageUpdate]);\n\n  // Initial load and join room\n  useEffect(() => {\n    fetchMessages();\n    joinChatRoom(conversationId);\n    markChatAsRead(conversationId);\n\n    return () => {\n      leaveChatRoom(conversationId);\n    };\n  }, [conversationId, fetchMessages]);\n\n  // Socket event listeners\n  useEffect(() => {\n    const socket = getSocket();\n    if (!socket) return;\n\n    const handleNewMessage = (data: { conversationId: string; message: Message }) => {\n      if (data.conversationId === conversationId) {\n        setMessages(prev => [...prev, data.message]);\n        setShouldAutoScroll(true);\n        \n        // Mark as read if from other user\n        if (data.message.senderId !== currentUserId) {\n          markChatAsRead(conversationId);\n          // Update last received message for AI assistant\n          if (data.message.content && onLastMessageUpdate) {\n            onLastMessageUpdate(data.message.content);\n          }\n        }\n      }\n    };\n\n    const handleTyping = (data: { conversationId: string; userId: string; isTyping: boolean }) => {\n      if (data.conversationId === conversationId && data.userId !== currentUserId) {\n        setTypingUser(data.isTyping ? data.userId : null);\n      }\n    };\n\n    const handleMessagesRead = (data: { conversationId: string; readBy: string; readAt: Date }) => {\n      if (data.conversationId === conversationId) {\n        setMessages(prev => \n          prev.map(m => \n            m.senderId === currentUserId && m.status !== 'READ'\n              ? { ...m, status: 'READ', readAt: new Date(data.readAt).toISOString() }\n              : m\n          )\n        );\n      }\n    };\n\n    const handleMessagesDelivered = (data: { conversationId: string; deliveredAt: Date }) => {\n      if (data.conversationId === conversationId) {\n        setMessages(prev => \n          prev.map(m => \n            m.senderId === currentUserId && m.status === 'SENT'\n              ? { ...m, status: 'DELIVERED', deliveredAt: new Date(data.deliveredAt).toISOString() }\n              : m\n          )\n        );\n      }\n    };\n\n    const handleError = (data: { message: string }) => {\n      console.error('Chat socket error:', data.message);\n    };\n\n    const handleMessageDeleted = (data: { messageId: string; conversationId: string; forEveryone: boolean }) => {\n      if (data.conversationId === conversationId) {\n        if (data.forEveryone) {\n          setMessages(prev => \n            prev.map(m => \n              m.id === data.messageId \n                ? { ...m, isDeleted: true, content: 'This message was deleted' } \n                : m\n            )\n          );\n        } else {\n          setMessages(prev => prev.filter(m => m.id !== data.messageId));\n        }\n      }\n    };\n\n    const handleMessageEdited = (data: { messageId: string; conversationId: string; content: string; editedAt: Date }) => {\n      if (data.conversationId === conversationId) {\n        setMessages(prev => \n          prev.map(m => \n            m.id === data.messageId \n              ? { ...m, content: data.content, updatedAt: String(data.editedAt), isEdited: true } \n              : m\n          )\n        );\n      }\n    };\n\n    const handleReaction = (data: { messageId: string; conversationId: string; userId: string; emoji: string; action: string }) => {\n      if (data.conversationId === conversationId) {\n        setMessages(prev => \n          prev.map(m => {\n            if (m.id !== data.messageId) return m;\n            \n            let reactions = [...(m.reactions || [])];\n            \n            if (data.action === 'removed') {\n              reactions = reactions.filter(r => !(r.userId === data.userId));\n            } else if (data.action === 'added') {\n              reactions.push({\n                id: `temp-${Date.now()}`,\n                userId: data.userId,\n                emoji: data.emoji,\n                user: { id: data.userId, username: '', name: '' }\n              });\n            } else if (data.action === 'updated') {\n              const index = reactions.findIndex(r => r.userId === data.userId);\n              if (index >= 0) {\n                reactions[index] = { ...reactions[index], emoji: data.emoji };\n              }\n            }\n            \n            return { ...m, reactions };\n          })\n        );\n      }\n    };\n\n    socket.on('chat:new_message', handleNewMessage);\n    socket.on('chat:user_typing', handleTyping);\n    socket.on('chat:messages_read', handleMessagesRead);\n    socket.on('chat:messages_delivered', handleMessagesDelivered);\n    socket.on('chat:message_deleted', handleMessageDeleted);\n    socket.on('chat:message_edited', handleMessageEdited);\n    socket.on('chat:message_reaction', handleReaction);\n    socket.on('error', handleError);\n\n    return () => {\n      socket.off('chat:new_message', handleNewMessage);\n      socket.off('chat:user_typing', handleTyping);\n      socket.off('chat:messages_read', handleMessagesRead);\n      socket.off('chat:messages_delivered', handleMessagesDelivered);\n      socket.off('chat:message_deleted', handleMessageDeleted);\n      socket.off('chat:message_edited', handleMessageEdited);\n      socket.off('chat:message_reaction', handleReaction);\n      socket.off('error', handleError);\n    };\n  }, [conversationId, currentUserId, otherUser.id]);\n\n  // Auto-scroll to bottom\n  useEffect(() => {\n    if (shouldAutoScroll && messagesEndRef.current) {\n      messagesEndRef.current.scrollIntoView({ behavior: 'smooth' });\n      setShouldAutoScroll(false);\n    }\n  }, [messages, shouldAutoScroll]);\n\n  // Scroll detection for loading more\n  const handleScroll = (e: React.UIEvent<HTMLDivElement>) => {\n    const target = e.currentTarget;\n    if (target.scrollTop < 100 && hasMore && !loadingMore) {\n      fetchMessages(nextCursor);\n    }\n  };\n\n  // Group messages by date\n  const groupedMessages = messages.reduce((groups, message) => {\n    const date = new Date(message.createdAt);\n    const dateKey = format(date, 'yyyy-MM-dd');\n    \n    if (!groups[dateKey]) {\n      groups[dateKey] = [];\n    }\n    groups[dateKey].push(message);\n    \n    return groups;\n  }, {} as Record<string, Message[]>);\n\n  if (loading) {\n    return (\n      <div className=\"flex-1 flex items-center justify-center\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\n      </div>\n    );\n  }\n\n  // Get wallpaper styles\n  const wallpaperOption = WALLPAPER_OPTIONS.find(w => w.id === wallpaper) || WALLPAPER_OPTIONS[0];\n  const wallpaperClasses = cn(wallpaperOption.color, wallpaperOption.pattern);\n\n  return (\n    <>\n    <div \n      ref={messagesContainerRef}\n      className={cn(\"flex-1 overflow-y-auto p-4 space-y-4\", wallpaperClasses)}\n      onScroll={handleScroll}\n    >\n      {loadingMore && (\n        <div className=\"flex justify-center py-2\">\n          <div className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600\"></div>\n        </div>\n      )}\n\n      {Object.entries(groupedMessages).map(([dateKey, dateMessages]) => (\n        <div key={dateKey}>\n          {/* Date separator */}\n          <div className=\"flex items-center justify-center my-4\">\n            <div className=\"bg-gray-200 dark:bg-gray-700 px-3 py-1 rounded-full text-xs text-gray-600 dark:text-gray-300\">\n              {formatDateSeparator(new Date(dateKey))}\n            </div>\n          </div>\n\n          {/* Messages for this date */}\n          {dateMessages.map((message, index) => {\n            const prevMessage = index > 0 ? dateMessages[index - 1] : null;\n            const showAvatar = !prevMessage || prevMessage.senderId !== message.senderId;\n            \n            return (\n              <MessageBubble\n                key={message.id}\n                message={message}\n                isOwn={message.senderId === currentUserId}\n                showAvatar={showAvatar}\n                otherUser={otherUser}\n                conversationId={conversationId}\n                isHighlighted={highlightedMessageId === message.id}\n                onScrollToReply={scrollToMessage}\n                registerRef={(el) => registerMessageRef(message.id, el)}\n                onReply={onReply ? () => onReply({\n                  id: message.id,\n                  content: message.content,\n                  senderName: message.senderId === currentUserId ? 'You' : otherUser.name,\n                }) : undefined}\n                onViewImage={setViewingImage}\n                onViewVideo={setViewingVideo}\n              />\n            );\n          })}\n        </div>\n      ))}\n\n      {/* Uploading Messages */}\n      {uploadingMessages.map(uploadingMsg => (\n        <div key={uploadingMsg.id} className=\"flex justify-end mb-2\">\n          <div className=\"relative max-w-[70%]\">\n            <div className=\"bg-blue-600 text-white px-4 py-2 rounded-2xl rounded-br-sm\">\n              {/* Preview for images/videos */}\n              {uploadingMsg.preview && (uploadingMsg.type === 'image' || uploadingMsg.type === 'video') && (\n                <div className=\"relative mb-2 rounded-lg overflow-hidden\">\n                  {uploadingMsg.type === 'image' ? (\n                    <img \n                      src={uploadingMsg.preview} \n                      alt=\"Uploading\" \n                      className=\"max-w-full opacity-70\"\n                      style={{ maxHeight: '200px' }}\n                    />\n                  ) : (\n                    <video \n                      src={uploadingMsg.preview}\n                      className=\"max-w-full opacity-70\"\n                      style={{ maxHeight: '200px' }}\n                      muted\n                    />\n                  )}\n                  {/* Overlay with spinner */}\n                  <div className=\"absolute inset-0 flex items-center justify-center bg-black/30\">\n                    <div className=\"relative\">\n                      <svg className=\"w-12 h-12\" viewBox=\"0 0 36 36\">\n                        <circle\n                          cx=\"18\"\n                          cy=\"18\"\n                          r=\"16\"\n                          fill=\"none\"\n                          stroke=\"rgba(255,255,255,0.3)\"\n                          strokeWidth=\"3\"\n                        />\n                        <circle\n                          cx=\"18\"\n                          cy=\"18\"\n                          r=\"16\"\n                          fill=\"none\"\n                          stroke=\"white\"\n                          strokeWidth=\"3\"\n                          strokeDasharray={`${uploadingMsg.progress}, 100`}\n                          strokeLinecap=\"round\"\n                          transform=\"rotate(-90 18 18)\"\n                        />\n                      </svg>\n                      <span className=\"absolute inset-0 flex items-center justify-center text-white text-xs font-medium\">\n                        {uploadingMsg.progress}%\n                      </span>\n                    </div>\n                  </div>\n                </div>\n              )}\n              \n              {/* For audio/documents - show icon with progress */}\n              {(uploadingMsg.type === 'audio' || uploadingMsg.type === 'document') && (\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"relative w-10 h-10\">\n                    <svg className=\"w-10 h-10\" viewBox=\"0 0 36 36\">\n                      <circle\n                        cx=\"18\"\n                        cy=\"18\"\n                        r=\"16\"\n                        fill=\"none\"\n                        stroke=\"rgba(255,255,255,0.3)\"\n                        strokeWidth=\"3\"\n                      />\n                      <circle\n                        cx=\"18\"\n                        cy=\"18\"\n                        r=\"16\"\n                        fill=\"none\"\n                        stroke=\"white\"\n                        strokeWidth=\"3\"\n                        strokeDasharray={`${uploadingMsg.progress}, 100`}\n                        strokeLinecap=\"round\"\n                        transform=\"rotate(-90 18 18)\"\n                      />\n                    </svg>\n                    <span className=\"absolute inset-0 flex items-center justify-center text-white text-xs\">\n                      {uploadingMsg.type === 'audio' ? 'ðŸŽ¤' : 'ðŸ“„'}\n                    </span>\n                  </div>\n                  <div className=\"flex-1\">\n                    <p className=\"text-sm truncate\">{uploadingMsg.fileName || 'Uploading...'}</p>\n                    <p className=\"text-xs opacity-70\">Sending... {uploadingMsg.progress}%</p>\n                  </div>\n                </div>\n              )}\n              \n              {/* Text label */}\n              {(uploadingMsg.type === 'image' || uploadingMsg.type === 'video') && (\n                <p className=\"text-sm\">\n                  {uploadingMsg.type === 'image' ? 'ðŸ“· Sending photo...' : 'ðŸŽ¥ Sending video...'}\n                </p>\n              )}\n            </div>\n          </div>\n        </div>\n      ))}\n\n      {/* Typing indicator */}\n      {typingUser && (\n        <div className=\"flex items-center gap-2 text-gray-500 text-sm\">\n          <div className=\"flex gap-1\">\n            <span className=\"animate-bounce\">â€¢</span>\n            <span className=\"animate-bounce\" style={{ animationDelay: '0.1s' }}>â€¢</span>\n            <span className=\"animate-bounce\" style={{ animationDelay: '0.2s' }}>â€¢</span>\n          </div>\n          <span>{otherUser.name} is typing...</span>\n        </div>\n      )}\n\n      <div ref={messagesEndRef} />\n    </div>\n\n    {/* Image Viewer Modal */}\n    {viewingImage && (\n      <div \n        className=\"fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4\"\n        onClick={() => setViewingImage(null)}\n      >\n        <button\n          onClick={() => setViewingImage(null)}\n          className=\"absolute top-4 right-4 text-white hover:bg-white/10 p-2 rounded-full transition-colors\"\n        >\n          <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-8 w-8\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n          </svg>\n        </button>\n        <img \n          src={viewingImage} \n          alt=\"Full size image\" \n          className=\"max-w-full max-h-full object-contain rounded-lg\"\n          onClick={(e) => e.stopPropagation()}\n        />\n        <a\n          href={viewingImage}\n          download\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n          onClick={(e) => e.stopPropagation()}\n          className=\"absolute bottom-4 right-4 bg-white/10 hover:bg-white/20 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors\"\n        >\n          <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4\" />\n          </svg>\n          Download\n        </a>\n      </div>\n    )}\n\n    {/* Video Viewer Modal */}\n    {viewingVideo && (\n      <div \n        className=\"fixed inset-0 bg-black/95 z-50 flex items-center justify-center p-4\"\n        onClick={() => setViewingVideo(null)}\n      >\n        <button\n          onClick={() => setViewingVideo(null)}\n          className=\"absolute top-4 right-4 text-white hover:bg-white/10 p-2 rounded-full transition-colors z-10\"\n        >\n          <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-8 w-8\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n          </svg>\n        </button>\n        <video \n          src={viewingVideo} \n          controls\n          autoPlay\n          className=\"max-w-full max-h-full rounded-lg\"\n          style={{ maxHeight: '90vh', maxWidth: '90vw' }}\n          onClick={(e) => e.stopPropagation()}\n        />\n        <a\n          href={viewingVideo}\n          download\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n          onClick={(e) => e.stopPropagation()}\n          className=\"absolute bottom-4 right-4 bg-white/10 hover:bg-white/20 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors\"\n        >\n          <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-5 w-5\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4\" />\n          </svg>\n          Download\n        </a>\n      </div>\n    )}\n    </>\n  );\n}\n\n// ============================================\n// Message Bubble Component\n// ============================================\ninterface MessageBubbleProps {\n  message: Message;\n  isOwn: boolean;\n  showAvatar: boolean;\n  otherUser: {\n    name: string;\n    profileImage?: string | null;\n  };\n  conversationId: string;\n  isHighlighted?: boolean;\n  onScrollToReply?: (messageId: string) => void;\n  registerRef?: (el: HTMLDivElement | null) => void;\n  onReply?: () => void;\n  onViewImage?: (url: string) => void;\n  onViewVideo?: (url: string) => void;\n}\n\nfunction MessageBubble({ \n  message, \n  isOwn, \n  showAvatar, \n  otherUser,\n  conversationId,\n  isHighlighted = false,\n  onScrollToReply,\n  registerRef,\n  onReply,\n  onViewImage,\n  onViewVideo,\n}: MessageBubbleProps) {\n  const [showActions, setShowActions] = useState(false);\n  const [showMenu, setShowMenu] = useState(false);\n  const [showReactions, setShowReactions] = useState(false);\n  const [isEditing, setIsEditing] = useState(false);\n  const [editContent, setEditContent] = useState(message.content);\n  const [copied, setCopied] = useState(false);\n\n  const handleDelete = (forEveryone: boolean) => {\n    deleteChatMessage(message.id, conversationId, forEveryone);\n    setShowActions(false);\n    setShowMenu(false);\n  };\n\n  const handleEdit = () => {\n    if (editContent.trim() && editContent !== message.content) {\n      editChatMessage(message.id, conversationId, editContent);\n    }\n    setIsEditing(false);\n  };\n\n  const handleReaction = (emoji: string) => {\n    reactToChatMessage(message.id, conversationId, emoji);\n    setShowReactions(false);\n  };\n\n  if (message.isDeleted) {\n    return (\n      <div \n        ref={registerRef}\n        className={cn(\n          'flex items-center gap-2',\n          isOwn ? 'justify-end' : 'justify-start'\n        )}\n      >\n        <div className=\"bg-gray-100 dark:bg-gray-800 text-gray-500 italic px-4 py-2 rounded-lg text-sm\">\n          This message was deleted\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div \n      ref={registerRef}\n      className={cn(\n        'flex gap-2 group transition-all duration-300',\n        isOwn ? 'justify-end' : 'justify-start',\n        isHighlighted && 'bg-yellow-100/50 dark:bg-yellow-900/30 -mx-2 px-2 py-1 rounded-lg'\n      )}\n      onMouseEnter={() => setShowActions(true)}\n      onMouseLeave={() => { setShowActions(false); setShowReactions(false); }}\n    >\n      {/* Avatar for received messages */}\n      {!isOwn && (\n        <div className={cn('w-8 h-8 flex-shrink-0', !showAvatar && 'invisible')}>\n          {showAvatar && (\n            <div className=\"w-8 h-8 rounded-full bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center text-white text-sm font-medium\">\n              {otherUser.profileImage ? (\n                <img\n                  src={otherUser.profileImage}\n                  alt={otherUser.name}\n                  className=\"w-8 h-8 rounded-full object-cover\"\n                />\n              ) : (\n                otherUser.name.charAt(0).toUpperCase()\n              )}\n            </div>\n          )}\n        </div>\n      )}\n\n      <div className={cn('max-w-[70%] relative', isOwn && 'order-first')}>\n        {/* Reply preview - clickable to scroll to original message */}\n        {message.replyTo && (\n          <button\n            onClick={() => onScrollToReply?.(message.replyTo!.id)}\n            className={cn(\n              'text-xs p-2 rounded-t-lg border-l-2 w-full text-left cursor-pointer hover:opacity-80 transition-opacity',\n              isOwn \n                ? 'bg-blue-600/20 border-blue-400' \n                : 'bg-gray-100 dark:bg-gray-800 border-gray-400'\n            )}\n          >\n            <span className=\"text-gray-500 text-[10px]\">â†© Replying to</span>\n            <p className=\"truncate text-gray-700 dark:text-gray-300\">{message.replyTo.content}</p>\n          </button>\n        )}\n\n        {/* Message content */}\n        <div className={cn(\n          'px-4 py-2 rounded-2xl relative',\n          isOwn \n            ? 'bg-blue-600 text-white rounded-br-sm' \n            : 'bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-white rounded-bl-sm',\n          message.replyTo && 'rounded-t-none'\n        )}>\n          {/* Image content */}\n          {message.mediaUrl && message.contentType === 'image' && (\n            <button \n              onClick={() => onViewImage?.(message.mediaUrl!)}\n              className=\"block w-full text-left\"\n            >\n              <img \n                src={message.mediaUrl} \n                alt=\"Shared image\" \n                className=\"rounded-lg max-w-full mb-2 cursor-pointer hover:opacity-90 transition-opacity\"\n                style={{ maxHeight: '300px' }}\n              />\n            </button>\n          )}\n\n          {/* Video content */}\n          {message.mediaUrl && message.contentType === 'video' && (\n            <div className=\"relative group cursor-pointer mb-2\" onClick={() => onViewVideo?.(message.mediaUrl!)}>\n              <video \n                src={message.mediaUrl}\n                className=\"rounded-lg max-w-full\"\n                style={{ maxHeight: '300px' }}\n              />\n              <div className=\"absolute inset-0 flex items-center justify-center bg-black/30 group-hover:bg-black/40 transition-colors rounded-lg\">\n                <div className=\"w-14 h-14 rounded-full bg-white/90 flex items-center justify-center\">\n                  <svg xmlns=\"http://www.w3.org/2000/svg\" className=\"h-8 w-8 text-gray-900 ml-1\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path d=\"M8 5v14l11-7z\"/>\n                  </svg>\n                </div>\n              </div>\n            </div>\n          )}\n\n          {/* Audio content */}\n          {message.mediaUrl && message.contentType === 'audio' && (\n            <div className={cn(\n              'flex items-center gap-3 p-2 rounded-lg mb-2',\n              isOwn ? 'bg-blue-700/50' : 'bg-gray-200 dark:bg-gray-700'\n            )}>\n              <div className=\"w-10 h-10 rounded-full bg-green-500 flex items-center justify-center\">\n                <span className=\"text-white text-lg\">ðŸŽ¤</span>\n              </div>\n              <audio \n                src={message.mediaUrl}\n                controls\n                className=\"flex-1 h-8\"\n                style={{ maxWidth: '200px' }}\n              />\n            </div>\n          )}\n\n          {/* Document content */}\n          {message.mediaUrl && message.contentType === 'document' && (\n            <a \n              href={message.mediaUrl} \n              target=\"_blank\" \n              rel=\"noopener noreferrer\"\n              className={cn(\n                'flex items-center gap-3 p-3 rounded-lg mb-2 transition-colors',\n                isOwn ? 'bg-blue-700/50 hover:bg-blue-700/70' : 'bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600'\n              )}\n            >\n              <div className=\"w-10 h-10 rounded-lg bg-red-500 flex items-center justify-center\">\n                <span className=\"text-white text-lg\">ðŸ“„</span>\n              </div>\n              <div className=\"flex-1 min-w-0\">\n                <p className={cn('font-medium truncate text-sm', isOwn ? 'text-white' : 'text-gray-900 dark:text-white')}>\n                  {message.fileName || 'Document'}\n                </p>\n                {message.fileSize && (\n                  <p className={cn('text-xs', isOwn ? 'text-blue-200' : 'text-gray-500')}>\n                    {(message.fileSize / 1024).toFixed(1)} KB\n                  </p>\n                )}\n              </div>\n            </a>\n          )}\n\n          {/* Generic file content */}\n          {message.mediaUrl && message.contentType === 'file' && (\n            <a \n              href={message.mediaUrl} \n              target=\"_blank\" \n              rel=\"noopener noreferrer\"\n              className=\"flex items-center gap-2 bg-white/10 p-2 rounded mb-2 hover:bg-white/20\"\n            >\n              <span>ðŸ“Ž</span>\n              <span className=\"truncate\">{message.fileName || 'File'}</span>\n            </a>\n          )}\n\n          {/* Text content */}\n          {isEditing ? (\n            <div className=\"flex gap-2\">\n              <input\n                type=\"text\"\n                value={editContent}\n                onChange={(e) => setEditContent(e.target.value)}\n                className=\"flex-1 bg-white/20 rounded px-2 py-1 text-sm\"\n                autoFocus\n                onKeyDown={(e) => {\n                  if (e.key === 'Enter') handleEdit();\n                  if (e.key === 'Escape') setIsEditing(false);\n                }}\n              />\n              <button onClick={handleEdit} className=\"text-xs\">Save</button>\n            </div>\n          ) : (\n            <p className=\"break-words whitespace-pre-wrap\">{message.content}</p>\n          )}\n\n          {/* Edited indicator - only show if message was explicitly edited */}\n          {!message.isDeleted && message.isEdited && (\n            <span className=\"text-xs opacity-60 ml-1\">(edited)</span>\n          )}\n        </div>\n\n        {/* Reactions */}\n        {message.reactions && message.reactions.length > 0 && (\n          <div className={cn(\n            'flex flex-wrap gap-1 mt-1',\n            isOwn ? 'justify-end' : 'justify-start'\n          )}>\n            {Array.from(new Set(message.reactions.map(r => r.emoji))).map(emoji => {\n              const count = message.reactions.filter(r => r.emoji === emoji).length;\n              return (\n                <button\n                  key={emoji}\n                  onClick={() => handleReaction(emoji)}\n                  className=\"bg-gray-100 dark:bg-gray-800 px-2 py-0.5 rounded-full text-sm flex items-center gap-1 hover:bg-gray-200 dark:hover:bg-gray-700\"\n                >\n                  <span>{emoji}</span>\n                  <span className=\"text-xs text-gray-500\">{count}</span>\n                </button>\n              );\n            })}\n          </div>\n        )}\n\n        {/* Time and status */}\n        <div className={cn(\n          'text-xs text-gray-500 mt-1 flex items-center gap-1',\n          isOwn ? 'justify-end' : 'justify-start'\n        )}>\n          <span>{format(new Date(message.createdAt), 'HH:mm')}</span>\n          {isOwn && (\n            <span className={cn(\n              message.status === 'READ' && 'text-blue-500'\n            )}>\n              {message.status === 'READ' ? 'âœ“âœ“' : message.status === 'DELIVERED' ? 'âœ“âœ“' : 'âœ“'}\n            </span>\n          )}\n        </div>\n\n        {/* Quick Action buttons (Discord-style) */}\n        <MessageQuickActions\n          isVisible={showActions && !isEditing && !showMenu}\n          isOwn={isOwn}\n          onReply={() => onReply?.()}\n          onReact={() => setShowReactions(!showReactions)}\n          onMore={() => setShowMenu(true)}\n        />\n\n        {/* Full Message Menu */}\n        <MessageMenu\n          isOpen={showMenu}\n          onClose={() => setShowMenu(false)}\n          isOwn={isOwn}\n          messageId={message.id}\n          messageContent={message.content}\n          hasMedia={!!message.mediaUrl}\n          mediaUrl={message.mediaUrl}\n          onReply={() => onReply?.()}\n          onEdit={() => setIsEditing(true)}\n          onDelete={handleDelete}\n          onReact={handleReaction}\n          onCopy={() => {\n            setCopied(true);\n            setTimeout(() => setCopied(false), 2000);\n          }}\n          anchorPosition={isOwn ? 'right' : 'left'}\n        />\n\n        {/* Reaction picker */}\n        {showReactions && !showMenu && (\n          <div className={cn(\n            'absolute -top-10 flex items-center gap-1 bg-white dark:bg-gray-900 shadow-lg rounded-full px-2 py-1',\n            isOwn ? 'right-0' : 'left-0'\n          )}>\n            {REACTION_EMOJIS.map(emoji => (\n              <button\n                key={emoji}\n                onClick={() => handleReaction(emoji)}\n                className=\"hover:scale-125 transition-transform p-1\"\n              >\n                {emoji}\n              </button>\n            ))}\n          </div>\n        )}\n\n        {/* Copied notification */}\n        {copied && (\n          <div className=\"absolute -top-8 left-1/2 -translate-x-1/2 bg-black/70 text-white text-xs px-2 py-1 rounded\">\n            Copied!\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\n// ============================================\n// Utility Functions\n// ============================================\nfunction formatDateSeparator(date: Date): string {\n  if (isToday(date)) return 'Today';\n  if (isYesterday(date)) return 'Yesterday';\n  return format(date, 'MMMM d, yyyy');\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3084, "column": 0}, "map": {"version":3,"sources":["file:///home/yasmanth/Pictures/vormex/vormex-web/src/lib/api/connections.ts"],"sourcesContent":["import apiClient from './client';\nimport type { PersonCard } from './people';\n\n// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n// TYPES\n// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nexport type ConnectionStatus = 'none' | 'pending_sent' | 'pending_received' | 'connected' | 'blocked';\n\nexport interface Connection {\n  id: string;\n  status: 'PENDING' | 'ACCEPTED' | 'REJECTED' | 'BLOCKED';\n  message: string | null;\n  createdAt: string;\n  user: {\n    id: string;\n    username: string;\n    name: string;\n    profileImage: string | null;\n    headline: string | null;\n    college: string | null;\n  };\n}\n\nexport interface ConnectionsResponse {\n  connections: Connection[];\n  total: number;\n  page: number;\n  totalPages: number;\n  hasMore: boolean;\n}\n\nexport interface ConnectionStatusResponse {\n  status: ConnectionStatus;\n  connectionId?: string;\n  direction?: 'sent' | 'received';\n}\n\n// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n// API FUNCTIONS\n// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n/**\n * Send a connection request to another user\n */\nexport async function sendConnectionRequest(\n  receiverId: string,\n  message?: string\n): Promise<{ message: string; connection: Connection }> {\n  return apiClient.post('/connections/request', { receiverId, message });\n}\n\n/**\n * Accept a connection request\n */\nexport async function acceptConnectionRequest(\n  connectionId: string\n): Promise<{ message: string; connection: Connection }> {\n  return apiClient.post(`/connections/${connectionId}/accept`);\n}\n\n/**\n * Reject a connection request\n */\nexport async function rejectConnectionRequest(\n  connectionId: string\n): Promise<{ message: string }> {\n  return apiClient.post(`/connections/${connectionId}/reject`);\n}\n\n/**\n * Cancel a sent connection request\n */\nexport async function cancelConnectionRequest(\n  connectionId: string\n): Promise<{ message: string }> {\n  return apiClient.delete(`/connections/${connectionId}/cancel`);\n}\n\n/**\n * Remove an existing connection\n */\nexport async function removeConnection(\n  connectionId: string\n): Promise<{ message: string }> {\n  return apiClient.delete(`/connections/${connectionId}`);\n}\n\n/**\n * Get all connections for current user\n */\nexport async function getConnections(\n  page: number = 1,\n  limit: number = 20\n): Promise<ConnectionsResponse> {\n  return apiClient.get(`/connections?page=${page}&limit=${limit}`);\n}\n\n/**\n * Get all connections for a specific user\n */\nexport async function getUserConnections(\n  userId: string,\n  page: number = 1,\n  limit: number = 20\n): Promise<ConnectionsResponse> {\n  return apiClient.get(`/connections/user/${userId}?page=${page}&limit=${limit}`);\n}\n\n/**\n * Get pending connection requests (received)\n */\nexport async function getPendingRequests(\n  page: number = 1,\n  limit: number = 20\n): Promise<ConnectionsResponse> {\n  const response: any = await apiClient.get(`/connections/pending?page=${page}&limit=${limit}`);\n  // Backend returns 'requests', normalize to 'connections'\n  return {\n    connections: response.connections || response.requests || [],\n    total: response.total || 0,\n    page: response.page || page,\n    totalPages: response.totalPages || 1,\n    hasMore: response.hasMore || false,\n  };\n}\n\n/**\n * Get sent connection requests\n */\nexport async function getSentRequests(\n  page: number = 1,\n  limit: number = 20\n): Promise<ConnectionsResponse> {\n  const response: any = await apiClient.get(`/connections/sent?page=${page}&limit=${limit}`);\n  // Backend returns 'requests', normalize to 'connections'\n  return {\n    connections: response.connections || response.requests || [],\n    total: response.total || 0,\n    page: response.page || page,\n    totalPages: response.totalPages || 1,\n    hasMore: response.hasMore || false,\n  };\n}\n\n/**\n * Get connection status with a specific user\n */\nexport async function getConnectionStatus(\n  userId: string\n): Promise<ConnectionStatusResponse> {\n  return apiClient.get(`/connections/status/${userId}`);\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAAA;;AA6CO,eAAe,sBACpB,UAAkB,EAClB,OAAgB;IAEhB,OAAO,sIAAS,CAAC,IAAI,CAAC,wBAAwB;QAAE;QAAY;IAAQ;AACtE;AAKO,eAAe,wBACpB,YAAoB;IAEpB,OAAO,sIAAS,CAAC,IAAI,CAAC,CAAC,aAAa,EAAE,aAAa,OAAO,CAAC;AAC7D;AAKO,eAAe,wBACpB,YAAoB;IAEpB,OAAO,sIAAS,CAAC,IAAI,CAAC,CAAC,aAAa,EAAE,aAAa,OAAO,CAAC;AAC7D;AAKO,eAAe,wBACpB,YAAoB;IAEpB,OAAO,sIAAS,CAAC,MAAM,CAAC,CAAC,aAAa,EAAE,aAAa,OAAO,CAAC;AAC/D;AAKO,eAAe,iBACpB,YAAoB;IAEpB,OAAO,sIAAS,CAAC,MAAM,CAAC,CAAC,aAAa,EAAE,cAAc;AACxD;AAKO,eAAe,eACpB,OAAe,CAAC,EAChB,QAAgB,EAAE;IAElB,OAAO,sIAAS,CAAC,GAAG,CAAC,CAAC,kBAAkB,EAAE,KAAK,OAAO,EAAE,OAAO;AACjE;AAKO,eAAe,mBACpB,MAAc,EACd,OAAe,CAAC,EAChB,QAAgB,EAAE;IAElB,OAAO,sIAAS,CAAC,GAAG,CAAC,CAAC,kBAAkB,EAAE,OAAO,MAAM,EAAE,KAAK,OAAO,EAAE,OAAO;AAChF;AAKO,eAAe,mBACpB,OAAe,CAAC,EAChB,QAAgB,EAAE;IAElB,MAAM,WAAgB,MAAM,sIAAS,CAAC,GAAG,CAAC,CAAC,0BAA0B,EAAE,KAAK,OAAO,EAAE,OAAO;IAC5F,yDAAyD;IACzD,OAAO;QACL,aAAa,SAAS,WAAW,IAAI,SAAS,QAAQ,IAAI,EAAE;QAC5D,OAAO,SAAS,KAAK,IAAI;QACzB,MAAM,SAAS,IAAI,IAAI;QACvB,YAAY,SAAS,UAAU,IAAI;QACnC,SAAS,SAAS,OAAO,IAAI;IAC/B;AACF;AAKO,eAAe,gBACpB,OAAe,CAAC,EAChB,QAAgB,EAAE;IAElB,MAAM,WAAgB,MAAM,sIAAS,CAAC,GAAG,CAAC,CAAC,uBAAuB,EAAE,KAAK,OAAO,EAAE,OAAO;IACzF,yDAAyD;IACzD,OAAO;QACL,aAAa,SAAS,WAAW,IAAI,SAAS,QAAQ,IAAI,EAAE;QAC5D,OAAO,SAAS,KAAK,IAAI;QACzB,MAAM,SAAS,IAAI,IAAI;QACvB,YAAY,SAAS,UAAU,IAAI;QACnC,SAAS,SAAS,OAAO,IAAI;IAC/B;AACF;AAKO,eAAe,oBACpB,MAAc;IAEd,OAAO,sIAAS,CAAC,GAAG,CAAC,CAAC,oBAAoB,EAAE,QAAQ;AACtD"}},
    {"offset": {"line": 3161, "column": 0}, "map": {"version":3,"sources":["file:///home/yasmanth/Pictures/vormex/vormex-web/src/lib/api/ai-chat.ts"],"sourcesContent":["import apiClient from './client';\n\n// ============================================\n// Types\n// ============================================\n\nexport interface ConversationStartersResponse {\n  suggestions: string[];\n  type: 'conversation_starters';\n}\n\nexport interface RevivalSuggestionsResponse {\n  suggestions: string[];\n  type: 'revival_suggestions';\n}\n\nexport interface GrammarFixResponse {\n  corrected: string;\n  alternatives: string[];\n  type: 'grammar_fix';\n}\n\nexport interface SmartRepliesResponse {\n  suggestions: string[];\n  type: 'smart_replies';\n}\n\nexport interface ToneChangeResponse {\n  original: string;\n  result: string;\n  tone: string;\n  type: 'tone_change';\n}\n\nexport interface TranslationResponse {\n  original: string;\n  translated: string;\n  targetLanguage: string;\n  type: 'translation';\n}\n\nexport interface ExpansionResponse {\n  original: string;\n  expanded: string;\n  type: 'expansion';\n}\n\nexport type ToneType = 'professional' | 'casual' | 'friendly' | 'formal' | 'enthusiastic' | 'concise';\nexport type LanguageType = 'english' | 'hindi' | 'telugu' | 'hinglish' | 'tenglish';\n\n// ============================================\n// AI Chat API Functions\n// ============================================\n\n/**\n * Get personalized conversation starters based on both users' profiles\n */\nexport async function getConversationStarters(\n  otherUserId: string\n): Promise<ConversationStartersResponse> {\n  return apiClient.post('/ai/chat/conversation-starters', { otherUserId });\n}\n\n/**\n * Get suggestions to continue a stalled conversation\n */\nexport async function getChatRevivalSuggestions(\n  conversationId: string,\n  otherUserId: string\n): Promise<RevivalSuggestionsResponse> {\n  return apiClient.post('/ai/chat/revival-suggestions', {\n    conversationId,\n    otherUserId,\n  });\n}\n\n/**\n * Fix grammar and spelling in a message\n */\nexport async function fixGrammar(\n  message: string,\n  context?: string\n): Promise<GrammarFixResponse> {\n  return apiClient.post('/ai/chat/fix-grammar', { message, context });\n}\n\n/**\n * Get smart reply suggestions based on the last message\n */\nexport async function getSmartReplies(\n  lastMessage: string,\n  conversationId?: string\n): Promise<SmartRepliesResponse> {\n  return apiClient.post('/ai/chat/smart-replies', {\n    lastMessage,\n    conversationId,\n  });\n}\n\n/**\n * Change the tone of a message\n */\nexport async function changeTone(\n  message: string,\n  tone: ToneType\n): Promise<ToneChangeResponse> {\n  return apiClient.post('/ai/chat/change-tone', { message, tone });\n}\n\n/**\n * Translate a message to another language\n */\nexport async function translateMessage(\n  message: string,\n  targetLanguage: LanguageType\n): Promise<TranslationResponse> {\n  return apiClient.post('/ai/chat/translate', { message, targetLanguage });\n}\n\n/**\n * Expand a short message into a more detailed one\n */\nexport async function expandMessage(\n  message: string,\n  context?: 'professional' | 'casual'\n): Promise<ExpansionResponse> {\n  return apiClient.post('/ai/chat/expand', { message, context });\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAAA;;AAyDO,eAAe,wBACpB,WAAmB;IAEnB,OAAO,sIAAS,CAAC,IAAI,CAAC,kCAAkC;QAAE;IAAY;AACxE;AAKO,eAAe,0BACpB,cAAsB,EACtB,WAAmB;IAEnB,OAAO,sIAAS,CAAC,IAAI,CAAC,gCAAgC;QACpD;QACA;IACF;AACF;AAKO,eAAe,WACpB,OAAe,EACf,OAAgB;IAEhB,OAAO,sIAAS,CAAC,IAAI,CAAC,wBAAwB;QAAE;QAAS;IAAQ;AACnE;AAKO,eAAe,gBACpB,WAAmB,EACnB,cAAuB;IAEvB,OAAO,sIAAS,CAAC,IAAI,CAAC,0BAA0B;QAC9C;QACA;IACF;AACF;AAKO,eAAe,WACpB,OAAe,EACf,IAAc;IAEd,OAAO,sIAAS,CAAC,IAAI,CAAC,wBAAwB;QAAE;QAAS;IAAK;AAChE;AAKO,eAAe,iBACpB,OAAe,EACf,cAA4B;IAE5B,OAAO,sIAAS,CAAC,IAAI,CAAC,sBAAsB;QAAE;QAAS;IAAe;AACxE;AAKO,eAAe,cACpB,OAAe,EACf,OAAmC;IAEnC,OAAO,sIAAS,CAAC,IAAI,CAAC,mBAAmB;QAAE;QAAS;IAAQ;AAC9D"}},
    {"offset": {"line": 3224, "column": 0}, "map": {"version":3,"sources":["file:///home/yasmanth/Pictures/vormex/vormex-web/src/components/chat/AIChatAssistant.tsx"],"sourcesContent":["'use client';\n\nimport React, { useState } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { cn } from '@/lib/utils';\nimport {\n  Sparkles,\n  MessageSquarePlus,\n  RefreshCw,\n  SpellCheck,\n  Zap,\n  Languages,\n  ArrowUpRight,\n  Palette,\n  X,\n  Loader2,\n  Check,\n  ChevronDown,\n} from 'lucide-react';\nimport {\n  getConversationStarters,\n  getChatRevivalSuggestions,\n  fixGrammar,\n  getSmartReplies,\n  changeTone,\n  translateMessage,\n  expandMessage,\n  type ToneType,\n  type LanguageType,\n} from '@/lib/api/ai-chat';\n\n// ============================================\n// Types\n// ============================================\n\ninterface AIChatAssistantProps {\n  conversationId: string;\n  otherUserId: string;\n  otherUserName: string;\n  currentMessage: string;\n  lastReceivedMessage?: string;\n  onSuggestionSelect: (text: string) => void;\n  onClose?: () => void;\n}\n\ntype AIFeature = \n  | 'starters'\n  | 'revival'\n  | 'grammar'\n  | 'smart-reply'\n  | 'tone'\n  | 'translate'\n  | 'expand';\n\ninterface FeatureOption {\n  id: AIFeature;\n  label: string;\n  icon: React.ReactNode;\n  description: string;\n  requiresMessage?: boolean;\n  requiresReceivedMessage?: boolean;\n}\n\n// ============================================\n// Constants\n// ============================================\n\nconst FEATURES: FeatureOption[] = [\n  {\n    id: 'starters',\n    label: 'Ice Breakers',\n    icon: <MessageSquarePlus className=\"w-4 h-4\" />,\n    description: 'Personalized conversation starters',\n  },\n  {\n    id: 'revival',\n    label: 'Continue Chat',\n    icon: <RefreshCw className=\"w-4 h-4\" />,\n    description: 'Revive a stalled conversation',\n  },\n  {\n    id: 'smart-reply',\n    label: 'Quick Reply',\n    icon: <Zap className=\"w-4 h-4\" />,\n    description: 'Smart reply suggestions',\n    requiresReceivedMessage: true,\n  },\n  {\n    id: 'grammar',\n    label: 'Fix Grammar',\n    icon: <SpellCheck className=\"w-4 h-4\" />,\n    description: 'Fix grammar & spelling',\n    requiresMessage: true,\n  },\n  {\n    id: 'tone',\n    label: 'Change Tone',\n    icon: <Palette className=\"w-4 h-4\" />,\n    description: 'Rewrite in different tone',\n    requiresMessage: true,\n  },\n  {\n    id: 'translate',\n    label: 'Translate',\n    icon: <Languages className=\"w-4 h-4\" />,\n    description: 'Translate to another language',\n    requiresMessage: true,\n  },\n  {\n    id: 'expand',\n    label: 'Expand',\n    icon: <ArrowUpRight className=\"w-4 h-4\" />,\n    description: 'Expand short message',\n    requiresMessage: true,\n  },\n];\n\nconst TONE_OPTIONS: { value: ToneType; label: string; emoji: string }[] = [\n  { value: 'professional', label: 'Professional', emoji: 'ðŸ’¼' },\n  { value: 'casual', label: 'Casual', emoji: 'ðŸ˜Ž' },\n  { value: 'friendly', label: 'Friendly', emoji: 'ðŸ¤—' },\n  { value: 'formal', label: 'Formal', emoji: 'ðŸŽ©' },\n  { value: 'enthusiastic', label: 'Enthusiastic', emoji: 'ðŸ”¥' },\n  { value: 'concise', label: 'Concise', emoji: 'âš¡' },\n];\n\nconst LANGUAGE_OPTIONS: { value: LanguageType; label: string }[] = [\n  { value: 'english', label: 'English' },\n  { value: 'hindi', label: 'Hindi' },\n  { value: 'telugu', label: 'Telugu' },\n  { value: 'hinglish', label: 'Hinglish' },\n  { value: 'tenglish', label: 'Tenglish' },\n];\n\n// ============================================\n// Component\n// ============================================\n\nexport default function AIChatAssistant({\n  conversationId,\n  otherUserId,\n  otherUserName,\n  currentMessage,\n  lastReceivedMessage,\n  onSuggestionSelect,\n  onClose,\n}: AIChatAssistantProps) {\n  const [selectedFeature, setSelectedFeature] = useState<AIFeature | null>(null);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [suggestions, setSuggestions] = useState<string[]>([]);\n  const [selectedTone, setSelectedTone] = useState<ToneType>('casual');\n  const [selectedLanguage, setSelectedLanguage] = useState<LanguageType>('english');\n  const [showToneDropdown, setShowToneDropdown] = useState(false);\n  const [showLanguageDropdown, setShowLanguageDropdown] = useState(false);\n\n  // Handle feature selection\n  const handleFeatureClick = async (feature: AIFeature) => {\n    // Check requirements\n    if (FEATURES.find(f => f.id === feature)?.requiresMessage && !currentMessage.trim()) {\n      setError('Please type a message first');\n      return;\n    }\n    if (FEATURES.find(f => f.id === feature)?.requiresReceivedMessage && !lastReceivedMessage) {\n      setError('No message to reply to');\n      return;\n    }\n\n    setSelectedFeature(feature);\n    setError(null);\n    setSuggestions([]);\n\n    // For tone and translate, just show the options\n    if (feature === 'tone' || feature === 'translate') {\n      return;\n    }\n\n    await fetchSuggestions(feature);\n  };\n\n  // Fetch suggestions based on feature\n  const fetchSuggestions = async (feature: AIFeature, extraParams?: { tone?: ToneType; language?: LanguageType }) => {\n    setLoading(true);\n    setError(null);\n\n    try {\n      let result: string[] = [];\n\n      switch (feature) {\n        case 'starters': {\n          const response = await getConversationStarters(otherUserId);\n          result = response.suggestions;\n          break;\n        }\n        case 'revival': {\n          const response = await getChatRevivalSuggestions(conversationId, otherUserId);\n          result = response.suggestions;\n          break;\n        }\n        case 'grammar': {\n          const response = await fixGrammar(currentMessage);\n          result = [response.corrected, ...response.alternatives];\n          break;\n        }\n        case 'smart-reply': {\n          const response = await getSmartReplies(lastReceivedMessage || '', conversationId);\n          result = response.suggestions;\n          break;\n        }\n        case 'tone': {\n          const response = await changeTone(currentMessage, extraParams?.tone || selectedTone);\n          result = [response.result];\n          break;\n        }\n        case 'translate': {\n          const response = await translateMessage(currentMessage, extraParams?.language || selectedLanguage);\n          result = [response.translated];\n          break;\n        }\n        case 'expand': {\n          const response = await expandMessage(currentMessage);\n          result = [response.expanded];\n          break;\n        }\n      }\n\n      setSuggestions(result);\n    } catch (err: any) {\n      console.error('AI suggestion error:', err);\n      setError(err.response?.data?.error || 'Failed to generate suggestions');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Handle tone selection\n  const handleToneSelect = async (tone: ToneType) => {\n    setSelectedTone(tone);\n    setShowToneDropdown(false);\n    await fetchSuggestions('tone', { tone });\n  };\n\n  // Handle language selection\n  const handleLanguageSelect = async (language: LanguageType) => {\n    setSelectedLanguage(language);\n    setShowLanguageDropdown(false);\n    await fetchSuggestions('translate', { language });\n  };\n\n  // Handle suggestion selection\n  const handleSuggestionClick = (suggestion: string) => {\n    onSuggestionSelect(suggestion);\n    onClose?.();\n  };\n\n  // Reset to feature selection\n  const handleBack = () => {\n    setSelectedFeature(null);\n    setSuggestions([]);\n    setError(null);\n  };\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 10 }}\n      animate={{ opacity: 1, y: 0 }}\n      exit={{ opacity: 0, y: 10 }}\n      className=\"absolute bottom-full left-0 right-0 mb-3 mx-0 bg-white dark:bg-gray-800 rounded-2xl shadow-2xl border border-gray-200 dark:border-gray-700 overflow-hidden z-50\"\n      style={{ maxHeight: 'calc(100vh - 200px)' }}\n    >\n      {/* Header */}\n      <div className=\"flex items-center justify-between px-4 py-3 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-purple-50 to-blue-50 dark:from-purple-900/20 dark:to-blue-900/20\">\n        <div className=\"flex items-center gap-2\">\n          <div className=\"w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center\">\n            <Sparkles className=\"w-4 h-4 text-white\" />\n          </div>\n          <div>\n            <h3 className=\"font-semibold text-sm text-gray-900 dark:text-white\">\n              AI Assistant\n            </h3>\n            <p className=\"text-xs text-gray-500\">\n              {selectedFeature \n                ? FEATURES.find(f => f.id === selectedFeature)?.description \n                : 'Choose an action'}\n            </p>\n          </div>\n        </div>\n        <button\n          onClick={onClose}\n          className=\"p-1.5 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors\"\n        >\n          <X className=\"w-4 h-4 text-gray-500\" />\n        </button>\n      </div>\n\n      {/* Content */}\n      <div className=\"p-3 max-h-80 overflow-y-auto\">\n        <AnimatePresence mode=\"wait\">\n          {!selectedFeature ? (\n            // Feature Selection Grid\n            <motion.div\n              key=\"features\"\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              exit={{ opacity: 0 }}\n              className=\"grid grid-cols-2 gap-2\"\n            >\n              {FEATURES.map((feature) => {\n                const isDisabled = \n                  (feature.requiresMessage && !currentMessage.trim()) ||\n                  (feature.requiresReceivedMessage && !lastReceivedMessage);\n\n                return (\n                  <button\n                    key={feature.id}\n                    onClick={() => handleFeatureClick(feature.id)}\n                    disabled={isDisabled}\n                    className={cn(\n                      \"flex items-center gap-3 p-3 rounded-xl text-left transition-all\",\n                      isDisabled\n                        ? \"opacity-50 cursor-not-allowed bg-gray-50 dark:bg-gray-800\"\n                        : \"hover:bg-gray-100 dark:hover:bg-gray-700 bg-gray-50 dark:bg-gray-800/50 hover:scale-[1.02]\"\n                    )}\n                  >\n                    <div className={cn(\n                      \"w-9 h-9 rounded-xl flex items-center justify-center\",\n                      feature.id === 'starters' && \"bg-green-100 dark:bg-green-900/30 text-green-600\",\n                      feature.id === 'revival' && \"bg-orange-100 dark:bg-orange-900/30 text-orange-600\",\n                      feature.id === 'smart-reply' && \"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-600\",\n                      feature.id === 'grammar' && \"bg-blue-100 dark:bg-blue-900/30 text-blue-600\",\n                      feature.id === 'tone' && \"bg-purple-100 dark:bg-purple-900/30 text-purple-600\",\n                      feature.id === 'translate' && \"bg-pink-100 dark:bg-pink-900/30 text-pink-600\",\n                      feature.id === 'expand' && \"bg-cyan-100 dark:bg-cyan-900/30 text-cyan-600\",\n                    )}>\n                      {feature.icon}\n                    </div>\n                    <div className=\"flex-1 min-w-0\">\n                      <p className=\"font-medium text-sm text-gray-900 dark:text-white truncate\">\n                        {feature.label}\n                      </p>\n                      <p className=\"text-xs text-gray-500 truncate\">\n                        {feature.description}\n                      </p>\n                    </div>\n                  </button>\n                );\n              })}\n            </motion.div>\n          ) : (\n            // Suggestions View\n            <motion.div\n              key=\"suggestions\"\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              exit={{ opacity: 0 }}\n            >\n              {/* Back button */}\n              <button\n                onClick={handleBack}\n                className=\"flex items-center gap-1 text-sm text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 mb-3\"\n              >\n                <ChevronDown className=\"w-4 h-4 rotate-90\" />\n                Back to options\n              </button>\n\n              {/* Tone/Language Selector for those features */}\n              {selectedFeature === 'tone' && (\n                <div className=\"mb-3 relative\">\n                  <button\n                    onClick={() => setShowToneDropdown(!showToneDropdown)}\n                    className=\"w-full flex items-center justify-between px-4 py-2.5 bg-gray-100 dark:bg-gray-700 rounded-xl text-sm\"\n                  >\n                    <span className=\"flex items-center gap-2\">\n                      <span>{TONE_OPTIONS.find(t => t.value === selectedTone)?.emoji}</span>\n                      <span>{TONE_OPTIONS.find(t => t.value === selectedTone)?.label}</span>\n                    </span>\n                    <ChevronDown className={cn(\"w-4 h-4 transition-transform\", showToneDropdown && \"rotate-180\")} />\n                  </button>\n                  {showToneDropdown && (\n                    <div className=\"absolute top-full left-0 right-0 mt-1 bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden z-10\">\n                      {TONE_OPTIONS.map((tone) => (\n                        <button\n                          key={tone.value}\n                          onClick={() => handleToneSelect(tone.value)}\n                          className=\"w-full flex items-center gap-2 px-4 py-2.5 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 text-left\"\n                        >\n                          <span>{tone.emoji}</span>\n                          <span>{tone.label}</span>\n                          {selectedTone === tone.value && (\n                            <Check className=\"w-4 h-4 ml-auto text-green-500\" />\n                          )}\n                        </button>\n                      ))}\n                    </div>\n                  )}\n                </div>\n              )}\n\n              {selectedFeature === 'translate' && (\n                <div className=\"mb-3 relative\">\n                  <button\n                    onClick={() => setShowLanguageDropdown(!showLanguageDropdown)}\n                    className=\"w-full flex items-center justify-between px-4 py-2.5 bg-gray-100 dark:bg-gray-700 rounded-xl text-sm\"\n                  >\n                    <span>{LANGUAGE_OPTIONS.find(l => l.value === selectedLanguage)?.label}</span>\n                    <ChevronDown className={cn(\"w-4 h-4 transition-transform\", showLanguageDropdown && \"rotate-180\")} />\n                  </button>\n                  {showLanguageDropdown && (\n                    <div className=\"absolute top-full left-0 right-0 mt-1 bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden z-10\">\n                      {LANGUAGE_OPTIONS.map((lang) => (\n                        <button\n                          key={lang.value}\n                          onClick={() => handleLanguageSelect(lang.value)}\n                          className=\"w-full flex items-center gap-2 px-4 py-2.5 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 text-left\"\n                        >\n                          <span>{lang.label}</span>\n                          {selectedLanguage === lang.value && (\n                            <Check className=\"w-4 h-4 ml-auto text-green-500\" />\n                          )}\n                        </button>\n                      ))}\n                    </div>\n                  )}\n                </div>\n              )}\n\n              {/* Loading State */}\n              {loading && (\n                <div className=\"flex items-center justify-center py-8\">\n                  <Loader2 className=\"w-6 h-6 animate-spin text-blue-500\" />\n                  <span className=\"ml-2 text-sm text-gray-500\">Generating suggestions...</span>\n                </div>\n              )}\n\n              {/* Error State */}\n              {error && (\n                <div className=\"p-4 bg-red-50 dark:bg-red-900/20 rounded-xl text-center\">\n                  <p className=\"text-sm text-red-600 dark:text-red-400\">{error}</p>\n                  <button\n                    onClick={() => fetchSuggestions(selectedFeature)}\n                    className=\"mt-2 text-sm text-blue-600 hover:underline\"\n                  >\n                    Try again\n                  </button>\n                </div>\n              )}\n\n              {/* Suggestions List */}\n              {!loading && !error && suggestions.length > 0 && (\n                <div className=\"space-y-2\">\n                  {suggestions.map((suggestion, index) => (\n                    <motion.button\n                      key={index}\n                      initial={{ opacity: 0, x: -10 }}\n                      animate={{ opacity: 1, x: 0 }}\n                      transition={{ delay: index * 0.1 }}\n                      onClick={() => handleSuggestionClick(suggestion)}\n                      className={cn(\n                        \"w-full p-3 text-left rounded-xl transition-all\",\n                        \"bg-gray-50 dark:bg-gray-700/50 hover:bg-gray-100 dark:hover:bg-gray-700\",\n                        \"hover:shadow-md hover:scale-[1.01]\",\n                        \"border border-transparent hover:border-blue-200 dark:hover:border-blue-800\"\n                      )}\n                    >\n                      <p className=\"text-sm text-gray-800 dark:text-gray-200 leading-relaxed\">\n                        {suggestion}\n                      </p>\n                      {index === 0 && selectedFeature === 'grammar' && (\n                        <span className=\"inline-flex items-center gap-1 mt-1 text-xs text-green-600 dark:text-green-400\">\n                          <Check className=\"w-3 h-3\" />\n                          Best correction\n                        </span>\n                      )}\n                    </motion.button>\n                  ))}\n                </div>\n              )}\n\n              {/* Regenerate button */}\n              {!loading && suggestions.length > 0 && selectedFeature !== 'tone' && selectedFeature !== 'translate' && (\n                <button\n                  onClick={() => fetchSuggestions(selectedFeature)}\n                  className=\"w-full mt-3 flex items-center justify-center gap-2 py-2.5 text-sm text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl transition-colors\"\n                >\n                  <RefreshCw className=\"w-4 h-4\" />\n                  Generate new suggestions\n                </button>\n              )}\n            </motion.div>\n          )}\n        </AnimatePresence>\n      </div>\n\n      {/* Footer tip */}\n      <div className=\"px-4 py-2 bg-gray-50 dark:bg-gray-900/50 border-t border-gray-200 dark:border-gray-700\">\n        <p className=\"text-xs text-gray-500 text-center\">\n          {currentMessage.trim() \n            ? `Message: \"${currentMessage.slice(0, 30)}${currentMessage.length > 30 ? '...' : ''}\"`\n            : 'Type a message to use grammar, tone, or translate features'}\n        </p>\n      </div>\n    </motion.div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4024, "column": 0}, "map": {"version":3,"sources":["file:///home/yasmanth/Pictures/vormex/vormex-web/src/components/chat/ChatInput.tsx"],"sourcesContent":["'use client';\n\nimport React, { useState, useRef, useEffect, useCallback } from 'react';\nimport { sendChatMessage, sendChatTyping, getSocket } from '@/lib/socket';\nimport { uploadChatMedia, getMessageLimitStatus, type MessageLimitStatus } from '@/lib/api/chat';\nimport { sendConnectionRequest } from '@/lib/api/connections';\nimport { cn } from '@/lib/utils';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport {\n  Paperclip,\n  Image as ImageIcon,\n  FileText,\n  Video,\n  Mic,\n  X,\n  Send,\n  Smile,\n  File,\n  Square,\n  Trash2,\n  Sparkles,\n  Pencil,\n  Loader2,\n  UserPlus,\n  Lock,\n  MessageCircle,\n} from 'lucide-react';\nimport AIChatAssistant from './AIChatAssistant';\nimport { fixGrammar } from '@/lib/api/ai-chat';\n\n// File type configurations\nconst ALLOWED_FILE_TYPES = {\n  image: ['image/jpeg', 'image/png', 'image/gif', 'image/webp'],\n  video: ['video/mp4', 'video/webm', 'video/quicktime'],\n  document: ['application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'],\n  audio: ['audio/mpeg', 'audio/wav', 'audio/ogg', 'audio/webm'],\n};\n\nconst MAX_FILE_SIZE = 50 * 1024 * 1024; // 50MB\nconst MAX_VIDEO_DURATION = 60; // 60 seconds\n\n// Uploading message interface for optimistic UI\nexport interface UploadingMessage {\n  id: string;\n  type: 'image' | 'video' | 'document' | 'audio';\n  preview?: string;\n  fileName?: string;\n  progress: number;\n}\n\ninterface ChatInputProps {\n  conversationId: string;\n  replyTo?: {\n    id: string;\n    content: string;\n    senderName: string;\n  };\n  onCancelReply?: () => void;\n  disabled?: boolean;\n  onUploadingMessagesChange?: (messages: UploadingMessage[]) => void;\n  // AI Assistant props\n  otherUserId?: string;\n  otherUserName?: string;\n  lastReceivedMessage?: string;\n}\n\ninterface FilePreview {\n  file: File;\n  preview: string;\n  type: 'image' | 'video' | 'document' | 'audio';\n}\n\nexport default function ChatInput({\n  conversationId,\n  replyTo,\n  onCancelReply,\n  disabled = false,\n  onUploadingMessagesChange,\n  otherUserId,\n  otherUserName,\n  lastReceivedMessage,\n}: ChatInputProps) {\n  const [message, setMessage] = useState('');\n  const [isTyping, setIsTyping] = useState(false);\n  const [showEmoji, setShowEmoji] = useState(false);\n  const [showAttachMenu, setShowAttachMenu] = useState(false);\n  const [showAIAssistant, setShowAIAssistant] = useState(false);\n  const [isFixingGrammar, setIsFixingGrammar] = useState(false);\n  const [selectedFiles, setSelectedFiles] = useState<FilePreview[]>([]);\n  const [uploadProgress, setUploadProgress] = useState<number | null>(null);\n  const [isRecording, setIsRecording] = useState(false);\n  const [recordingDuration, setRecordingDuration] = useState(0);\n  const [audioBlob, setAudioBlob] = useState<Blob | null>(null);\n  const [uploadingMessages, setUploadingMessages] = useState<UploadingMessage[]>([]);\n  \n  // Message limit state\n  const [messageLimitInfo, setMessageLimitInfo] = useState<MessageLimitStatus | null>(null);\n  const [showConnectionPrompt, setShowConnectionPrompt] = useState(false);\n  const [isSendingConnectionRequest, setIsSendingConnectionRequest] = useState(false);\n  const [connectionRequestSent, setConnectionRequestSent] = useState(false);\n  \n  const inputRef = useRef<HTMLTextAreaElement>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const typingTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const attachMenuRef = useRef<HTMLDivElement>(null);\n  const mediaRecorderRef = useRef<MediaRecorder | null>(null);\n  const audioChunksRef = useRef<Blob[]>([]);\n  const recordingIntervalRef = useRef<NodeJS.Timeout | null>(null);\n\n  // Check message limit on mount and when conversation changes\n  useEffect(() => {\n    const checkMessageLimit = async () => {\n      if (!otherUserId) return;\n      \n      try {\n        const limitStatus = await getMessageLimitStatus(otherUserId);\n        setMessageLimitInfo(limitStatus);\n        \n        // Show prompt immediately if limit is reached and not connected\n        if (!limitStatus.isConnected && !limitStatus.canSend) {\n          setShowConnectionPrompt(true);\n        }\n      } catch (error) {\n        console.error('Failed to check message limit:', error);\n      }\n    };\n    \n    checkMessageLimit();\n  }, [conversationId, otherUserId]);\n\n  // Handle sending connection request\n  const handleSendConnectionRequest = async () => {\n    if (!otherUserId || isSendingConnectionRequest) return;\n    \n    setIsSendingConnectionRequest(true);\n    try {\n      await sendConnectionRequest(otherUserId);\n      setConnectionRequestSent(true);\n      // Don't close prompt, show success message\n    } catch (error: any) {\n      console.error('Failed to send connection request:', error);\n      // Check if request already exists\n      if (error.message?.includes('already') || error.message?.includes('pending')) {\n        setConnectionRequestSent(true);\n      } else {\n        alert('Failed to send connection request. Please try again.');\n      }\n    } finally {\n      setIsSendingConnectionRequest(false);\n    }\n  };\n\n  // Auto-resize textarea\n  useEffect(() => {\n    if (inputRef.current) {\n      inputRef.current.style.height = 'auto';\n      inputRef.current.style.height = `${Math.min(inputRef.current.scrollHeight, 120)}px`;\n    }\n  }, [message]);\n\n  // Close attachment menu when clicking outside\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (attachMenuRef.current && !attachMenuRef.current.contains(event.target as Node)) {\n        setShowAttachMenu(false);\n      }\n    };\n\n    if (showAttachMenu) {\n      document.addEventListener('mousedown', handleClickOutside);\n    }\n\n    return () => {\n      document.removeEventListener('mousedown', handleClickOutside);\n    };\n  }, [showAttachMenu]);\n\n  // Handle typing indicator\n  const handleTyping = useCallback(() => {\n    if (!isTyping) {\n      setIsTyping(true);\n      sendChatTyping(conversationId, true);\n    }\n\n    // Clear existing timeout\n    if (typingTimeoutRef.current) {\n      clearTimeout(typingTimeoutRef.current);\n    }\n\n    // Set new timeout to stop typing indicator\n    typingTimeoutRef.current = setTimeout(() => {\n      setIsTyping(false);\n      sendChatTyping(conversationId, false);\n    }, 2000);\n  }, [conversationId, isTyping]);\n\n  // Clean up typing timeout\n  useEffect(() => {\n    return () => {\n      if (typingTimeoutRef.current) {\n        clearTimeout(typingTimeoutRef.current);\n      }\n    };\n  }, []);\n\n  // Get file type category\n  const getFileType = (file: File): 'image' | 'video' | 'document' | 'audio' | null => {\n    for (const [type, mimes] of Object.entries(ALLOWED_FILE_TYPES)) {\n      if (mimes.includes(file.type)) {\n        return type as 'image' | 'video' | 'document' | 'audio';\n      }\n    }\n    return null;\n  };\n\n  // Check video duration\n  const checkVideoDuration = (file: File): Promise<boolean> => {\n    return new Promise((resolve) => {\n      const video = document.createElement('video');\n      video.preload = 'metadata';\n      video.onloadedmetadata = () => {\n        URL.revokeObjectURL(video.src);\n        if (video.duration > MAX_VIDEO_DURATION) {\n          alert(`Video \"${file.name}\" is too long. Maximum duration is ${MAX_VIDEO_DURATION} seconds.`);\n          resolve(false);\n        } else {\n          resolve(true);\n        }\n      };\n      video.onerror = () => {\n        URL.revokeObjectURL(video.src);\n        resolve(true); // Allow if we can't check duration\n      };\n      video.src = URL.createObjectURL(file);\n    });\n  };\n\n  // Handle file selection\n  const handleFileSelect = async (e: React.ChangeEvent<HTMLInputElement>, filterType?: string) => {\n    const files = Array.from(e.target.files || []);\n    \n    const validFiles: FilePreview[] = [];\n    \n    for (const file of files) {\n      // Check file size\n      if (file.size > MAX_FILE_SIZE) {\n        alert(`File \"${file.name}\" is too large. Maximum size is 50MB.`);\n        continue;\n      }\n\n      const fileType = getFileType(file);\n      \n      if (!fileType) {\n        alert(`File type not supported: ${file.name}`);\n        continue;\n      }\n\n      // Check video duration\n      if (fileType === 'video') {\n        const isValidDuration = await checkVideoDuration(file);\n        if (!isValidDuration) {\n          continue;\n        }\n      }\n\n      // Create preview URL\n      let preview = '';\n      if (fileType === 'image' || fileType === 'video') {\n        preview = URL.createObjectURL(file);\n      }\n\n      validFiles.push({\n        file,\n        preview,\n        type: fileType,\n      });\n    }\n\n    setSelectedFiles(prev => [...prev, ...validFiles]);\n    setShowAttachMenu(false);\n    \n    // Reset file input\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n    }\n  };\n\n  // Remove selected file\n  const removeFile = (index: number) => {\n    setSelectedFiles(prev => {\n      const newFiles = [...prev];\n      // Revoke object URL to free memory\n      if (newFiles[index].preview) {\n        URL.revokeObjectURL(newFiles[index].preview);\n      }\n      newFiles.splice(index, 1);\n      return newFiles;\n    });\n  };\n\n  // Open file picker for specific type\n  const openFilePicker = (accept: string) => {\n    if (fileInputRef.current) {\n      fileInputRef.current.accept = accept;\n      fileInputRef.current.click();\n    }\n    setShowAttachMenu(false);\n  };\n\n  // Voice recording functions\n  const startRecording = async () => {\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n      const mediaRecorder = new MediaRecorder(stream, { mimeType: 'audio/webm' });\n      mediaRecorderRef.current = mediaRecorder;\n      audioChunksRef.current = [];\n\n      mediaRecorder.ondataavailable = (e) => {\n        if (e.data.size > 0) {\n          audioChunksRef.current.push(e.data);\n        }\n      };\n\n      mediaRecorder.onstop = () => {\n        const audioBlob = new Blob(audioChunksRef.current, { type: 'audio/webm' });\n        setAudioBlob(audioBlob);\n        stream.getTracks().forEach(track => track.stop());\n      };\n\n      mediaRecorder.start();\n      setIsRecording(true);\n      setRecordingDuration(0);\n\n      // Update duration every second\n      recordingIntervalRef.current = setInterval(() => {\n        setRecordingDuration(prev => prev + 1);\n      }, 1000);\n    } catch (error) {\n      console.error('Failed to start recording:', error);\n      alert('Could not access microphone. Please grant permission.');\n    }\n  };\n\n  const stopRecording = () => {\n    if (mediaRecorderRef.current && isRecording) {\n      mediaRecorderRef.current.stop();\n      setIsRecording(false);\n      if (recordingIntervalRef.current) {\n        clearInterval(recordingIntervalRef.current);\n        recordingIntervalRef.current = null;\n      }\n    }\n  };\n\n  const cancelRecording = () => {\n    if (mediaRecorderRef.current) {\n      mediaRecorderRef.current.stream.getTracks().forEach(track => track.stop());\n    }\n    setIsRecording(false);\n    setAudioBlob(null);\n    setRecordingDuration(0);\n    if (recordingIntervalRef.current) {\n      clearInterval(recordingIntervalRef.current);\n      recordingIntervalRef.current = null;\n    }\n  };\n\n  const formatDuration = (seconds: number): string => {\n    const mins = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    return `${mins}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  // Sync uploading messages to parent via useEffect to avoid setState during render\n  useEffect(() => {\n    onUploadingMessagesChange?.(uploadingMessages);\n  }, [uploadingMessages, onUploadingMessagesChange]);\n\n  const handleSend = async () => {\n    const trimmedMessage = message.trim();\n    const hasFiles = selectedFiles.length > 0;\n    const hasAudio = audioBlob !== null;\n    \n    if (!trimmedMessage && !hasFiles && !hasAudio) return;\n\n    // Check message limit before sending (for non-connected users)\n    if (messageLimitInfo && !messageLimitInfo.isConnected && !messageLimitInfo.canSend) {\n      setShowConnectionPrompt(true);\n      return;\n    }\n\n    // Immediately clear typing state and stop broadcasting\n    if (typingTimeoutRef.current) {\n      clearTimeout(typingTimeoutRef.current);\n      typingTimeoutRef.current = null;\n    }\n    setIsTyping(false);\n    sendChatTyping(conversationId, false);\n\n    // Update local message limit tracking\n    if (messageLimitInfo && !messageLimitInfo.isConnected) {\n      setMessageLimitInfo(prev => prev ? {\n        ...prev,\n        messagesSent: prev.messagesSent + 1,\n        messagesRemaining: Math.max(0, prev.messagesRemaining - 1),\n        canSend: prev.messagesRemaining > 1,\n      } : null);\n    }\n\n    // Clear input immediately for better UX\n    const filesToUpload = [...selectedFiles];\n    const audioToUpload = audioBlob;\n    const textToSend = trimmedMessage;\n    const currentReplyTo = replyTo;\n    \n    setMessage('');\n    setSelectedFiles([]);\n    setAudioBlob(null);\n    setRecordingDuration(0);\n    onCancelReply?.();\n    inputRef.current?.focus();\n\n    // Upload and send audio message if exists\n    if (hasAudio && audioToUpload) {\n      const uploadId = `upload-audio-${Date.now()}`;\n      \n      // Add optimistic uploading message\n      setUploadingMessages(prev => [...prev, {\n        id: uploadId,\n        type: 'audio',\n        fileName: 'Voice message',\n        progress: 0,\n      }]);\n\n      try {\n        const audioFile = new globalThis.File([audioToUpload], `voice-${Date.now()}.webm`, { type: 'audio/webm' });\n        \n        const result = await uploadChatMedia(audioFile, 'audio', (progress) => {\n          setUploadingMessages(prev => \n            prev.map(m => m.id === uploadId ? { ...m, progress } : m)\n          );\n        });\n        \n        // Remove uploading message\n        setUploadingMessages(prev => prev.filter(m => m.id !== uploadId));\n        \n        // Send actual message\n        sendChatMessage({\n          conversationId,\n          content: 'ðŸŽ¤ Voice message',\n          contentType: 'audio',\n          mediaUrl: result.mediaUrl,\n          fileName: result.fileName,\n          fileSize: result.fileSize,\n          replyToId: currentReplyTo?.id,\n        });\n      } catch (error) {\n        console.error('Failed to upload audio:', error);\n        setUploadingMessages(prev => prev.filter(m => m.id !== uploadId));\n        alert('Failed to send voice message');\n      }\n    }\n\n    // Upload files in parallel with optimistic UI\n    if (hasFiles) {\n      const uploadPromises = filesToUpload.map(async (filePreview, index) => {\n        const uploadId = `upload-${Date.now()}-${index}`;\n        \n        // Add optimistic uploading message immediately\n        setUploadingMessages(prev => [...prev, {\n          id: uploadId,\n          type: filePreview.type,\n          preview: filePreview.preview,\n          fileName: filePreview.file.name,\n          progress: 0,\n        }]);\n\n        try {\n          const result = await uploadChatMedia(filePreview.file, filePreview.type, (progress) => {\n            setUploadingMessages(prev => \n              prev.map(m => m.id === uploadId ? { ...m, progress } : m)\n            );\n          });\n          \n          // Remove uploading message\n          setUploadingMessages(prev => prev.filter(m => m.id !== uploadId));\n          \n          // Send actual message\n          sendChatMessage({\n            conversationId,\n            content: filePreview.type === 'image' ? 'ðŸ“· Photo' : \n                     filePreview.type === 'video' ? 'ðŸŽ¥ Video' :\n                     filePreview.type === 'document' ? `ðŸ“„ ${filePreview.file.name}` :\n                     `ðŸ“Ž ${filePreview.file.name}`,\n            contentType: filePreview.type,\n            mediaUrl: result.mediaUrl,\n            fileName: result.fileName,\n            fileSize: result.fileSize,\n            replyToId: index === 0 ? currentReplyTo?.id : undefined,\n          });\n          \n          // Clean up preview URL\n          if (filePreview.preview) {\n            URL.revokeObjectURL(filePreview.preview);\n          }\n        } catch (error) {\n          console.error('Failed to upload file:', error);\n          setUploadingMessages(prev => prev.filter(m => m.id !== uploadId));\n          alert(`Failed to send ${filePreview.file.name}`);\n        }\n      });\n\n      // Don't await - let uploads happen in background\n      Promise.all(uploadPromises);\n    }\n\n    // Send text message immediately\n    if (textToSend) {\n      sendChatMessage({\n        conversationId,\n        content: textToSend,\n        contentType: 'text',\n        replyToId: currentReplyTo?.id,\n      });\n    }\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSend();\n    }\n  };\n\n  const handleChange = (e: React.ChangeEvent<HTMLTextAreaElement>) => {\n    setMessage(e.target.value);\n    handleTyping();\n  };\n\n  const handleEmojiClick = (emoji: string) => {\n    setMessage(prev => prev + emoji);\n    setShowEmoji(false);\n    inputRef.current?.focus();\n  };\n\n  // Quick grammar fix function\n  const handleQuickGrammarFix = async () => {\n    if (!message.trim() || isFixingGrammar) return;\n    \n    setIsFixingGrammar(true);\n    try {\n      const response = await fixGrammar(message);\n      setMessage(response.corrected);\n      inputRef.current?.focus();\n    } catch (error) {\n      console.error('Grammar fix error:', error);\n    } finally {\n      setIsFixingGrammar(false);\n    }\n  };\n\n  const commonEmojis = ['ðŸ˜€', 'ðŸ˜‚', 'â¤ï¸', 'ðŸ‘', 'ðŸ”¥', 'ðŸŽ‰', 'ðŸ˜Š', 'ðŸ™', 'ðŸ’¯', 'âœ¨', 'ðŸ˜', 'ðŸ¤”', 'ðŸ‘€', 'ðŸ™Œ', 'ðŸ’ª'];\n\n  return (\n    <div className=\"relative border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 p-4\">\n      {/* AI Assistant Panel - positioned at container level for proper width */}\n      <AnimatePresence>\n        {showAIAssistant && otherUserId && (\n          <AIChatAssistant\n            conversationId={conversationId}\n            otherUserId={otherUserId}\n            otherUserName={otherUserName || 'User'}\n            currentMessage={message}\n            lastReceivedMessage={lastReceivedMessage}\n            onSuggestionSelect={(text) => {\n              setMessage(text);\n              setShowAIAssistant(false);\n              inputRef.current?.focus();\n            }}\n            onClose={() => setShowAIAssistant(false)}\n          />\n        )}\n      </AnimatePresence>\n\n      {/* Connection Required Prompt - Shows when message limit reached */}\n      <AnimatePresence>\n        {showConnectionPrompt && messageLimitInfo && !messageLimitInfo.isConnected && !messageLimitInfo.canSend && (\n          <motion.div\n            initial={{ opacity: 0, y: 20, scale: 0.95 }}\n            animate={{ opacity: 1, y: 0, scale: 1 }}\n            exit={{ opacity: 0, y: 20, scale: 0.95 }}\n            className=\"absolute bottom-full left-0 right-0 mb-2 mx-4\"\n          >\n            <div className=\"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/30 dark:to-indigo-900/30 border border-blue-200 dark:border-blue-700 rounded-xl p-4 shadow-lg\">\n              <div className=\"flex items-start gap-3\">\n                <div className=\"flex-shrink-0 w-10 h-10 rounded-full bg-blue-100 dark:bg-blue-800 flex items-center justify-center\">\n                  <Lock className=\"w-5 h-5 text-blue-600 dark:text-blue-400\" />\n                </div>\n                <div className=\"flex-1 min-w-0\">\n                  <h4 className=\"text-sm font-semibold text-gray-900 dark:text-white mb-1\">\n                    Connect to Continue Messaging\n                  </h4>\n                  <p className=\"text-xs text-gray-600 dark:text-gray-400 mb-3\">\n                    You&apos;ve sent {messageLimitInfo.messagesSent} of {messageLimitInfo.limit} messages. \n                    Connect with <span className=\"font-medium\">{otherUserName || 'this user'}</span> to send unlimited messages.\n                  </p>\n                  \n                  <div className=\"flex items-center gap-2\">\n                    {connectionRequestSent ? (\n                      <div className=\"flex items-center gap-2 text-sm text-green-600 dark:text-green-400\">\n                        <div className=\"w-5 h-5 rounded-full bg-green-100 dark:bg-green-800 flex items-center justify-center\">\n                          <svg className=\"w-3 h-3\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                            <path fillRule=\"evenodd\" d=\"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z\" clipRule=\"evenodd\" />\n                          </svg>\n                        </div>\n                        <span className=\"font-medium\">Connection request sent!</span>\n                      </div>\n                    ) : (\n                      <button\n                        onClick={handleSendConnectionRequest}\n                        disabled={isSendingConnectionRequest}\n                        className=\"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-white text-sm font-medium rounded-lg transition-colors\"\n                      >\n                        {isSendingConnectionRequest ? (\n                          <>\n                            <Loader2 className=\"w-4 h-4 animate-spin\" />\n                            Sending...\n                          </>\n                        ) : (\n                          <>\n                            <UserPlus className=\"w-4 h-4\" />\n                            Send Connection Request\n                          </>\n                        )}\n                      </button>\n                    )}\n                    \n                    <button\n                      onClick={() => setShowConnectionPrompt(false)}\n                      className=\"px-3 py-2 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors\"\n                    >\n                      Dismiss\n                    </button>\n                  </div>\n                </div>\n                \n                <button\n                  onClick={() => setShowConnectionPrompt(false)}\n                  className=\"flex-shrink-0 p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors\"\n                >\n                  <X className=\"w-4 h-4\" />\n                </button>\n              </div>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {/* Message Limit Warning Banner - Shows when approaching limit */}\n      <AnimatePresence>\n        {messageLimitInfo && !messageLimitInfo.isConnected && messageLimitInfo.canSend && messageLimitInfo.messagesRemaining === 1 && (\n          <motion.div\n            initial={{ opacity: 0, height: 0 }}\n            animate={{ opacity: 1, height: 'auto' }}\n            exit={{ opacity: 0, height: 0 }}\n            className=\"mb-3 overflow-hidden\"\n          >\n            <div className=\"flex items-center gap-2 px-3 py-2 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-700 rounded-lg\">\n              <MessageCircle className=\"w-4 h-4 text-amber-600 dark:text-amber-400 flex-shrink-0\" />\n              <p className=\"text-xs text-amber-700 dark:text-amber-300\">\n                <span className=\"font-medium\">Last message!</span> Connect with {otherUserName || 'this user'} to continue the conversation.\n              </p>\n              <button\n                onClick={handleSendConnectionRequest}\n                disabled={isSendingConnectionRequest || connectionRequestSent}\n                className=\"ml-auto text-xs font-medium text-amber-700 dark:text-amber-300 hover:text-amber-800 dark:hover:text-amber-200 underline disabled:opacity-50\"\n              >\n                {connectionRequestSent ? 'Request Sent' : 'Connect'}\n              </button>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {/* File input (hidden) */}\n      <input\n        ref={fileInputRef}\n        type=\"file\"\n        multiple\n        onChange={handleFileSelect}\n        className=\"hidden\"\n      />\n\n      {/* File previews */}\n      <AnimatePresence>\n        {selectedFiles.length > 0 && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: 'auto', opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            className=\"mb-3 overflow-hidden\"\n          >\n            <div className=\"flex gap-2 overflow-x-auto py-2\">\n              {selectedFiles.map((file, index) => (\n                <div\n                  key={index}\n                  className=\"relative flex-shrink-0 w-20 h-20 rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-800 border border-gray-200 dark:border-gray-700\"\n                >\n                  {file.type === 'image' ? (\n                    <img\n                      src={file.preview}\n                      alt={file.file.name}\n                      className=\"w-full h-full object-cover\"\n                    />\n                  ) : (\n                    <div className=\"w-full h-full flex flex-col items-center justify-center p-1\">\n                      {file.type === 'video' && <Video className=\"w-6 h-6 text-gray-500\" />}\n                      {file.type === 'document' && <FileText className=\"w-6 h-6 text-gray-500\" />}\n                      {file.type === 'audio' && <Mic className=\"w-6 h-6 text-gray-500\" />}\n                      <span className=\"text-[10px] text-gray-500 truncate w-full text-center mt-1\">\n                        {file.file.name.slice(0, 10)}...\n                      </span>\n                    </div>\n                  )}\n                  <button\n                    onClick={() => removeFile(index)}\n                    className=\"absolute top-1 right-1 w-5 h-5 bg-red-500 text-white rounded-full flex items-center justify-center hover:bg-red-600\"\n                  >\n                    <X className=\"w-3 h-3\" />\n                  </button>\n                </div>\n              ))}\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {/* Upload progress */}\n      {uploadProgress !== null && (\n        <div className=\"mb-3\">\n          <div className=\"h-1 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden\">\n            <div\n              className=\"h-full bg-blue-600 transition-all duration-300\"\n              style={{ width: `${uploadProgress}%` }}\n            />\n          </div>\n          <p className=\"text-xs text-gray-500 mt-1\">Uploading... {uploadProgress}%</p>\n        </div>\n      )}\n\n      {/* Reply preview */}\n      {replyTo && (\n        <div className=\"flex items-center justify-between mb-2 p-2 bg-gray-100 dark:bg-gray-800 rounded-lg\">\n          <div className=\"flex items-center gap-2 min-w-0\">\n            <div className=\"w-1 h-8 bg-blue-500 rounded-full\" />\n            <div className=\"min-w-0\">\n              <p className=\"text-xs text-blue-600 dark:text-blue-400 font-medium\">\n                Replying to {replyTo.senderName}\n              </p>\n              <p className=\"text-sm text-gray-600 dark:text-gray-400 truncate\">\n                {replyTo.content}\n              </p>\n            </div>\n          </div>\n          <button\n            onClick={onCancelReply}\n            className=\"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded\"\n          >\n            <X className=\"w-4 h-4\" />\n          </button>\n        </div>\n      )}\n\n      {/* Input area */}\n      <div className=\"flex items-end gap-2\">\n        {/* Attachment button with menu */}\n        <div className=\"relative\" ref={attachMenuRef}>\n          <button\n            onClick={() => setShowAttachMenu(!showAttachMenu)}\n            className={cn(\n              \"p-2 rounded-full transition-colors\",\n              showAttachMenu \n                ? \"bg-blue-100 dark:bg-blue-900/30 text-blue-600\" \n                : \"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800\"\n            )}\n            title=\"Attach file\"\n          >\n            <Paperclip className=\"w-5 h-5\" />\n          </button>\n\n          {/* Attachment menu */}\n          <AnimatePresence>\n            {showAttachMenu && (\n              <motion.div\n                initial={{ opacity: 0, y: 10, scale: 0.95 }}\n                animate={{ opacity: 1, y: 0, scale: 1 }}\n                exit={{ opacity: 0, y: 10, scale: 0.95 }}\n                className=\"absolute bottom-full left-0 mb-2 w-48 bg-white dark:bg-gray-800 shadow-xl rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden z-20\"\n              >\n                <div className=\"p-2 space-y-1\">\n                  <button\n                    onClick={() => openFilePicker('image/*')}\n                    className=\"w-full flex items-center gap-3 px-3 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors\"\n                  >\n                    <div className=\"w-8 h-8 rounded-full bg-purple-100 dark:bg-purple-900/30 flex items-center justify-center\">\n                      <ImageIcon className=\"w-4 h-4 text-purple-600\" />\n                    </div>\n                    <span>Photos</span>\n                  </button>\n                  \n                  <button\n                    onClick={() => openFilePicker('video/*')}\n                    className=\"w-full flex items-center gap-3 px-3 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors\"\n                  >\n                    <div className=\"w-8 h-8 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center\">\n                      <Video className=\"w-4 h-4 text-red-600\" />\n                    </div>\n                    <span>Videos</span>\n                  </button>\n                  \n                  <button\n                    onClick={() => openFilePicker('.pdf,.doc,.docx')}\n                    className=\"w-full flex items-center gap-3 px-3 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors\"\n                  >\n                    <div className=\"w-8 h-8 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center\">\n                      <FileText className=\"w-4 h-4 text-blue-600\" />\n                    </div>\n                    <span>Documents</span>\n                  </button>\n                  \n                  <button\n                    onClick={() => {\n                      setShowAttachMenu(false);\n                      startRecording();\n                    }}\n                    className=\"w-full flex items-center gap-3 px-3 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors\"\n                  >\n                    <div className=\"w-8 h-8 rounded-full bg-orange-100 dark:bg-orange-900/30 flex items-center justify-center\">\n                      <Mic className=\"w-4 h-4 text-orange-600\" />\n                    </div>\n                    <span>Voice Mail</span>\n                  </button>\n                </div>\n              </motion.div>\n            )}\n          </AnimatePresence>\n        </div>\n\n        {/* AI Assistant button */}\n        {otherUserId && (\n          <button\n            onClick={() => {\n              setShowAIAssistant(!showAIAssistant);\n              setShowEmoji(false);\n              setShowAttachMenu(false);\n            }}\n            className={cn(\n              \"p-2 rounded-full transition-colors\",\n              showAIAssistant\n                ? \"bg-gradient-to-br from-purple-100 to-blue-100 dark:from-purple-900/30 dark:to-blue-900/30 text-purple-600\"\n                : \"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800\"\n            )}\n            title=\"AI Assistant\"\n          >\n            <Sparkles className=\"w-5 h-5\" />\n          </button>\n        )}\n\n        {/* Emoji button */}\n        <div className=\"relative\">\n          <button\n            onClick={() => setShowEmoji(!showEmoji)}\n            className={cn(\n              \"p-2 rounded-full transition-colors\",\n              showEmoji\n                ? \"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-600\"\n                : \"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800\"\n            )}\n            title=\"Add emoji\"\n          >\n            <Smile className=\"w-5 h-5\" />\n          </button>\n\n          {/* Emoji picker */}\n          <AnimatePresence>\n            {showEmoji && (\n              <motion.div\n                initial={{ opacity: 0, y: 10, scale: 0.95 }}\n                animate={{ opacity: 1, y: 0, scale: 1 }}\n                exit={{ opacity: 0, y: 10, scale: 0.95 }}\n                className=\"absolute bottom-full left-0 mb-2 p-3 bg-white dark:bg-gray-800 shadow-xl rounded-xl border border-gray-200 dark:border-gray-700 z-20\"\n              >\n                <div className=\"grid grid-cols-5 gap-1 w-[200px]\">\n                  {commonEmojis.map(emoji => (\n                    <button\n                      key={emoji}\n                      onClick={() => handleEmojiClick(emoji)}\n                      className=\"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg text-xl transition-transform hover:scale-110\"\n                    >\n                      {emoji}\n                    </button>\n                  ))}\n                </div>\n              </motion.div>\n            )}\n          </AnimatePresence>\n        </div>\n\n        {/* Voice Recording UI */}\n        {isRecording ? (\n          <div className=\"flex-1 flex items-center gap-3 px-4 py-2.5 bg-red-50 dark:bg-red-900/20 rounded-2xl\">\n            <div className=\"w-3 h-3 bg-red-500 rounded-full animate-pulse\" />\n            <span className=\"text-red-600 dark:text-red-400 font-medium\">\n              {formatDuration(recordingDuration)}\n            </span>\n            <span className=\"text-sm text-gray-500 flex-1\">Recording...</span>\n            <button\n              onClick={cancelRecording}\n              className=\"p-2 text-gray-500 hover:text-red-500 hover:bg-red-100 dark:hover:bg-red-900/30 rounded-full transition-colors\"\n              title=\"Cancel\"\n            >\n              <Trash2 className=\"w-5 h-5\" />\n            </button>\n            <button\n              onClick={stopRecording}\n              className=\"p-2 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors\"\n              title=\"Stop recording\"\n            >\n              <Square className=\"w-4 h-4\" />\n            </button>\n          </div>\n        ) : audioBlob ? (\n          <div className=\"flex-1 flex items-center gap-3 px-4 py-2.5 bg-green-50 dark:bg-green-900/20 rounded-2xl\">\n            <Mic className=\"w-5 h-5 text-green-600\" />\n            <span className=\"text-sm text-green-700 dark:text-green-400 flex-1\">\n              Voice message ({formatDuration(recordingDuration)})\n            </span>\n            <button\n              onClick={() => { setAudioBlob(null); setRecordingDuration(0); }}\n              className=\"p-1.5 text-gray-500 hover:text-red-500 hover:bg-red-100 dark:hover:bg-red-900/30 rounded-full transition-colors\"\n              title=\"Delete recording\"\n            >\n              <X className=\"w-4 h-4\" />\n            </button>\n          </div>\n        ) : (\n          /* Text input */\n          <div className=\"flex-1 relative\">\n            <textarea\n              ref={inputRef}\n              value={message}\n              onChange={handleChange}\n              onKeyDown={handleKeyDown}\n              placeholder=\"Type a message...\"\n              disabled={disabled}\n              rows={1}\n              className={cn(\n                'w-full resize-none rounded-2xl px-4 py-2.5',\n                'bg-gray-100 dark:bg-gray-800',\n                'border border-transparent focus:border-blue-500',\n                'focus:outline-none focus:ring-2 focus:ring-blue-500/20',\n                'text-gray-900 dark:text-white placeholder-gray-500',\n                'disabled:opacity-50 disabled:cursor-not-allowed',\n                'max-h-32'\n              )}\n            />\n          </div>\n        )}\n\n        {/* Mic button (show when no text/files) or Grammar Fix + Send buttons */}\n        {!message.trim() && selectedFiles.length === 0 && !audioBlob && !isRecording ? (\n          <button\n            onClick={startRecording}\n            disabled={disabled}\n            className={cn(\n              'p-3 rounded-full transition-all',\n              'bg-gray-200 dark:bg-gray-700 text-gray-500 hover:bg-gray-300 dark:hover:bg-gray-600',\n              'disabled:opacity-50 disabled:cursor-not-allowed'\n            )}\n            title=\"Record voice message\"\n          >\n            <Mic className=\"w-5 h-5\" />\n          </button>\n        ) : (\n          <>\n            {/* Grammar Fix button - shows when there's text */}\n            {message.trim() && otherUserId && (\n              <button\n                onClick={handleQuickGrammarFix}\n                disabled={isFixingGrammar || disabled}\n                className={cn(\n                  'p-3 rounded-full transition-all',\n                  'bg-purple-100 dark:bg-purple-900/30 text-purple-600 hover:bg-purple-200 dark:hover:bg-purple-800/40',\n                  'disabled:opacity-50 disabled:cursor-not-allowed'\n                )}\n                title=\"Fix grammar with AI\"\n              >\n                {isFixingGrammar ? (\n                  <Loader2 className=\"w-5 h-5 animate-spin\" />\n                ) : (\n                  <Pencil className=\"w-5 h-5\" />\n                )}\n              </button>\n            )}\n\n            {/* Send button */}\n            <button\n              onClick={handleSend}\n              disabled={(!message.trim() && selectedFiles.length === 0 && !audioBlob) || disabled || isRecording}\n              className={cn(\n                'p-3 rounded-full transition-all',\n                (message.trim() || selectedFiles.length > 0 || audioBlob)\n                  ? 'bg-blue-600 text-white hover:bg-blue-700 scale-100'\n                  : 'bg-gray-200 dark:bg-gray-700 text-gray-400 scale-95',\n                'disabled:opacity-50 disabled:cursor-not-allowed'\n              )}\n            >\n              <Send className=\"w-5 h-5\" />\n            </button>\n          </>\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5569, "column": 0}, "map": {"version":3,"sources":["file:///home/yasmanth/Pictures/vormex/vormex-web/src/components/chat/ChatHeader.tsx"],"sourcesContent":["'use client';\n\nimport React, { useState, useEffect, useRef } from 'react';\nimport Link from 'next/link';\nimport { formatDistanceToNow } from 'date-fns';\nimport { getSocket } from '@/lib/socket';\nimport { cn } from '@/lib/utils';\nimport { ReportModal } from '@/components/reports/ReportModal';\nimport { MoreVertical, Flag, UserX, Bell, BellOff } from 'lucide-react';\n\ninterface ChatHeaderProps {\n  user: {\n    id: string;\n    name: string;\n    username: string;\n    profileImage?: string | null;\n    isOnline?: boolean;\n    lastActiveAt?: string | null;\n  };\n  conversationId: string;\n  onBack?: () => void;\n  onInfo?: () => void;\n}\n\nexport default function ChatHeader({ user, conversationId, onBack, onInfo }: ChatHeaderProps) {\n  const [isOnline, setIsOnline] = useState(user.isOnline || false);\n  const [lastActive, setLastActive] = useState(user.lastActiveAt);\n  const [showMenu, setShowMenu] = useState(false);\n  const [showReportModal, setShowReportModal] = useState(false);\n  const menuRef = useRef<HTMLDivElement>(null);\n\n  // Close menu when clicking outside\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (menuRef.current && !menuRef.current.contains(event.target as Node)) {\n        setShowMenu(false);\n      }\n    };\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, []);\n\n  // Listen for online/offline status\n  useEffect(() => {\n    const socket = getSocket();\n    if (!socket) return;\n\n    const handleOnline = (data: { userId: string }) => {\n      if (data.userId === user.id) {\n        setIsOnline(true);\n      }\n    };\n\n    const handleOffline = (data: { userId: string }) => {\n      if (data.userId === user.id) {\n        setIsOnline(false);\n        setLastActive(new Date().toISOString());\n      }\n    };\n\n    socket.on('user:online', handleOnline);\n    socket.on('user:offline', handleOffline);\n\n    return () => {\n      socket.off('user:online', handleOnline);\n      socket.off('user:offline', handleOffline);\n    };\n  }, [user.id]);\n\n  // Update initial state when user prop changes\n  useEffect(() => {\n    setIsOnline(user.isOnline || false);\n    setLastActive(user.lastActiveAt);\n  }, [user.isOnline, user.lastActiveAt]);\n\n  return (\n    <div className=\"flex items-center gap-3 p-4 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900\">\n      {/* Back button (mobile) */}\n      {onBack && (\n        <button\n          onClick={onBack}\n          className=\"p-2 -ml-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full md:hidden\"\n        >\n          <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 19l-7-7 7-7\" />\n          </svg>\n        </button>\n      )}\n\n      {/* Avatar */}\n      <Link href={`/profile/${user.username}`} className=\"relative flex-shrink-0\">\n        <div className=\"w-10 h-10 rounded-full bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center text-white font-semibold\">\n          {user.profileImage ? (\n            <img\n              src={user.profileImage}\n              alt={user.name}\n              className=\"w-10 h-10 rounded-full object-cover\"\n            />\n          ) : (\n            user.name.charAt(0).toUpperCase()\n          )}\n        </div>\n        {/* Online indicator */}\n        {isOnline && (\n          <div className=\"absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white dark:border-gray-900\"></div>\n        )}\n      </Link>\n\n      {/* User info */}\n      <div className=\"flex-1 min-w-0\">\n        <Link \n          href={`/profile/${user.username}`}\n          className=\"font-semibold text-gray-900 dark:text-white hover:underline truncate block\"\n        >\n          {user.name}\n        </Link>\n        <p className=\"text-sm text-gray-500 dark:text-gray-400\">\n          {isOnline ? (\n            <span className=\"text-green-600 dark:text-green-400\">Online</span>\n          ) : lastActive ? (\n            `Last seen ${formatDistanceToNow(new Date(lastActive), { addSuffix: true })}`\n          ) : (\n            `@${user.username}`\n          )}\n        </p>\n      </div>\n\n      {/* Action buttons */}\n      <div className=\"flex items-center gap-2\">\n        {/* Voice call (future) */}\n        <button\n          className=\"p-2 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition-colors\"\n          title=\"Voice call (coming soon)\"\n          disabled\n        >\n          <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z\" />\n          </svg>\n        </button>\n\n        {/* Video call (future) */}\n        <button\n          className=\"p-2 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition-colors\"\n          title=\"Video call (coming soon)\"\n          disabled\n        >\n          <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z\" />\n          </svg>\n        </button>\n\n        {/* Info button */}\n        {onInfo && (\n          <button\n            onClick={onInfo}\n            className=\"p-2 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition-colors\"\n            title=\"Chat info\"\n          >\n            <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\n            </svg>\n          </button>\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5838, "column": 0}, "map": {"version":3,"sources":["file:///home/yasmanth/Pictures/vormex/vormex-web/src/components/chat/index.ts"],"sourcesContent":["export { default as ChatList } from './ChatList';\nexport { default as ChatMessages } from './ChatMessages';\nexport { default as ChatInput, type UploadingMessage } from './ChatInput';\nexport { default as ChatHeader } from './ChatHeader';\nexport { default as ChatSettingsPanel, WALLPAPER_OPTIONS } from './ChatSettingsPanel';\nexport { default as MessageMenu, MessageQuickActions } from './MessageMenu';\nexport { default as AIChatAssistant } from './AIChatAssistant';\n"],"names":[],"mappings":";AAAA;AACA;AACA;AACA;AACA;AACA;AACA"}},
    {"offset": {"line": 5866, "column": 0}, "map": {"version":3,"sources":["file:///home/yasmanth/Pictures/vormex/vormex-web/src/app/messages/layout.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useState, useCallback } from 'react';\nimport { useRouter, usePathname } from 'next/navigation';\nimport { ProtectedRoute } from '@/components/auth/ProtectedRoute';\nimport { useAuth } from '@/lib/auth/useAuth';\nimport { ChatList } from '@/components/chat';\nimport { initializeSocket, getSocket } from '@/lib/socket';\nimport { getUnreadCount, Conversation } from '@/lib/api/chat';\nimport Link from 'next/link';\n\ninterface MessagesLayoutProps {\n  children: React.ReactNode;\n}\n\nexport default function MessagesLayout({ children }: MessagesLayoutProps) {\n  const router = useRouter();\n  const pathname = usePathname();\n  const { user } = useAuth();\n  const [unreadCount, setUnreadCount] = useState(0);\n\n  // Extract conversation ID from pathname\n  const conversationId = pathname?.startsWith('/messages/') \n    ? pathname.split('/messages/')[1] \n    : undefined;\n  const isConversationView = !!conversationId;\n\n  // Initialize socket and fetch unread count\n  useEffect(() => {\n    if (user?.id) {\n      initializeSocket();\n      \n      // Fetch unread count\n      getUnreadCount().then(res => {\n        setUnreadCount(res.unreadCount);\n      }).catch(console.error);\n    }\n  }, [user?.id]);\n\n  // Listen for new message notifications\n  useEffect(() => {\n    const socket = getSocket();\n    if (!socket) return;\n\n    const handleNotification = () => {\n      getUnreadCount().then(res => {\n        setUnreadCount(res.unreadCount);\n      }).catch(console.error);\n    };\n\n    socket.on('chat:notification', handleNotification);\n\n    return () => {\n      socket.off('chat:notification', handleNotification);\n    };\n  }, []);\n\n  const handleSelectConversation = useCallback((conv: Conversation) => {\n    router.push(`/messages/${conv.id}`, { scroll: false });\n  }, [router]);\n\n  return (\n    <ProtectedRoute>\n      <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900\">\n        <div className=\"max-w-7xl mx-auto\">\n          {/* h-screen minus bottom nav height (pb-24 = 96px) */}\n          <div className=\"flex h-[calc(100vh-96px)]\">\n            {/* Sidebar - Chat List - ALWAYS MOUNTED, never remounts */}\n            <div className={`${isConversationView ? 'hidden md:flex' : 'flex'} w-full md:w-96 bg-white dark:bg-gray-900 border-r border-gray-200 dark:border-gray-700 flex-col`}>\n              {/* Header */}\n              <div className=\"p-4 border-b border-gray-200 dark:border-gray-700\">\n                <div className=\"flex items-center justify-between\">\n                  <h1 className=\"text-2xl font-bold text-gray-900 dark:text-white\">\n                    Messages\n                    {unreadCount > 0 && (\n                      <span className=\"ml-2 px-2 py-0.5 bg-blue-600 text-white text-sm rounded-full\">\n                        {unreadCount}\n                      </span>\n                    )}\n                  </h1>\n                  <Link\n                    href=\"/find-people\"\n                    className=\"p-2 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-full transition-colors\"\n                    title=\"New conversation\"\n                  >\n                    <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v16m8-8H4\" />\n                    </svg>\n                  </Link>\n                </div>\n                \n                {/* Search */}\n                <div className=\"mt-4 relative\">\n                  <input\n                    type=\"text\"\n                    placeholder=\"Search messages...\"\n                    className=\"w-full px-4 py-2 pl-10 bg-gray-100 dark:bg-gray-800 rounded-full border-0 focus:ring-2 focus:ring-blue-500 text-gray-900 dark:text-white placeholder-gray-500\"\n                  />\n                  <svg \n                    className=\"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400\"\n                    fill=\"none\" \n                    stroke=\"currentColor\" \n                    viewBox=\"0 0 24 24\"\n                  >\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z\" />\n                  </svg>\n                </div>\n              </div>\n\n              {/* Chat list - this component stays mounted across route changes */}\n              <ChatList \n                selectedConversationId={conversationId}\n                onSelectConversation={handleSelectConversation}\n                currentUserId={user?.id}\n              />\n            </div>\n\n            {/* Main Content Area - children will be the page content */}\n            <div className={`${isConversationView ? 'flex' : 'hidden md:flex'} flex-1 flex-col bg-white dark:bg-gray-900 h-full overflow-hidden`}>\n              {children}\n            </div>\n          </div>\n        </div>\n      </div>\n    </ProtectedRoute>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AATA;;;;;;;;;;AAee,SAAS,eAAe,EAAE,QAAQ,EAAuB;IACtE,MAAM,SAAS,IAAA,+IAAS;IACxB,MAAM,WAAW,IAAA,iJAAW;IAC5B,MAAM,EAAE,IAAI,EAAE,GAAG,IAAA,wIAAO;IACxB,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,iNAAQ,EAAC;IAE/C,wCAAwC;IACxC,MAAM,iBAAiB,UAAU,WAAW,gBACxC,SAAS,KAAK,CAAC,aAAa,CAAC,EAAE,GAC/B;IACJ,MAAM,qBAAqB,CAAC,CAAC;IAE7B,2CAA2C;IAC3C,IAAA,kNAAS,EAAC;QACR,IAAI,MAAM,IAAI;YACZ,IAAA,wIAAgB;YAEhB,qBAAqB;YACrB,IAAA,2IAAc,IAAG,IAAI,CAAC,CAAA;gBACpB,eAAe,IAAI,WAAW;YAChC,GAAG,KAAK,CAAC,QAAQ,KAAK;QACxB;IACF,GAAG;QAAC,MAAM;KAAG;IAEb,uCAAuC;IACvC,IAAA,kNAAS,EAAC;QACR,MAAM,SAAS,IAAA,iIAAS;QACxB,IAAI,CAAC,QAAQ;QAEb,MAAM,qBAAqB;YACzB,IAAA,2IAAc,IAAG,IAAI,CAAC,CAAA;gBACpB,eAAe,IAAI,WAAW;YAChC,GAAG,KAAK,CAAC,QAAQ,KAAK;QACxB;QAEA,OAAO,EAAE,CAAC,qBAAqB;QAE/B,OAAO;YACL,OAAO,GAAG,CAAC,qBAAqB;QAClC;IACF,GAAG,EAAE;IAEL,MAAM,2BAA2B,IAAA,oNAAW,EAAC,CAAC;QAC5C,OAAO,IAAI,CAAC,CAAC,UAAU,EAAE,KAAK,EAAE,EAAE,EAAE;YAAE,QAAQ;QAAM;IACtD,GAAG;QAAC;KAAO;IAEX,qBACE,8OAAC,8JAAc;kBACb,cAAA,8OAAC;YAAI,WAAU;sBACb,cAAA,8OAAC;gBAAI,WAAU;0BAEb,cAAA,8OAAC;oBAAI,WAAU;;sCAEb,8OAAC;4BAAI,WAAW,GAAG,qBAAqB,mBAAmB,OAAO,gGAAgG,CAAC;;8CAEjK,8OAAC;oCAAI,WAAU;;sDACb,8OAAC;4CAAI,WAAU;;8DACb,8OAAC;oDAAG,WAAU;;wDAAmD;wDAE9D,cAAc,mBACb,8OAAC;4DAAK,WAAU;sEACb;;;;;;;;;;;;8DAIP,8OAAC,uKAAI;oDACH,MAAK;oDACL,WAAU;oDACV,OAAM;8DAEN,cAAA,8OAAC;wDAAI,WAAU;wDAAU,MAAK;wDAAO,QAAO;wDAAe,SAAQ;kEACjE,cAAA,8OAAC;4DAAK,eAAc;4DAAQ,gBAAe;4DAAQ,aAAa;4DAAG,GAAE;;;;;;;;;;;;;;;;;;;;;;sDAM3E,8OAAC;4CAAI,WAAU;;8DACb,8OAAC;oDACC,MAAK;oDACL,aAAY;oDACZ,WAAU;;;;;;8DAEZ,8OAAC;oDACC,WAAU;oDACV,MAAK;oDACL,QAAO;oDACP,SAAQ;8DAER,cAAA,8OAAC;wDAAK,eAAc;wDAAQ,gBAAe;wDAAQ,aAAa;wDAAG,GAAE;;;;;;;;;;;;;;;;;;;;;;;8CAM3E,8OAAC,yLAAQ;oCACP,wBAAwB;oCACxB,sBAAsB;oCACtB,eAAe,MAAM;;;;;;;;;;;;sCAKzB,8OAAC;4BAAI,WAAW,GAAG,qBAAqB,SAAS,iBAAiB,iEAAiE,CAAC;sCACjI;;;;;;;;;;;;;;;;;;;;;;;;;;;AAOf"}}]
}