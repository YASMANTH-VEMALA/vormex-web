module.exports=[96331,45482,98251,42056,95102,92368,46296,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(72764),f=a.i(12469),g=a.i(94632),h=a.i(68114);function i({selectedConversationId:a,onSelectConversation:g,currentUserId:h}){let i=(0,d.useRouter)(),[k,l]=(0,c.useState)([]),[m,n]=(0,c.useState)(!0),[o,p]=(0,c.useState)(null),[q,r]=(0,c.useState)(!1),[s,t]=(0,c.useState)(),u=(0,c.useCallback)(async a=>{try{0===k.length&&n(!0);let b=await (0,e.getConversations)(30,a);a?l(a=>[...a,...b.conversations]):l(b.conversations),r(b.hasMore),t(b.nextCursor)}catch(a){p(a.message||"Failed to load conversations")}finally{n(!1)}},[k.length]);return((0,c.useEffect)(()=>{u()},[u]),(0,c.useEffect)(()=>{let b=(0,f.getSocket)();if(!b)return;let c=new Set,d=b=>{if(!c.has(b.message.id)){if(c.add(b.message.id),c.size>50){let a=c.values().next().value;void 0!==a&&c.delete(a)}l(c=>{let d=c.findIndex(a=>a.id===b.conversationId);if(d>=0){let e=c[d];if(e.lastMessage?.id===b.message.id)return c;let f=[...c],g={...f[d]};return g.lastMessage={id:b.message.id,content:b.message.content,contentType:b.message.contentType,senderId:b.message.senderId,status:b.message.status,createdAt:b.message.createdAt},g.lastMessageAt=b.message.createdAt,b.message.senderId!==h&&b.conversationId!==a&&(g.unreadCount=(g.unreadCount||0)+1),f.splice(d,1),[g,...f]}return u(),c})}},e=a=>{"new_message"===a.type&&d({conversationId:a.conversationId,message:a.message})},g=a=>{l(b=>b.map(b=>b.id===a.conversationId?{...b,unreadCount:0}:b))};return b.on("chat:new_message",d),b.on("chat:notification",e),b.on("chat:messages_read",g),()=>{b.off("chat:new_message",d),b.off("chat:notification",e),b.off("chat:messages_read",g)}},[h,a,u]),m&&0===k.length)?(0,b.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,b.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):o?(0,b.jsxs)("div",{className:"p-4 text-center text-red-500",children:[o,(0,b.jsx)("button",{onClick:()=>u(),className:"block mx-auto mt-2 text-blue-500 hover:underline",children:"Retry"})]}):0===k.length?(0,b.jsxs)("div",{className:"p-8 text-center text-gray-500 dark:text-gray-400",children:[(0,b.jsx)("div",{className:"text-4xl mb-4",children:"ðŸ’¬"}),(0,b.jsx)("p",{children:"No conversations yet"}),(0,b.jsx)("p",{className:"text-sm mt-2",children:"Start a chat with someone!"})]}):(0,b.jsx)("div",{className:"flex flex-col h-full",children:(0,b.jsxs)("div",{className:"flex-1 overflow-y-auto",children:[k.map(c=>(0,b.jsx)(j,{conversation:c,isSelected:a===c.id,currentUserId:h,onClick:()=>{g?g(c):i.push(`/messages/${c.id}`)}},c.id)),q&&(0,b.jsx)("button",{onClick:()=>{q&&s&&u(s)},disabled:m,className:"w-full py-3 text-sm text-blue-600 hover:bg-gray-50 dark:hover:bg-gray-800",children:m?"Loading...":"Load more"})]})})}function j({conversation:a,isSelected:c,currentUserId:d,onClick:e}){let f=a.otherParticipant,i=a.lastMessage,j=a.unreadCount>0,k=i?.senderId===d;return(0,b.jsxs)("div",{onClick:e,className:(0,h.cn)("flex items-center gap-3 p-3 cursor-pointer transition-colors border-b border-gray-100 dark:border-gray-800",c?"bg-blue-50 dark:bg-blue-900/20":"hover:bg-gray-50 dark:hover:bg-gray-800/50",j&&!c&&"bg-gray-50 dark:bg-gray-800/30"),children:[(0,b.jsxs)("div",{className:"relative flex-shrink-0",children:[(0,b.jsx)("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center text-white font-semibold",children:f.profileImage?(0,b.jsx)("img",{src:f.profileImage,alt:f.name,className:"w-12 h-12 rounded-full object-cover"}):f.name.charAt(0).toUpperCase()}),f.isOnline&&(0,b.jsx)("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white dark:border-gray-900"})]}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:(0,h.cn)("font-medium truncate",j&&"text-gray-900 dark:text-white font-semibold"),children:f.name}),i&&(0,b.jsx)("span",{className:"text-xs text-gray-500 flex-shrink-0",children:(0,g.formatDistanceToNow)(new Date(i.createdAt),{addSuffix:!1})})]}),(0,b.jsx)("div",{className:"flex items-center gap-1",children:i?(0,b.jsxs)(b.Fragment,{children:[k&&(0,b.jsx)("span",{className:"text-gray-400 text-sm",children:"READ"===i.status||"DELIVERED"===i.status?"âœ“âœ“":"âœ“"}),(0,b.jsx)("p",{className:(0,h.cn)("text-sm truncate",j?"text-gray-900 dark:text-white font-medium":"text-gray-500 dark:text-gray-400"),children:"image"===i.contentType?"ðŸ“· Photo":"file"===i.contentType?"ðŸ“Ž File":"voice"===i.contentType?"ðŸŽ¤ Voice message":"post"===i.contentType?"ðŸ“„ Shared a post":"reel"===i.contentType?"ðŸŽ¬ Reel":"video"===i.contentType?"ðŸŽ¬ Video":i.content})]}):(0,b.jsx)("p",{className:"text-sm text-gray-400 italic",children:"No messages yet"})})]}),j&&(0,b.jsx)("div",{className:"flex-shrink-0 w-5 h-5 bg-blue-600 rounded-full flex items-center justify-center",children:(0,b.jsx)("span",{className:"text-xs text-white font-medium",children:a.unreadCount>9?"9+":a.unreadCount})})]})}a.s(["default",()=>i],45482);var k=a.i(56711),l=a.i(12402),m=a.i(11065),n=a.i(46271),o=a.i(62036),p=a.i(70106);let q=(0,p.default)("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]);var r=a.i(5151),s=a.i(99464),t=a.i(81560);let u=(0,p.default)("Forward",[["polyline",{points:"15 17 20 12 15 7",key:"1w3sku"}],["path",{d:"M4 18v-2a4 4 0 0 1 4-4h12",key:"jmiej9"}]]);var v=a.i(21374),w=a.i(1239),x=a.i(17755),y=a.i(84505);let z=["â¤ï¸","ðŸ‘","ðŸ˜‚","ðŸ˜®","ðŸ˜¢","ðŸ™"],A={"chat-reaction-startup-vibes":["ðŸš€","ðŸ’¡","ðŸ”¥","ðŸ™Œ","âš¡","ðŸ“ˆ"],"chat-reaction-desi-memes":["ðŸ¤£","ðŸ˜Ž","ðŸ«¡","ðŸ¤Œ","ðŸ’ƒ","ðŸ˜"],"chat-reaction-finance-bros":["ðŸ’¸","ðŸ¤‘","ðŸ“‰","ðŸ’°","ðŸ¦","ðŸ¤"]},B={"gradient-2":"chat-theme-vibrant-dms","gradient-5":"chat-theme-vibrant-dms","pattern-1":"chat-theme-vibrant-dms","gradient-4":"chat-theme-dark-variants","gradient-6":"chat-theme-dark-variants","pattern-2":"chat-theme-dark-variants"};function C(a){let b=new Set(a),c=new Set(z);for(let[a,d]of Object.entries(A))if(b.has(a))for(let a of d)c.add(a);return{ownedItemSlugs:a,ownedThemePacks:["chat-theme-vibrant-dms","chat-theme-dark-variants","chat-theme-animated-bubbles"].filter(a=>b.has(a)),availableReactions:Array.from(c),animatedBubbles:b.has("chat-theme-animated-bubbles"),messageEffects:{confetti:b.has("chat-effect-confetti"),fireworks:b.has("chat-effect-fireworks"),voiceSfx:b.has("chat-effect-voice-sfx")}}}function D(a,b){let c=B[a];return!c||b.includes(c)}function E({isOpen:a,onClose:d,isOwn:e,messageContent:f,hasMedia:g,mediaUrl:i,onReply:j,onEdit:k,onDelete:l,onReact:m,onCopy:p,onForward:x,onPin:A,onStar:B,availableReactions:C=z,position:D,anchorPosition:E="right"}){let[F,G]=(0,c.useState)(!1),H=(0,c.useRef)(null);(0,c.useEffect)(()=>{let b=a=>{H.current&&!H.current.contains(a.target)&&d()};return a&&document.addEventListener("mousedown",b),()=>{document.removeEventListener("mousedown",b)}},[a,d]),(0,c.useEffect)(()=>{let b=b=>{a&&("Escape"===b.key?d():"r"!==b.key||b.metaKey||b.ctrlKey?"c"===b.key&&(b.metaKey||b.ctrlKey)&&(p(),d()):(j(),d()))};return document.addEventListener("keydown",b),()=>document.removeEventListener("keydown",b)},[a,d,j,p]);let I=[{id:"reply",label:"Reply",icon:q,onClick:()=>{j(),d()},shortcut:"R"},{id:"copy",label:"Copy",icon:r.Copy,onClick:()=>{navigator.clipboard.writeText(f),p(),d()},shortcut:"âŒ˜C"},...e?[{id:"edit",label:"Edit",icon:s.Pencil,onClick:()=>{k?.(),d()}}]:[],...g&&i?[{id:"download",label:"Download",icon:y.Download,onClick:()=>{if(i){let a=document.createElement("a");a.href=i,a.download="",a.target="_blank",document.body.appendChild(a),a.click(),document.body.removeChild(a)}d()}}]:[],{id:"forward",label:"Forward",icon:u,onClick:()=>{x?.(),d()},disabled:!0},{id:"pin",label:"Pin",icon:w.Pin,onClick:()=>{A?.(),d()},disabled:!0},{id:"star",label:"Star",icon:v.Star,onClick:()=>{B?.(),d()},disabled:!0},{id:"delete",label:"Delete",icon:t.Trash2,onClick:()=>G(!0),danger:!0}];return(0,b.jsx)(o.AnimatePresence,{children:a&&(0,b.jsxs)(n.motion.div,{ref:H,initial:{opacity:0,scale:.95,y:-10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:-10},transition:{duration:.15},className:(0,h.cn)("absolute z-50 min-w-[200px]","bg-white dark:bg-gray-800 rounded-xl shadow-xl","border border-gray-200 dark:border-gray-700","overflow-hidden"),style:D?{top:D.y,left:"left"===E?D.x:void 0,right:"right"===E?D.x:void 0}:{top:"-8px",["left"===E?"left":"right"]:"100%",marginLeft:"left"===E?"8px":void 0,marginRight:"right"===E?"8px":void 0},children:[!F&&(0,b.jsx)("div",{className:"p-2 border-b border-gray-200 dark:border-gray-700",children:(0,b.jsx)("div",{className:"flex items-center gap-1",children:C.map(a=>(0,b.jsx)("button",{onClick:()=>{m(a),d()},className:"p-1.5 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-all hover:scale-125",children:(0,b.jsx)("span",{className:"text-lg",children:a})},a))})}),F?(0,b.jsxs)("div",{className:"py-1",children:[(0,b.jsx)("div",{className:"px-3 py-2 text-sm font-medium text-gray-500 dark:text-gray-400",children:"Delete message?"}),(0,b.jsxs)("button",{onClick:()=>{l(!1),d()},className:"w-full flex items-center gap-3 px-3 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:[(0,b.jsx)(t.Trash2,{className:"w-4 h-4"}),(0,b.jsx)("span",{children:"Delete for me"})]}),e&&(0,b.jsxs)("button",{onClick:()=>{l(!0),d()},className:"w-full flex items-center gap-3 px-3 py-2 text-left text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors",children:[(0,b.jsx)(t.Trash2,{className:"w-4 h-4"}),(0,b.jsx)("span",{children:"Delete for everyone"})]}),(0,b.jsx)("button",{onClick:()=>G(!1),className:"w-full px-3 py-2 text-left text-sm text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:"Cancel"})]}):(0,b.jsx)("div",{className:"py-1",children:I.map(a=>(0,b.jsxs)("button",{onClick:a.onClick,disabled:a.disabled,className:(0,h.cn)("w-full flex items-center justify-between gap-3 px-3 py-2 text-left text-sm transition-colors",a.danger?"text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20":"text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700",a.disabled&&"opacity-50 cursor-not-allowed"),children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(a.icon,{className:"w-4 h-4"}),(0,b.jsx)("span",{children:a.label}),a.disabled&&(0,b.jsx)("span",{className:"text-xs text-gray-400",children:"(soon)"})]}),a.shortcut&&(0,b.jsx)("span",{className:"text-xs text-gray-400",children:a.shortcut})]},a.id))})]})})}function F({isVisible:a,isOwn:c,onReply:d,onReact:e,onMore:f}){return(0,b.jsx)(o.AnimatePresence,{children:a&&(0,b.jsxs)(n.motion.div,{initial:{opacity:0,y:5},animate:{opacity:1,y:0},exit:{opacity:0,y:5},transition:{duration:.1},className:(0,h.cn)("absolute -top-8 flex items-center gap-0.5","bg-white dark:bg-gray-800 rounded-lg shadow-lg","border border-gray-200 dark:border-gray-700 p-0.5",c?"right-0":"left-8"),children:[(0,b.jsx)("button",{onClick:e,className:"p-1.5 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors",title:"Add reaction",children:(0,b.jsx)("span",{className:"text-sm",children:"ðŸ˜€"})}),(0,b.jsx)("button",{onClick:d,className:"p-1.5 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors",title:"Reply",children:(0,b.jsx)(q,{className:"w-4 h-4 text-gray-500"})}),(0,b.jsx)("button",{onClick:f,className:"p-1.5 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors",title:"More options",children:(0,b.jsx)(x.MoreHorizontal,{className:"w-4 h-4 text-gray-500"})})]})})}a.s(["DEFAULT_CHAT_CUSTOMIZATION_ENTITLEMENTS",0,{ownedItemSlugs:[],ownedThemePacks:[],availableReactions:z,animatedBubbles:!1,messageEffects:{confetti:!1,fireworks:!1,voiceSfx:!1}},"DEFAULT_CHAT_REACTIONS",0,z,"buildChatCustomizationEntitlements",()=>C,"isWallpaperUnlocked",()=>D],98251);var G=a.i(33508),H=a.i(38632),I=a.i(4720),J=a.i(64791),K=a.i(23312),L=a.i(8234);let M=(0,p.default)("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);var N=a.i(94183),O=a.i(87532),P=a.i(43108);let Q=[{id:"default",name:"Default",color:"bg-gray-50 dark:bg-gray-900"},{id:"gradient-1",name:"Ocean",color:"bg-gradient-to-br from-blue-100 to-cyan-100 dark:from-blue-900/30 dark:to-cyan-900/30"},{id:"gradient-2",name:"Sunset",color:"bg-gradient-to-br from-orange-100 to-pink-100 dark:from-orange-900/30 dark:to-pink-900/30",requiredPackSlug:"chat-theme-vibrant-dms"},{id:"gradient-3",name:"Forest",color:"bg-gradient-to-br from-green-100 to-emerald-100 dark:from-green-900/30 dark:to-emerald-900/30"},{id:"gradient-4",name:"Lavender",color:"bg-gradient-to-br from-purple-100 to-violet-100 dark:from-purple-900/30 dark:to-violet-900/30",requiredPackSlug:"chat-theme-dark-variants"},{id:"gradient-5",name:"Rose",color:"bg-gradient-to-br from-rose-100 to-pink-100 dark:from-rose-900/30 dark:to-pink-900/30",requiredPackSlug:"chat-theme-vibrant-dms"},{id:"gradient-6",name:"Midnight",color:"bg-gradient-to-br from-slate-800 to-gray-900",requiredPackSlug:"chat-theme-dark-variants"},{id:"gradient-7",name:"Sky",color:"bg-gradient-to-br from-sky-100 to-indigo-100 dark:from-sky-900/30 dark:to-indigo-900/30"},{id:"gradient-8",name:"Amber",color:"bg-gradient-to-br from-amber-100 to-yellow-100 dark:from-amber-900/30 dark:to-yellow-900/30"},{id:"pattern-1",name:"Dots",color:"bg-gray-100 dark:bg-gray-800",pattern:"bg-[radial-gradient(circle,_#00000010_1px,_transparent_1px)] bg-[size:20px_20px]",requiredPackSlug:"chat-theme-vibrant-dms"},{id:"pattern-2",name:"Grid",color:"bg-gray-100 dark:bg-gray-800",pattern:"bg-[linear-gradient(#00000008_1px,_transparent_1px),linear-gradient(90deg,_#00000008_1px,_transparent_1px)] bg-[size:20px_20px]",requiredPackSlug:"chat-theme-dark-variants"}];function R({isOpen:a,onClose:d,conversationId:e,otherUser:f,currentWallpaper:g,onWallpaperChange:i,mediaItems:j=[],onClearChat:k,onBlockUser:l,onReportUser:m,ownedThemePacks:p=[],onOpenStore:q}){let[r,s]=(0,c.useState)("settings"),[u,v]=(0,c.useState)(()=>!1),[w,x]=(0,c.useState)("all"),[y,z]=(0,c.useState)(""),A=j.filter(a=>"all"===w||("images"===w?"image"===a.type:"videos"===w?"video"===a.type:"files"!==w||"file"===a.type||"audio"===a.type));return(0,b.jsx)(o.AnimatePresence,{children:a&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(n.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:d,className:"fixed inset-0 bg-black/30 backdrop-blur-sm z-40"}),(0,b.jsxs)(n.motion.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{type:"spring",damping:25,stiffness:200},className:"fixed right-0 top-0 bottom-0 w-full max-w-md bg-white dark:bg-gray-900 shadow-xl z-50 flex flex-col",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Chat Info"}),(0,b.jsx)("button",{onClick:d,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition-colors",children:(0,b.jsx)(G.X,{className:"w-5 h-5"})})]}),(0,b.jsxs)("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700 flex flex-col items-center",children:[(0,b.jsx)("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center text-white text-2xl font-semibold mb-3",children:f.profileImage?(0,b.jsx)("img",{src:f.profileImage,alt:f.name,className:"w-20 h-20 rounded-full object-cover"}):f.name.charAt(0).toUpperCase()}),(0,b.jsx)("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:f.name}),(0,b.jsxs)("p",{className:"text-gray-500 dark:text-gray-400",children:["@",f.username]}),f.isOnline&&(0,b.jsx)("span",{className:"mt-2 px-2 py-0.5 bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 text-xs rounded-full",children:"Online"})]}),(0,b.jsx)("div",{className:"flex border-b border-gray-200 dark:border-gray-700",children:[{id:"settings",label:"Settings"},{id:"wallpaper",label:"Wallpaper"},{id:"media",label:"Media"}].map(a=>(0,b.jsxs)("button",{onClick:()=>s(a.id),className:(0,h.cn)("flex-1 py-3 text-sm font-medium transition-colors relative",r===a.id?"text-blue-600 dark:text-blue-400":"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"),children:[a.label,r===a.id&&(0,b.jsx)(n.motion.div,{layoutId:"activeTab",className:"absolute bottom-0 left-0 right-0 h-0.5 bg-blue-600 dark:bg-blue-400"})]},a.id))}),(0,b.jsxs)("div",{className:"flex-1 overflow-y-auto",children:["settings"===r&&(0,b.jsxs)("div",{className:"p-4 space-y-2",children:[(0,b.jsxs)("button",{onClick:()=>{let a=!u;v(a),localStorage.setItem(`chat_muted_${e}`,String(a))},className:"w-full flex items-center justify-between p-3 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg transition-colors",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[u?(0,b.jsx)(L.BellOff,{className:"w-5 h-5 text-gray-500"}):(0,b.jsx)(K.Bell,{className:"w-5 h-5 text-gray-500"}),(0,b.jsx)("span",{className:"text-gray-900 dark:text-white",children:"Mute Notifications"})]}),(0,b.jsx)("div",{className:(0,h.cn)("w-10 h-6 rounded-full transition-colors relative",u?"bg-blue-600":"bg-gray-300 dark:bg-gray-600"),children:(0,b.jsx)("div",{className:(0,h.cn)("absolute top-1 w-4 h-4 bg-white rounded-full transition-transform",u?"translate-x-5":"translate-x-1")})})]}),(0,b.jsx)("div",{className:"my-4 border-t border-gray-200 dark:border-gray-700"}),(0,b.jsxs)("button",{onClick:k,className:"w-full flex items-center gap-3 p-3 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors text-red-600 dark:text-red-400",children:[(0,b.jsx)(t.Trash2,{className:"w-5 h-5"}),(0,b.jsx)("span",{children:"Clear Chat History"})]}),(0,b.jsxs)("button",{onClick:l,className:"w-full flex items-center gap-3 p-3 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors text-red-600 dark:text-red-400",children:[(0,b.jsx)(M,{className:"w-5 h-5"}),(0,b.jsxs)("span",{children:["Block ",f.name]})]}),(0,b.jsxs)("button",{onClick:m,className:"w-full flex items-center gap-3 p-3 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors text-red-600 dark:text-red-400",children:[(0,b.jsx)(N.Flag,{className:"w-5 h-5"}),(0,b.jsx)("span",{children:"Report"})]})]}),"wallpaper"===r&&(0,b.jsxs)("div",{className:"p-4",children:[(0,b.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:"Choose a wallpaper for this chat"}),(0,b.jsx)("div",{className:"grid grid-cols-3 gap-3",children:Q.map(a=>{let c=D(a.id,p),d=a.requiredPackSlug;return(0,b.jsxs)("button",{onClick:()=>{c?i(a.id):q?.()},className:(0,h.cn)("aspect-[3/4] rounded-xl overflow-hidden relative transition-all",a.color,a.pattern,!c&&"opacity-70",g===a.id?"ring-2 ring-blue-500 ring-offset-2 dark:ring-offset-gray-900":"hover:scale-105"),children:[a.preview&&(0,b.jsx)("img",{src:a.preview,alt:a.name,className:"w-full h-full object-cover"}),(0,b.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 p-2 bg-gradient-to-t from-black/50 to-transparent",children:[(0,b.jsx)("span",{className:"text-xs text-white font-medium",children:a.name}),!c&&(0,b.jsxs)("p",{className:"text-[10px] text-white/90",children:["Requires ","chat-theme-dark-variants"===d?"Dark Variants Pack":"Vibrant DMs Pack"]})]}),!c&&(0,b.jsx)("div",{className:"absolute top-2 left-2 w-6 h-6 bg-black/60 rounded-full flex items-center justify-center",children:(0,b.jsx)(P.Lock,{className:"w-3 h-3 text-white"})}),g===a.id&&(0,b.jsx)("div",{className:"absolute top-2 right-2 w-5 h-5 bg-blue-500 rounded-full flex items-center justify-center",children:(0,b.jsx)("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})})]},a.id)})})]}),"media"===r&&(0,b.jsxs)("div",{className:"p-4",children:[(0,b.jsxs)("div",{className:"relative mb-4",children:[(0,b.jsx)(O.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),(0,b.jsx)("input",{type:"text",value:y,onChange:a=>z(a.target.value),placeholder:"Search media...",className:"w-full pl-10 pr-4 py-2 bg-gray-100 dark:bg-gray-800 rounded-lg border-0 focus:ring-2 focus:ring-blue-500"})]}),(0,b.jsx)("div",{className:"flex gap-2 mb-4 overflow-x-auto pb-2",children:[{id:"all",label:"All",icon:null},{id:"images",label:"Images",icon:H.Image},{id:"videos",label:"Videos",icon:J.Video},{id:"files",label:"Files",icon:I.FileText}].map(a=>(0,b.jsxs)("button",{onClick:()=>x(a.id),className:(0,h.cn)("flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm whitespace-nowrap transition-colors",w===a.id?"bg-blue-600 text-white":"bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700"),children:[a.icon&&(0,b.jsx)(a.icon,{className:"w-4 h-4"}),a.label]},a.id))}),A.length>0?(0,b.jsx)("div",{className:"grid grid-cols-3 gap-2",children:A.map(a=>(0,b.jsx)("a",{href:a.url,target:"_blank",rel:"noopener noreferrer",className:"aspect-square rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-800 hover:opacity-80 transition-opacity relative group",children:"image"===a.type?(0,b.jsx)("img",{src:a.url,alt:"",className:"w-full h-full object-cover"}):"video"===a.type?(0,b.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gray-200 dark:bg-gray-700",children:(0,b.jsx)(J.Video,{className:"w-8 h-8 text-gray-500"})}):(0,b.jsxs)("div",{className:"w-full h-full flex flex-col items-center justify-center p-2",children:[(0,b.jsx)(I.FileText,{className:"w-8 h-8 text-gray-500 mb-1"}),(0,b.jsx)("span",{className:"text-xs text-gray-500 truncate w-full text-center",children:a.fileName||"File"})]})},a.id))}):(0,b.jsxs)("div",{className:"text-center py-12 text-gray-500",children:[(0,b.jsx)(H.Image,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),(0,b.jsx)("p",{children:"No media shared yet"}),(0,b.jsx)("p",{className:"text-sm",children:"Photos, videos, and files will appear here"})]})]})]})]})]})})}function S({conversationId:a,currentUserId:d,otherUser:g,wallpaper:i="default",availableReactions:j=z,animatedBubbles:n=!1,onReply:o,uploadingMessages:p=[],optimisticMessages:q=[],onLastMessageUpdate:r,onMessageConfirmed:s}){let[t,u]=(0,c.useState)([]),[v,w]=(0,c.useState)(!0),[x,y]=(0,c.useState)(!1),[A,B]=(0,c.useState)(!1),[C,D]=(0,c.useState)(),[E,F]=(0,c.useState)(null),[G,H]=(0,c.useState)(null),[I,J]=(0,c.useState)(null),[K,L]=(0,c.useState)(null),M=(0,c.useRef)(null),N=(0,c.useRef)(null),O=(0,c.useRef)(new Map),[P,R]=(0,c.useState)(!0),S=(0,c.useCallback)(a=>{let b=O.current.get(a);b&&(b.scrollIntoView({behavior:"smooth",block:"center"}),H(a),setTimeout(()=>{H(null)},1500))},[]),U=(0,c.useCallback)((a,b)=>{b?O.current.set(a,b):O.current.delete(a)},[]),V=(0,c.useCallback)(async b=>{try{b?y(!0):w(!0);let c=await (0,e.getMessages)(a,50,b),f=c.messages.map(a=>({...a,isEdited:(a=>{if(!a.createdAt||!a.updatedAt)return!1;let b=new Date(a.createdAt).getTime();return new Date(a.updatedAt).getTime()-b>=1e3})(a)}));if(b)u(a=>[...f,...a]);else if(u(f),r){let a=[...c.messages].reverse().find(a=>a.senderId!==d&&a.content);a&&r(a.content)}B(c.hasMore),D(c.nextCursor)}catch(a){console.error("Failed to fetch messages:",a)}finally{w(!1),y(!1)}},[a,d,r]);(0,c.useEffect)(()=>(V(),(0,f.joinChatRoom)(a),(0,f.markChatAsRead)(a),()=>{(0,f.leaveChatRoom)(a)}),[a,V]),(0,c.useEffect)(()=>{let b=(0,f.getSocket)();if(!b)return;let c=b=>{b.conversationId===a&&(u(a=>a.some(a=>a.id===b.message.id)?a:[...a,b.message]),R(!0),b.message.senderId===d&&s&&s(b.message.content),b.message.senderId!==d&&((0,f.markChatAsRead)(a),b.message.content&&r&&r(b.message.content)))},e=b=>{b.conversationId===a&&b.userId!==d&&F(b.isTyping?b.userId:null)},g=b=>{b.conversationId===a&&u(a=>a.map(a=>a.senderId===d&&"READ"!==a.status?{...a,status:"READ",readAt:new Date(b.readAt).toISOString()}:a))},h=b=>{b.conversationId===a&&u(a=>a.map(a=>a.senderId===d&&"SENT"===a.status?{...a,status:"DELIVERED",deliveredAt:new Date(b.deliveredAt).toISOString()}:a))},i=a=>{console.error("Chat socket error:",a.message)},j=b=>{b.conversationId===a&&(b.forEveryone?u(a=>a.map(a=>a.id===b.messageId?{...a,isDeleted:!0,content:"This message was deleted"}:a)):u(a=>a.filter(a=>a.id!==b.messageId)))},k=b=>{b.conversationId===a&&u(a=>a.map(a=>a.id===b.messageId?{...a,content:b.content,updatedAt:String(b.editedAt),isEdited:!0}:a))},l=b=>{b.conversationId===a&&u(a=>a.map(a=>{if(a.id!==b.messageId)return a;let c=[...a.reactions||[]];if("removed"===b.action)c=c.filter(a=>a.userId!==b.userId);else if("added"===b.action)c.push({id:`temp-${Date.now()}`,userId:b.userId,emoji:b.emoji,user:{id:b.userId,username:"",name:""}});else if("updated"===b.action){let a=c.findIndex(a=>a.userId===b.userId);a>=0&&(c[a]={...c[a],emoji:b.emoji})}return{...a,reactions:c}}))},m=b=>{"new_message"===b.type&&b.conversationId===a&&(u(a=>a.some(a=>a.id===b.message.id)?a:[...a,b.message]),R(!0),b.message.senderId===d&&s&&s(b.message.content),b.message.senderId!==d&&((0,f.markChatAsRead)(a),b.message.content&&r&&r(b.message.content)))};return b.on("chat:new_message",c),b.on("chat:notification",m),b.on("chat:user_typing",e),b.on("chat:messages_read",g),b.on("chat:messages_delivered",h),b.on("chat:message_deleted",j),b.on("chat:message_edited",k),b.on("chat:message_reaction",l),b.on("error",i),()=>{b.off("chat:new_message",c),b.off("chat:notification",m),b.off("chat:user_typing",e),b.off("chat:messages_read",g),b.off("chat:messages_delivered",h),b.off("chat:message_deleted",j),b.off("chat:message_edited",k),b.off("chat:message_reaction",l),b.off("error",i)}},[a,d,g.id,r,s]),(0,c.useEffect)(()=>{P&&M.current&&(M.current.scrollIntoView({behavior:"smooth"}),R(!1))},[t,P]);let W=t.reduce((a,b)=>{let c=new Date(b.createdAt),d=(0,k.format)(c,"yyyy-MM-dd");return a[d]||(a[d]=[]),a[d].push(b),a},{});if(v)return(0,b.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,b.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})});let X=Q.find(a=>a.id===i)||Q[0],Y=(0,h.cn)(X.color,X.pattern);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{ref:N,className:(0,h.cn)("flex-1 overflow-y-auto p-4 space-y-4",Y),onScroll:a=>{a.currentTarget.scrollTop<100&&A&&!x&&V(C)},children:[x&&(0,b.jsx)("div",{className:"flex justify-center py-2",children:(0,b.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-600"})}),Object.entries(W).map(([c,e])=>{var f;return(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"flex items-center justify-center my-4",children:(0,b.jsx)("div",{className:"bg-gray-200 dark:bg-gray-700 px-3 py-1 rounded-full text-xs text-gray-600 dark:text-gray-300",children:(f=new Date(c),(0,l.isToday)(f)?"Today":(0,m.isYesterday)(f)?"Yesterday":(0,k.format)(f,"MMMM d, yyyy"))})}),e.map((c,f)=>{let h=f>0?e[f-1]:null,i=!h||h.senderId!==c.senderId;return(0,b.jsx)(T,{message:c,isOwn:c.senderId===d,showAvatar:i,otherUser:g,conversationId:a,isHighlighted:G===c.id,onScrollToReply:S,registerRef:a=>U(c.id,a),onReply:o?()=>o({id:c.id,content:c.content,senderName:c.senderId===d?"You":g.name}):void 0,onViewImage:J,onViewVideo:L,availableReactions:j,animatedBubbles:n},c.id)})]},c)}),q.map(a=>(0,b.jsx)("div",{className:"flex justify-end mb-2",children:(0,b.jsxs)("div",{className:"max-w-[70%]",children:[a.replyTo&&(0,b.jsxs)("div",{className:"text-xs p-2 rounded-t-lg border-l-2 bg-blue-600/20 border-blue-400",children:[(0,b.jsx)("span",{className:"text-gray-500 text-[10px]",children:"â†© Replying to"}),(0,b.jsx)("p",{className:"truncate text-gray-700 dark:text-gray-300",children:a.replyTo.content})]}),(0,b.jsx)("div",{className:(0,h.cn)("bg-blue-600 text-white px-4 py-2 rounded-2xl rounded-br-sm",a.replyTo&&"rounded-t-none"),children:(0,b.jsx)("p",{className:"break-words whitespace-pre-wrap",children:a.content})}),(0,b.jsxs)("div",{className:"text-xs text-gray-500 mt-1 flex items-center gap-1 justify-end",children:[(0,b.jsx)("span",{children:(0,k.format)(new Date(a.createdAt),"HH:mm")}),(0,b.jsx)("span",{className:"animate-pulse",children:"â³"})]})]})},a.id)),p.map(a=>(0,b.jsx)("div",{className:"flex justify-end mb-2",children:(0,b.jsx)("div",{className:"relative max-w-[70%]",children:(0,b.jsxs)("div",{className:"bg-blue-600 text-white px-4 py-2 rounded-2xl rounded-br-sm",children:[a.preview&&("image"===a.type||"video"===a.type)&&(0,b.jsxs)("div",{className:"relative mb-2 rounded-lg overflow-hidden",children:["image"===a.type?(0,b.jsx)("img",{src:a.preview,alt:"Uploading",className:"max-w-full opacity-70",style:{maxHeight:"200px"}}):(0,b.jsx)("video",{src:a.preview,className:"max-w-full opacity-70",style:{maxHeight:"200px"},muted:!0}),(0,b.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/30",children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsxs)("svg",{className:"w-12 h-12",viewBox:"0 0 36 36",children:[(0,b.jsx)("circle",{cx:"18",cy:"18",r:"16",fill:"none",stroke:"rgba(255,255,255,0.3)",strokeWidth:"3"}),(0,b.jsx)("circle",{cx:"18",cy:"18",r:"16",fill:"none",stroke:"white",strokeWidth:"3",strokeDasharray:`${a.progress}, 100`,strokeLinecap:"round",transform:"rotate(-90 18 18)"})]}),(0,b.jsxs)("span",{className:"absolute inset-0 flex items-center justify-center text-white text-xs font-medium",children:[a.progress,"%"]})]})})]}),("audio"===a.type||"document"===a.type)&&(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsxs)("div",{className:"relative w-10 h-10",children:[(0,b.jsxs)("svg",{className:"w-10 h-10",viewBox:"0 0 36 36",children:[(0,b.jsx)("circle",{cx:"18",cy:"18",r:"16",fill:"none",stroke:"rgba(255,255,255,0.3)",strokeWidth:"3"}),(0,b.jsx)("circle",{cx:"18",cy:"18",r:"16",fill:"none",stroke:"white",strokeWidth:"3",strokeDasharray:`${a.progress}, 100`,strokeLinecap:"round",transform:"rotate(-90 18 18)"})]}),(0,b.jsx)("span",{className:"absolute inset-0 flex items-center justify-center text-white text-xs",children:"audio"===a.type?"ðŸŽ¤":"ðŸ“„"})]}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"text-sm truncate",children:a.fileName||"Uploading..."}),(0,b.jsxs)("p",{className:"text-xs opacity-70",children:["Sending... ",a.progress,"%"]})]})]}),("image"===a.type||"video"===a.type)&&(0,b.jsx)("p",{className:"text-sm",children:"image"===a.type?"ðŸ“· Sending photo...":"ðŸŽ¥ Sending video..."})]})})},a.id)),E&&(0,b.jsxs)("div",{className:"flex items-center gap-2 text-gray-500 text-sm",children:[(0,b.jsxs)("div",{className:"flex gap-1",children:[(0,b.jsx)("span",{className:"animate-bounce",children:"â€¢"}),(0,b.jsx)("span",{className:"animate-bounce",style:{animationDelay:"0.1s"},children:"â€¢"}),(0,b.jsx)("span",{className:"animate-bounce",style:{animationDelay:"0.2s"},children:"â€¢"})]}),(0,b.jsxs)("span",{children:[g.name," is typing..."]})]}),(0,b.jsx)("div",{ref:M})]}),I&&(0,b.jsxs)("div",{className:"fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4",onClick:()=>J(null),children:[(0,b.jsx)("button",{onClick:()=>J(null),className:"absolute top-4 right-4 text-white hover:bg-white/10 p-2 rounded-full transition-colors",children:(0,b.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,b.jsx)("img",{src:I,alt:"Full size image",className:"max-w-full max-h-full object-contain rounded-lg",onClick:a=>a.stopPropagation()}),(0,b.jsxs)("a",{href:I,download:!0,target:"_blank",rel:"noopener noreferrer",onClick:a=>a.stopPropagation(),className:"absolute bottom-4 right-4 bg-white/10 hover:bg-white/20 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors",children:[(0,b.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Download"]})]}),K&&(0,b.jsxs)("div",{className:"fixed inset-0 bg-black/95 z-50 flex items-center justify-center p-4",onClick:()=>L(null),children:[(0,b.jsx)("button",{onClick:()=>L(null),className:"absolute top-4 right-4 text-white hover:bg-white/10 p-2 rounded-full transition-colors z-10",children:(0,b.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,b.jsx)("video",{src:K,controls:!0,autoPlay:!0,className:"max-w-full max-h-full rounded-lg",style:{maxHeight:"90vh",maxWidth:"90vw"},onClick:a=>a.stopPropagation()}),(0,b.jsxs)("a",{href:K,download:!0,target:"_blank",rel:"noopener noreferrer",onClick:a=>a.stopPropagation(),className:"absolute bottom-4 right-4 bg-white/10 hover:bg-white/20 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors",children:[(0,b.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Download"]})]})]})}function T({message:a,isOwn:d,showAvatar:e,otherUser:g,conversationId:i,isHighlighted:j=!1,onScrollToReply:l,registerRef:m,onReply:n,onViewImage:o,onViewVideo:p,availableReactions:q=z,animatedBubbles:r=!1}){let[s,t]=(0,c.useState)(!1),[u,v]=(0,c.useState)(!1),[w,x]=(0,c.useState)(!1),[y,A]=(0,c.useState)(!1),[B,C]=(0,c.useState)(a.content),[D,G]=(0,c.useState)(!1),H=()=>{B.trim()&&B!==a.content&&(0,f.editChatMessage)(a.id,i,B),A(!1)},I=b=>{(0,f.reactToChatMessage)(a.id,i,b),x(!1)};return a.isDeleted?(0,b.jsx)("div",{ref:m,className:(0,h.cn)("flex items-center gap-2",d?"justify-end":"justify-start"),children:(0,b.jsx)("div",{className:"bg-gray-100 dark:bg-gray-800 text-gray-500 italic px-4 py-2 rounded-lg text-sm",children:"This message was deleted"})}):(0,b.jsxs)("div",{ref:m,className:(0,h.cn)("flex gap-2 group transition-all duration-300",d?"justify-end":"justify-start",j&&"bg-yellow-100/50 dark:bg-yellow-900/30 -mx-2 px-2 py-1 rounded-lg"),onMouseEnter:()=>t(!0),onMouseLeave:()=>{t(!1),x(!1)},children:[!d&&(0,b.jsx)("div",{className:(0,h.cn)("w-8 h-8 flex-shrink-0",!e&&"invisible"),children:e&&(0,b.jsx)("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center text-white text-sm font-medium",children:g.profileImage?(0,b.jsx)("img",{src:g.profileImage,alt:g.name,className:"w-8 h-8 rounded-full object-cover"}):g.name.charAt(0).toUpperCase()})}),(0,b.jsxs)("div",{className:(0,h.cn)("max-w-[70%] relative",d&&"order-first"),children:[a.replyTo&&(0,b.jsxs)("button",{onClick:()=>l?.(a.replyTo.id),className:(0,h.cn)("text-xs p-2 rounded-t-lg border-l-2 w-full text-left cursor-pointer hover:opacity-80 transition-opacity",d?"bg-blue-600/20 border-blue-400":"bg-gray-100 dark:bg-gray-800 border-gray-400"),children:[(0,b.jsx)("span",{className:"text-gray-500 text-[10px]",children:"â†© Replying to"}),(0,b.jsx)("p",{className:"truncate text-gray-700 dark:text-gray-300",children:a.replyTo.content})]}),(0,b.jsxs)("div",{className:(0,h.cn)("px-4 py-2 rounded-2xl relative",r&&"shadow-sm shadow-blue-400/15 transition-transform duration-150 hover:scale-[1.01]",d?"bg-blue-600 text-white rounded-br-sm":"bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-white rounded-bl-sm",a.replyTo&&"rounded-t-none"),children:[a.mediaUrl&&"image"===a.contentType&&(0,b.jsx)("button",{onClick:()=>o?.(a.mediaUrl),className:"block w-full text-left",children:(0,b.jsx)("img",{src:a.mediaUrl,alt:"Shared image",className:"rounded-lg max-w-full mb-2 cursor-pointer hover:opacity-90 transition-opacity",style:{maxHeight:"300px"}})}),a.mediaUrl&&"video"===a.contentType&&(0,b.jsxs)("div",{className:"relative group cursor-pointer mb-2",onClick:()=>p?.(a.mediaUrl),children:[(0,b.jsx)("video",{src:a.mediaUrl,className:"rounded-lg max-w-full",style:{maxHeight:"300px"}}),(0,b.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black/30 group-hover:bg-black/40 transition-colors rounded-lg",children:(0,b.jsx)("div",{className:"w-14 h-14 rounded-full bg-white/90 flex items-center justify-center",children:(0,b.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-gray-900 ml-1",fill:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{d:"M8 5v14l11-7z"})})})})]}),a.mediaUrl&&"audio"===a.contentType&&(0,b.jsxs)("div",{className:(0,h.cn)("flex items-center gap-3 p-2 rounded-lg mb-2",d?"bg-blue-700/50":"bg-gray-200 dark:bg-gray-700"),children:[(0,b.jsx)("div",{className:"w-10 h-10 rounded-full bg-green-500 flex items-center justify-center",children:(0,b.jsx)("span",{className:"text-white text-lg",children:"ðŸŽ¤"})}),(0,b.jsx)("audio",{src:a.mediaUrl,controls:!0,className:"flex-1 h-8",style:{maxWidth:"200px"}})]}),a.mediaUrl&&"document"===a.contentType&&(0,b.jsxs)("a",{href:a.mediaUrl,target:"_blank",rel:"noopener noreferrer",className:(0,h.cn)("flex items-center gap-3 p-3 rounded-lg mb-2 transition-colors",d?"bg-blue-700/50 hover:bg-blue-700/70":"bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600"),children:[(0,b.jsx)("div",{className:"w-10 h-10 rounded-lg bg-red-500 flex items-center justify-center",children:(0,b.jsx)("span",{className:"text-white text-lg",children:"ðŸ“„"})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:(0,h.cn)("font-medium truncate text-sm",d?"text-white":"text-gray-900 dark:text-white"),children:a.fileName||"Document"}),a.fileSize&&(0,b.jsxs)("p",{className:(0,h.cn)("text-xs",d?"text-blue-200":"text-gray-500"),children:[(a.fileSize/1024).toFixed(1)," KB"]})]})]}),a.mediaUrl&&"file"===a.contentType&&(0,b.jsxs)("a",{href:a.mediaUrl,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 bg-white/10 p-2 rounded mb-2 hover:bg-white/20",children:[(0,b.jsx)("span",{children:"ðŸ“Ž"}),(0,b.jsx)("span",{className:"truncate",children:a.fileName||"File"})]}),"reel"===a.contentType&&(()=>{let c=null;try{c=JSON.parse(a.content).reelId||null}catch{let b=a.content?.match(/\/reels\/([a-f0-9-]+)/i);c=b?.[1]||null}let e=a.mediaUrl,f=c?`/reels/${c}`:"/reels";return(0,b.jsxs)("a",{href:f,onClick:a=>{a.preventDefault(),window.location.href=f},className:(0,h.cn)("block relative rounded-xl overflow-hidden w-24 h-36 flex-shrink-0 cursor-pointer hover:opacity-90 transition-opacity",d?"ring-2 ring-white/30":"ring-2 ring-gray-300 dark:ring-gray-600"),children:[e?(0,b.jsx)("img",{src:e,alt:"Reel",className:"w-full h-full object-cover"}):(0,b.jsx)("div",{className:(0,h.cn)("w-full h-full flex items-center justify-center",d?"bg-blue-700/50":"bg-gray-200 dark:bg-gray-700"),children:(0,b.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 opacity-70",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:[(0,b.jsx)("rect",{width:"18",height:"18",x:"3",y:"3",rx:"2"}),(0,b.jsx)("path",{d:"M7 3v18"}),(0,b.jsx)("path",{d:"M17 3v18"}),(0,b.jsx)("path",{d:"M3 12h18"})]})}),(0,b.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-8 bg-gradient-to-t from-black/60 to-transparent flex items-end justify-center pb-1",children:(0,b.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{d:"M8 5v14l11-7z"})})})]})})(),("post"===a.contentType||"application/x-shared-post"===a.contentType)&&(()=>{try{let c=JSON.parse(a.content),e=c.postId,f=c.postUrl||(e?`/post/${e}`:null);return(0,b.jsxs)("a",{href:f||"#",onClick:a=>{f&&(a.preventDefault(),window.location.href=f)},className:(0,h.cn)("block rounded-lg p-3 mb-2 cursor-pointer transition-colors",d?"bg-blue-700/50 hover:bg-blue-700/70":"bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600"),children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2 text-xs opacity-70",children:[(0,b.jsx)("span",{children:"ðŸ“„"}),(0,b.jsx)("span",{children:"Shared Post"})]}),c.mediaUrl&&(0,b.jsx)("img",{src:c.mediaUrl,alt:"Post media",className:"rounded-md w-full h-24 object-cover mb-2"}),c.author&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[c.author.profileImage&&(0,b.jsx)("img",{src:c.author.profileImage,alt:c.author.name,className:"w-6 h-6 rounded-full object-cover"}),(0,b.jsx)("p",{className:(0,h.cn)("font-medium text-sm",d?"text-white":"text-gray-900 dark:text-white"),children:c.author.name})]}),c.author.username&&(0,b.jsxs)("p",{className:(0,h.cn)("text-xs opacity-60",d?"text-blue-200":"text-gray-500"),children:["@",c.author.username]})]}),!c.author&&c.authorName&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("p",{className:(0,h.cn)("font-medium text-sm",d?"text-white":"text-gray-900 dark:text-white"),children:c.authorName}),c.authorUsername&&(0,b.jsxs)("p",{className:(0,h.cn)("text-xs opacity-60",d?"text-blue-200":"text-gray-500"),children:["@",c.authorUsername]})]}),(c.preview||c.contentPreview)&&(0,b.jsx)("p",{className:(0,h.cn)("text-sm mt-1 line-clamp-2",d?"text-blue-100":"text-gray-600 dark:text-gray-300"),children:c.preview||c.contentPreview}),(0,b.jsx)("p",{className:"text-xs opacity-50 mt-2 italic",children:"Tap to view post â†’"})]})}catch{return(0,b.jsx)("p",{className:"break-words whitespace-pre-wrap",children:a.content})}})(),"post"!==a.contentType&&"reel"!==a.contentType&&(y?(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("input",{type:"text",value:B,onChange:a=>C(a.target.value),className:"flex-1 bg-white/20 rounded px-2 py-1 text-sm",autoFocus:!0,onKeyDown:a=>{"Enter"===a.key&&H(),"Escape"===a.key&&A(!1)}}),(0,b.jsx)("button",{onClick:H,className:"text-xs",children:"Save"})]}):(0,b.jsx)("p",{className:"break-words whitespace-pre-wrap",children:a.content})),!a.isDeleted&&a.isEdited&&(0,b.jsx)("span",{className:"text-xs opacity-60 ml-1",children:"(edited)"})]}),a.reactions&&a.reactions.length>0&&(0,b.jsx)("div",{className:(0,h.cn)("flex flex-wrap gap-1 mt-1",d?"justify-end":"justify-start"),children:Array.from(new Set(a.reactions.map(a=>a.emoji))).map(c=>{let d=a.reactions.filter(a=>a.emoji===c).length;return(0,b.jsxs)("button",{onClick:()=>I(c),className:"bg-gray-100 dark:bg-gray-800 px-2 py-0.5 rounded-full text-sm flex items-center gap-1 hover:bg-gray-200 dark:hover:bg-gray-700",children:[(0,b.jsx)("span",{children:c}),(0,b.jsx)("span",{className:"text-xs text-gray-500",children:d})]},c)})}),(0,b.jsxs)("div",{className:(0,h.cn)("text-xs text-gray-500 mt-1 flex items-center gap-1",d?"justify-end":"justify-start"),children:[(0,b.jsx)("span",{children:(0,k.format)(new Date(a.createdAt),"HH:mm")}),d&&(0,b.jsx)("span",{className:(0,h.cn)("READ"===a.status&&"text-blue-500"),children:"READ"===a.status||"DELIVERED"===a.status?"âœ“âœ“":"âœ“"})]}),(0,b.jsx)(F,{isVisible:s&&!y&&!u,isOwn:d,onReply:()=>n?.(),onReact:()=>x(!w),onMore:()=>v(!0)}),(0,b.jsx)(E,{isOpen:u,onClose:()=>v(!1),isOwn:d,messageContent:a.content,hasMedia:!!a.mediaUrl,mediaUrl:a.mediaUrl,onReply:()=>n?.(),onEdit:()=>A(!0),onDelete:b=>{(0,f.deleteChatMessage)(a.id,i,b),t(!1),v(!1)},onReact:I,onCopy:()=>{G(!0),setTimeout(()=>G(!1),2e3)},availableReactions:q,anchorPosition:d?"right":"left"}),w&&!u&&(0,b.jsx)("div",{className:(0,h.cn)("absolute -top-10 flex items-center gap-1 bg-white dark:bg-gray-900 shadow-lg rounded-full px-2 py-1",d?"right-0":"left-0"),children:q.map(a=>(0,b.jsx)("button",{onClick:()=>I(a),className:"hover:scale-125 transition-transform p-1",children:a},a))}),D&&(0,b.jsx)("div",{className:"absolute -top-8 left-1/2 -translate-x-1/2 bg-black/70 text-white text-xs px-2 py-1 rounded",children:"Copied!"})]})]})}a.s(["WALLPAPER_OPTIONS",()=>Q,"default",()=>R],42056),a.s(["default",()=>S],95102);var U=a.i(70580);let V=(0,p.default)("Paperclip",[["path",{d:"M13.234 20.252 21 12.3",key:"1cbrk9"}],["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 0 2.828 2 2 0 0 0 2.828 0l8.414-8.586a4 4 0 0 0 0-5.656 4 4 0 0 0-5.656 0l-8.415 8.585a6 6 0 1 0 8.486 8.486",key:"1pkts6"}]]),W=(0,p.default)("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);var X=a.i(92759);let Y=(0,p.default)("Smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]),Z=(0,p.default)("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);var $=a.i(8406),_=a.i(96221),aa=a.i(17371),ab=a.i(45222),ac=a.i(1027);let ad=(0,p.default)("MessageSquarePlus",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}],["path",{d:"M12 7v6",key:"lw1j43"}],["path",{d:"M9 10h6",key:"9gxzsh"}]]);var ae=a.i(69520);let af=(0,p.default)("SpellCheck",[["path",{d:"m6 16 6-12 6 12",key:"1b4byz"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"m16 20 2 2 4-4",key:"13tcca"}]]),ag=(0,p.default)("Languages",[["path",{d:"m5 8 6 6",key:"1wu5hv"}],["path",{d:"m4 14 6-6 2-3",key:"1k1g8d"}],["path",{d:"M2 5h12",key:"or177f"}],["path",{d:"M7 2h1",key:"1t2jsx"}],["path",{d:"m22 22-5-10-5 10",key:"don7ne"}],["path",{d:"M14 18h6",key:"1m8k6r"}]]),ah=(0,p.default)("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);var ai=a.i(54347),aj=a.i(33441),ak=a.i(5784),al=a.i(92415);async function am(a){return al.default.post("/ai/chat/conversation-starters",{otherUserId:a})}async function an(a,b){return al.default.post("/ai/chat/revival-suggestions",{conversationId:a,otherUserId:b})}async function ao(a,b){return al.default.post("/ai/chat/fix-grammar",{message:a,context:b})}async function ap(a,b){return al.default.post("/ai/chat/smart-replies",{lastMessage:a,conversationId:b})}async function aq(a,b){return al.default.post("/ai/chat/change-tone",{message:a,tone:b})}async function ar(a,b){return al.default.post("/ai/chat/translate",{message:a,targetLanguage:b})}async function as(a,b){return al.default.post("/ai/chat/expand",{message:a,context:b})}let at=[{id:"starters",label:"Ice Breakers",icon:(0,b.jsx)(ad,{className:"w-4 h-4"}),description:"Personalized conversation starters"},{id:"revival",label:"Continue Chat",icon:(0,b.jsx)(ae.RefreshCw,{className:"w-4 h-4"}),description:"Revive a stalled conversation"},{id:"smart-reply",label:"Quick Reply",icon:(0,b.jsx)(ac.Zap,{className:"w-4 h-4"}),description:"Smart reply suggestions",requiresReceivedMessage:!0},{id:"grammar",label:"Fix Grammar",icon:(0,b.jsx)(af,{className:"w-4 h-4"}),description:"Fix grammar & spelling",requiresMessage:!0},{id:"tone",label:"Change Tone",icon:(0,b.jsx)(ai.Palette,{className:"w-4 h-4"}),description:"Rewrite in different tone",requiresMessage:!0},{id:"translate",label:"Translate",icon:(0,b.jsx)(ag,{className:"w-4 h-4"}),description:"Translate to another language",requiresMessage:!0},{id:"expand",label:"Expand",icon:(0,b.jsx)(ah,{className:"w-4 h-4"}),description:"Expand short message",requiresMessage:!0}],au=[{value:"professional",label:"Professional",emoji:"ðŸ’¼"},{value:"casual",label:"Casual",emoji:"ðŸ˜Ž"},{value:"friendly",label:"Friendly",emoji:"ðŸ¤—"},{value:"formal",label:"Formal",emoji:"ðŸŽ©"},{value:"enthusiastic",label:"Enthusiastic",emoji:"ðŸ”¥"},{value:"concise",label:"Concise",emoji:"âš¡"}],av=[{value:"english",label:"English"},{value:"hindi",label:"Hindi"},{value:"telugu",label:"Telugu"},{value:"hinglish",label:"Hinglish"},{value:"tenglish",label:"Tenglish"}];function aw({conversationId:a,otherUserId:d,otherUserName:e,currentMessage:f,lastReceivedMessage:g,onSuggestionSelect:i,onClose:j}){let[k,l]=(0,c.useState)(null),[m,p]=(0,c.useState)(!1),[q,r]=(0,c.useState)(null),[s,t]=(0,c.useState)([]),[u,v]=(0,c.useState)("casual"),[w,x]=(0,c.useState)("english"),[y,z]=(0,c.useState)(!1),[A,B]=(0,c.useState)(!1),C=async a=>{at.find(b=>b.id===a)?.requiresMessage&&!f.trim()?r("Please type a message first"):at.find(b=>b.id===a)?.requiresReceivedMessage&&!g?r("No message to reply to"):(l(a),r(null),t([]),"tone"!==a&&"translate"!==a&&await D(a))},D=async(b,c)=>{p(!0),r(null);try{let e=[];switch(b){case"starters":e=(await am(d)).suggestions;break;case"revival":e=(await an(a,d)).suggestions;break;case"grammar":{let a=await ao(f);e=[a.corrected,...a.alternatives];break}case"smart-reply":e=(await ap(g||"",a)).suggestions;break;case"tone":e=[(await aq(f,c?.tone||u)).result];break;case"translate":e=[(await ar(f,c?.language||w)).translated];break;case"expand":e=[(await as(f)).expanded]}t(e)}catch(a){console.error("AI suggestion error:",a),r(a.response?.data?.error||"Failed to generate suggestions")}finally{p(!1)}},E=async a=>{v(a),z(!1),await D("tone",{tone:a})},F=async a=>{x(a),B(!1),await D("translate",{language:a})};return(0,b.jsxs)(n.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"absolute bottom-full left-0 right-0 mb-3 mx-0 bg-white dark:bg-gray-800 rounded-2xl shadow-2xl border border-gray-200 dark:border-gray-700 overflow-hidden z-50",style:{maxHeight:"calc(100vh - 200px)"},children:[(0,b.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200 dark:border-gray-700 bg-gradient-to-r from-purple-50 to-blue-50 dark:from-purple-900/20 dark:to-blue-900/20",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-purple-500 to-blue-500 flex items-center justify-center",children:(0,b.jsx)($.Sparkles,{className:"w-4 h-4 text-white"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-semibold text-sm text-gray-900 dark:text-white",children:"AI Assistant"}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:k?at.find(a=>a.id===k)?.description:"Choose an action"})]})]}),(0,b.jsx)("button",{onClick:j,className:"p-1.5 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors",children:(0,b.jsx)(G.X,{className:"w-4 h-4 text-gray-500"})})]}),(0,b.jsx)("div",{className:"p-3 max-h-80 overflow-y-auto",children:(0,b.jsx)(o.AnimatePresence,{mode:"wait",children:k?(0,b.jsxs)(n.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[(0,b.jsxs)("button",{onClick:()=>{l(null),t([]),r(null)},className:"flex items-center gap-1 text-sm text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 mb-3",children:[(0,b.jsx)(ak.ChevronDown,{className:"w-4 h-4 rotate-90"}),"Back to options"]}),"tone"===k&&(0,b.jsxs)("div",{className:"mb-3 relative",children:[(0,b.jsxs)("button",{onClick:()=>z(!y),className:"w-full flex items-center justify-between px-4 py-2.5 bg-gray-100 dark:bg-gray-700 rounded-xl text-sm",children:[(0,b.jsxs)("span",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{children:au.find(a=>a.value===u)?.emoji}),(0,b.jsx)("span",{children:au.find(a=>a.value===u)?.label})]}),(0,b.jsx)(ak.ChevronDown,{className:(0,h.cn)("w-4 h-4 transition-transform",y&&"rotate-180")})]}),y&&(0,b.jsx)("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden z-10",children:au.map(a=>(0,b.jsxs)("button",{onClick:()=>E(a.value),className:"w-full flex items-center gap-2 px-4 py-2.5 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 text-left",children:[(0,b.jsx)("span",{children:a.emoji}),(0,b.jsx)("span",{children:a.label}),u===a.value&&(0,b.jsx)(aj.Check,{className:"w-4 h-4 ml-auto text-green-500"})]},a.value))})]}),"translate"===k&&(0,b.jsxs)("div",{className:"mb-3 relative",children:[(0,b.jsxs)("button",{onClick:()=>B(!A),className:"w-full flex items-center justify-between px-4 py-2.5 bg-gray-100 dark:bg-gray-700 rounded-xl text-sm",children:[(0,b.jsx)("span",{children:av.find(a=>a.value===w)?.label}),(0,b.jsx)(ak.ChevronDown,{className:(0,h.cn)("w-4 h-4 transition-transform",A&&"rotate-180")})]}),A&&(0,b.jsx)("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden z-10",children:av.map(a=>(0,b.jsxs)("button",{onClick:()=>F(a.value),className:"w-full flex items-center gap-2 px-4 py-2.5 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 text-left",children:[(0,b.jsx)("span",{children:a.label}),w===a.value&&(0,b.jsx)(aj.Check,{className:"w-4 h-4 ml-auto text-green-500"})]},a.value))})]}),m&&(0,b.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,b.jsx)(_.Loader2,{className:"w-6 h-6 animate-spin text-blue-500"}),(0,b.jsx)("span",{className:"ml-2 text-sm text-gray-500",children:"Generating suggestions..."})]}),q&&(0,b.jsxs)("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 rounded-xl text-center",children:[(0,b.jsx)("p",{className:"text-sm text-red-600 dark:text-red-400",children:q}),(0,b.jsx)("button",{onClick:()=>D(k),className:"mt-2 text-sm text-blue-600 hover:underline",children:"Try again"})]}),!m&&!q&&s.length>0&&(0,b.jsx)("div",{className:"space-y-2",children:s.map((a,c)=>(0,b.jsxs)(n.motion.button,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.1*c},onClick:()=>{i(a),j?.()},className:(0,h.cn)("w-full p-3 text-left rounded-xl transition-all","bg-gray-50 dark:bg-gray-700/50 hover:bg-gray-100 dark:hover:bg-gray-700","hover:shadow-md hover:scale-[1.01]","border border-transparent hover:border-blue-200 dark:hover:border-blue-800"),children:[(0,b.jsx)("p",{className:"text-sm text-gray-800 dark:text-gray-200 leading-relaxed",children:a}),0===c&&"grammar"===k&&(0,b.jsxs)("span",{className:"inline-flex items-center gap-1 mt-1 text-xs text-green-600 dark:text-green-400",children:[(0,b.jsx)(aj.Check,{className:"w-3 h-3"}),"Best correction"]})]},c))}),!m&&s.length>0&&"tone"!==k&&"translate"!==k&&(0,b.jsxs)("button",{onClick:()=>D(k),className:"w-full mt-3 flex items-center justify-center gap-2 py-2.5 text-sm text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl transition-colors",children:[(0,b.jsx)(ae.RefreshCw,{className:"w-4 h-4"}),"Generate new suggestions"]})]},"suggestions"):(0,b.jsx)(n.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"grid grid-cols-2 gap-2",children:at.map(a=>{let c=a.requiresMessage&&!f.trim()||a.requiresReceivedMessage&&!g;return(0,b.jsxs)("button",{onClick:()=>C(a.id),disabled:c,className:(0,h.cn)("flex items-center gap-3 p-3 rounded-xl text-left transition-all",c?"opacity-50 cursor-not-allowed bg-gray-50 dark:bg-gray-800":"hover:bg-gray-100 dark:hover:bg-gray-700 bg-gray-50 dark:bg-gray-800/50 hover:scale-[1.02]"),children:[(0,b.jsx)("div",{className:(0,h.cn)("w-9 h-9 rounded-xl flex items-center justify-center","starters"===a.id&&"bg-green-100 dark:bg-green-900/30 text-green-600","revival"===a.id&&"bg-orange-100 dark:bg-orange-900/30 text-orange-600","smart-reply"===a.id&&"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-600","grammar"===a.id&&"bg-blue-100 dark:bg-blue-900/30 text-blue-600","tone"===a.id&&"bg-purple-100 dark:bg-purple-900/30 text-purple-600","translate"===a.id&&"bg-pink-100 dark:bg-pink-900/30 text-pink-600","expand"===a.id&&"bg-cyan-100 dark:bg-cyan-900/30 text-cyan-600"),children:a.icon}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:"font-medium text-sm text-gray-900 dark:text-white truncate",children:a.label}),(0,b.jsx)("p",{className:"text-xs text-gray-500 truncate",children:a.description})]})]},a.id)})},"features")})}),(0,b.jsx)("div",{className:"px-4 py-2 bg-gray-50 dark:bg-gray-900/50 border-t border-gray-200 dark:border-gray-700",children:(0,b.jsx)("p",{className:"text-xs text-gray-500 text-center",children:f.trim()?`Message: "${f.slice(0,30)}${f.length>30?"...":""}"`:"Type a message to use grammar, tone, or translate features"})})]})}let ax={image:["image/jpeg","image/png","image/gif","image/webp"],video:["video/mp4","video/webm","video/quicktime"],document:["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],audio:["audio/mpeg","audio/wav","audio/ogg","audio/webm"]};function ay({conversationId:d,currentUserId:g,replyTo:i,onCancelReply:j,disabled:k=!1,onUploadingMessagesChange:l,onOptimisticMessage:m,otherUserId:p,otherUserName:q,lastReceivedMessage:r,enabledMessageEffects:u}){let[v,w]=(0,c.useState)(""),[x,y]=(0,c.useState)(!1),[z,A]=(0,c.useState)(!1),[B,C]=(0,c.useState)(!1),[D,E]=(0,c.useState)(!1),[F,K]=(0,c.useState)(!1),[L,M]=(0,c.useState)([]),[N,O]=(0,c.useState)(!1),[Q,R]=(0,c.useState)(0),[S,T]=(0,c.useState)(null),[ad,ae]=(0,c.useState)([]),[af,ag]=(0,c.useState)(null),[ah,ai]=(0,c.useState)(!1),[aj,ak]=(0,c.useState)(!1),[al,am]=(0,c.useState)(!1),[an,ap]=(0,c.useState)("none"),aq=(0,c.useRef)(null),ar=(0,c.useRef)(null),as=(0,c.useRef)(null),at=(0,c.useRef)(null),au=(0,c.useRef)(null),av=(0,c.useRef)([]),ay=(0,c.useRef)(null);(0,c.useEffect)(()=>{(async()=>{if(p)try{let a=await (0,e.getMessageLimitStatus)(p);ag(a),a.isConnected||a.canSend||ai(!0)}catch(a){console.error("Failed to check message limit:",a)}})()},[d,p]);let az=(0,c.useMemo)(()=>[...u?.confetti?["confetti"]:[],...u?.fireworks?["fireworks"]:[]],[u?.confetti,u?.fireworks]);(0,c.useEffect)(()=>{"none"!==an&&(az.includes(an)||ap("none"))},[az,an]);let aA=(0,c.useCallback)(async b=>{try{let c=(await a.A(48743)).default;if("confetti"===b)return void c({particleCount:60,spread:55,origin:{y:.7},colors:["#22c55e","#38bdf8","#f59e0b","#f43f5e"]});c({particleCount:80,spread:70,origin:{x:.2,y:.7},colors:["#f97316","#facc15","#fb7185","#60a5fa"]}),c({particleCount:80,spread:70,origin:{x:.8,y:.7},colors:["#f97316","#facc15","#fb7185","#60a5fa"]})}catch{}},[]),aB=(0,c.useCallback)(()=>{u?.voiceSfx},[u?.voiceSfx]),aC=async()=>{if(p&&!aj){ak(!0);try{await (0,U.sendConnectionRequest)(p),am(!0)}catch(b){console.error("Failed to send connection request:",b);let a=b instanceof Error?b.message:"";a.includes("already")||a.includes("pending")?am(!0):alert("Failed to send connection request. Please try again.")}finally{ak(!1)}}};(0,c.useEffect)(()=>{aq.current&&(aq.current.style.height="auto",aq.current.style.height=`${Math.min(aq.current.scrollHeight,120)}px`)},[v]),(0,c.useEffect)(()=>{let a=a=>{at.current&&!at.current.contains(a.target)&&C(!1)};return B&&document.addEventListener("mousedown",a),()=>{document.removeEventListener("mousedown",a)}},[B]);let aD=(0,c.useCallback)(()=>{x||(y(!0),(0,f.sendChatTyping)(d,!0)),as.current&&clearTimeout(as.current),as.current=setTimeout(()=>{y(!1),(0,f.sendChatTyping)(d,!1)},2e3)},[d,x]);(0,c.useEffect)(()=>()=>{as.current&&clearTimeout(as.current)},[]);let aE=a=>{for(let[b,c]of Object.entries(ax))if(c.includes(a.type))return b;return null},aF=a=>new Promise(b=>{let c=document.createElement("video");c.preload="metadata",c.onloadedmetadata=()=>{URL.revokeObjectURL(c.src),c.duration>60?(alert(`Video "${a.name}" is too long. Maximum duration is 60 seconds.`),b(!1)):b(!0)},c.onerror=()=>{URL.revokeObjectURL(c.src),b(!0)},c.src=URL.createObjectURL(a)}),aG=async a=>{let b=Array.from(a.target.files||[]),c=[];for(let a of b){if(a.size>0x3200000){alert(`File "${a.name}" is too large. Maximum size is 50MB.`);continue}let b=aE(a);if(!b){alert(`File type not supported: ${a.name}`);continue}if("video"===b&&!await aF(a))continue;let d="";("image"===b||"video"===b)&&(d=URL.createObjectURL(a)),c.push({file:a,preview:d,type:b})}M(a=>[...a,...c]),C(!1),ar.current&&(ar.current.value="")},aH=a=>{ar.current&&(ar.current.accept=a,ar.current.click()),C(!1)},aI=async()=>{try{let a=await navigator.mediaDevices.getUserMedia({audio:!0}),b=new MediaRecorder(a,{mimeType:"audio/webm"});au.current=b,av.current=[],b.ondataavailable=a=>{a.data.size>0&&av.current.push(a.data)},b.onstop=()=>{let b=new Blob(av.current,{type:"audio/webm"});T(b),a.getTracks().forEach(a=>a.stop())},b.start(),O(!0),R(0),ay.current=setInterval(()=>{R(a=>a+1)},1e3)}catch(a){console.error("Failed to start recording:",a),alert("Could not access microphone. Please grant permission.")}},aJ=a=>{let b=Math.floor(a/60);return`${b}:${(a%60).toString().padStart(2,"0")}`};(0,c.useEffect)(()=>{l?.(ad)},[ad,l]);let aK=async()=>{let a=v.trim(),b=L.length>0,c=null!==S;if(!a&&!b&&!c)return;if(af&&!af.isConnected&&!af.canSend)return void ai(!0);as.current&&(clearTimeout(as.current),as.current=null),y(!1),(0,f.sendChatTyping)(d,!1),af&&!af.isConnected&&ag(a=>a?{...a,messagesSent:a.messagesSent+1,messagesRemaining:Math.max(0,a.messagesRemaining-1),canSend:a.messagesRemaining>1}:null);let h=[...L];if(w(""),M([]),T(null),R(0),j?.(),aq.current?.focus(),c&&S){let a=`upload-audio-${Date.now()}`;ae(b=>[...b,{id:a,type:"audio",fileName:"Voice message",progress:0}]);try{let b=new globalThis.File([S],`voice-${Date.now()}.webm`,{type:"audio/webm"}),c=await (0,e.uploadChatMedia)(b,"audio",b=>{ae(c=>c.map(c=>c.id===a?{...c,progress:b}:c))});ae(b=>b.filter(b=>b.id!==a)),(0,f.sendChatMessage)({conversationId:d,content:"ðŸŽ¤ Voice message",contentType:"audio",mediaUrl:c.mediaUrl,fileName:c.fileName,fileSize:c.fileSize,replyToId:i?.id}),aB()}catch(b){console.error("Failed to upload audio:",b),ae(b=>b.filter(b=>b.id!==a)),alert("Failed to send voice message")}}b&&Promise.all(h.map(async(a,b)=>{let c=`upload-${Date.now()}-${b}`;ae(b=>[...b,{id:c,type:a.type,preview:a.preview,fileName:a.file.name,progress:0}]);try{let g=await (0,e.uploadChatMedia)(a.file,a.type,a=>{ae(b=>b.map(b=>b.id===c?{...b,progress:a}:b))});ae(a=>a.filter(a=>a.id!==c)),(0,f.sendChatMessage)({conversationId:d,content:"image"===a.type?"ðŸ“· Photo":"video"===a.type?"ðŸŽ¥ Video":"document"===a.type?`ðŸ“„ ${a.file.name}`:`ðŸ“Ž ${a.file.name}`,contentType:a.type,mediaUrl:g.mediaUrl,fileName:g.fileName,fileSize:g.fileSize,replyToId:0===b?i?.id:void 0}),a.preview&&URL.revokeObjectURL(a.preview)}catch(b){console.error("Failed to upload file:",b),ae(a=>a.filter(a=>a.id!==c)),alert(`Failed to send ${a.file.name}`)}})),a&&(m&&g&&m({id:`optimistic-${Date.now()}`,conversationId:d,senderId:g,content:a,contentType:"text",replyToId:i?.id,replyTo:i?{id:i.id,content:i.content,senderName:i.senderName}:void 0,status:"SENDING",createdAt:new Date().toISOString()}),(0,f.sendChatMessage)({conversationId:d,content:a,contentType:"text",replyToId:i?.id}),"none"!==an&&aA(an))},aL=async()=>{if(v.trim()&&!F){K(!0);try{let a=await ao(v);w(a.corrected),aq.current?.focus()}catch(a){console.error("Grammar fix error:",a)}finally{K(!1)}}};return(0,b.jsxs)("div",{className:"relative border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 p-4",children:[(0,b.jsx)(o.AnimatePresence,{children:D&&p&&(0,b.jsx)(aw,{conversationId:d,otherUserId:p,otherUserName:q||"User",currentMessage:v,lastReceivedMessage:r,onSuggestionSelect:a=>{w(a),E(!1),aq.current?.focus()},onClose:()=>E(!1)})}),(0,b.jsx)(o.AnimatePresence,{children:ah&&af&&!af.isConnected&&!af.canSend&&(0,b.jsx)(n.motion.div,{initial:{opacity:0,y:20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:20,scale:.95},className:"absolute bottom-full left-0 right-0 mb-2 mx-4",children:(0,b.jsx)("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/30 dark:to-indigo-900/30 border border-blue-200 dark:border-blue-700 rounded-xl p-4 shadow-lg",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)("div",{className:"flex-shrink-0 w-10 h-10 rounded-full bg-blue-100 dark:bg-blue-800 flex items-center justify-center",children:(0,b.jsx)(P.Lock,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("h4",{className:"text-sm font-semibold text-gray-900 dark:text-white mb-1",children:"Connect to Continue Messaging"}),(0,b.jsxs)("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-3",children:["You've sent ",af.messagesSent," of ",af.limit," messages. Connect with ",(0,b.jsx)("span",{className:"font-medium",children:q||"this user"})," to send unlimited messages."]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[al?(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm text-green-600 dark:text-green-400",children:[(0,b.jsx)("div",{className:"w-5 h-5 rounded-full bg-green-100 dark:bg-green-800 flex items-center justify-center",children:(0,b.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,b.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),(0,b.jsx)("span",{className:"font-medium",children:"Connection request sent!"})]}):(0,b.jsx)("button",{onClick:aC,disabled:aj,className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-white text-sm font-medium rounded-lg transition-colors",children:aj?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(_.Loader2,{className:"w-4 h-4 animate-spin"}),"Sending..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(aa.UserPlus,{className:"w-4 h-4"}),"Send Connection Request"]})}),(0,b.jsx)("button",{onClick:()=>ai(!1),className:"px-3 py-2 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors",children:"Dismiss"})]})]}),(0,b.jsx)("button",{onClick:()=>ai(!1),className:"flex-shrink-0 p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors",children:(0,b.jsx)(G.X,{className:"w-4 h-4"})})]})})})}),(0,b.jsx)(o.AnimatePresence,{children:af&&!af.isConnected&&af.canSend&&1===af.messagesRemaining&&(0,b.jsx)(n.motion.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mb-3 overflow-hidden",children:(0,b.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-700 rounded-lg",children:[(0,b.jsx)(ab.MessageCircle,{className:"w-4 h-4 text-amber-600 dark:text-amber-400 flex-shrink-0"}),(0,b.jsxs)("p",{className:"text-xs text-amber-700 dark:text-amber-300",children:[(0,b.jsx)("span",{className:"font-medium",children:"Last message!"})," Connect with ",q||"this user"," to continue the conversation."]}),(0,b.jsx)("button",{onClick:aC,disabled:aj||al,className:"ml-auto text-xs font-medium text-amber-700 dark:text-amber-300 hover:text-amber-800 dark:hover:text-amber-200 underline disabled:opacity-50",children:al?"Request Sent":"Connect"})]})})}),(0,b.jsx)("input",{ref:ar,type:"file",multiple:!0,onChange:aG,className:"hidden"}),(0,b.jsx)(o.AnimatePresence,{children:L.length>0&&(0,b.jsx)(n.motion.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"mb-3 overflow-hidden",children:(0,b.jsx)("div",{className:"flex gap-2 overflow-x-auto py-2",children:L.map((a,c)=>(0,b.jsxs)("div",{className:"relative flex-shrink-0 w-20 h-20 rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-800 border border-gray-200 dark:border-gray-700",children:["image"===a.type?(0,b.jsx)("img",{src:a.preview,alt:a.file.name,className:"w-full h-full object-cover"}):(0,b.jsxs)("div",{className:"w-full h-full flex flex-col items-center justify-center p-1",children:["video"===a.type&&(0,b.jsx)(J.Video,{className:"w-6 h-6 text-gray-500"}),"document"===a.type&&(0,b.jsx)(I.FileText,{className:"w-6 h-6 text-gray-500"}),"audio"===a.type&&(0,b.jsx)(W,{className:"w-6 h-6 text-gray-500"}),(0,b.jsxs)("span",{className:"text-[10px] text-gray-500 truncate w-full text-center mt-1",children:[a.file.name.slice(0,10),"..."]})]}),(0,b.jsx)("button",{onClick:()=>{M(a=>{let b=[...a];return b[c].preview&&URL.revokeObjectURL(b[c].preview),b.splice(c,1),b})},className:"absolute top-1 right-1 w-5 h-5 bg-red-500 text-white rounded-full flex items-center justify-center hover:bg-red-600",children:(0,b.jsx)(G.X,{className:"w-3 h-3"})})]},c))})})}),i&&(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2 p-2 bg-gray-100 dark:bg-gray-800 rounded-lg",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 min-w-0",children:[(0,b.jsx)("div",{className:"w-1 h-8 bg-blue-500 rounded-full"}),(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsxs)("p",{className:"text-xs text-blue-600 dark:text-blue-400 font-medium",children:["Replying to ",i.senderName]}),(0,b.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 truncate",children:i.content})]})]}),(0,b.jsx)("button",{onClick:j,className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded",children:(0,b.jsx)(G.X,{className:"w-4 h-4"})})]}),(0,b.jsxs)("div",{className:"flex items-end gap-2",children:[(0,b.jsxs)("div",{className:"relative",ref:at,children:[(0,b.jsx)("button",{onClick:()=>C(!B),className:(0,h.cn)("p-2 rounded-full transition-colors",B?"bg-blue-100 dark:bg-blue-900/30 text-blue-600":"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800"),title:"Attach file",children:(0,b.jsx)(V,{className:"w-5 h-5"})}),(0,b.jsx)(o.AnimatePresence,{children:B&&(0,b.jsx)(n.motion.div,{initial:{opacity:0,y:10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.95},className:"absolute bottom-full left-0 mb-2 w-48 bg-white dark:bg-gray-800 shadow-xl rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden z-20",children:(0,b.jsxs)("div",{className:"p-2 space-y-1",children:[(0,b.jsxs)("button",{onClick:()=>aH("image/*"),className:"w-full flex items-center gap-3 px-3 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:[(0,b.jsx)("div",{className:"w-8 h-8 rounded-full bg-purple-100 dark:bg-purple-900/30 flex items-center justify-center",children:(0,b.jsx)(H.Image,{className:"w-4 h-4 text-purple-600"})}),(0,b.jsx)("span",{children:"Photos"})]}),(0,b.jsxs)("button",{onClick:()=>aH("video/*"),className:"w-full flex items-center gap-3 px-3 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:[(0,b.jsx)("div",{className:"w-8 h-8 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center",children:(0,b.jsx)(J.Video,{className:"w-4 h-4 text-red-600"})}),(0,b.jsx)("span",{children:"Videos"})]}),(0,b.jsxs)("button",{onClick:()=>aH(".pdf,.doc,.docx"),className:"w-full flex items-center gap-3 px-3 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:[(0,b.jsx)("div",{className:"w-8 h-8 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center",children:(0,b.jsx)(I.FileText,{className:"w-4 h-4 text-blue-600"})}),(0,b.jsx)("span",{children:"Documents"})]}),(0,b.jsxs)("button",{onClick:()=>{C(!1),aI()},className:"w-full flex items-center gap-3 px-3 py-2 text-left text-sm hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:[(0,b.jsx)("div",{className:"w-8 h-8 rounded-full bg-orange-100 dark:bg-orange-900/30 flex items-center justify-center",children:(0,b.jsx)(W,{className:"w-4 h-4 text-orange-600"})}),(0,b.jsx)("span",{children:"Voice Mail"})]})]})})})]}),p&&(0,b.jsx)("button",{onClick:()=>{E(!D),A(!1),C(!1)},className:(0,h.cn)("p-2 rounded-full transition-colors",D?"bg-gradient-to-br from-purple-100 to-blue-100 dark:from-purple-900/30 dark:to-blue-900/30 text-purple-600":"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800"),title:"AI Assistant",children:(0,b.jsx)($.Sparkles,{className:"w-5 h-5"})}),az.length>0&&(0,b.jsxs)("button",{onClick:()=>{let a=["none",...az];if(a.length<=1)return;let b=a.indexOf(an),c=-1===b?0:(b+1)%a.length;ap(a[c])},className:(0,h.cn)("p-2 rounded-full transition-colors relative","none"!==an?"bg-orange-100 dark:bg-orange-900/30 text-orange-600":"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800"),title:"none"===an?"Message effect: Off (tap to cycle)":`Message effect: ${an} (tap to cycle)`,children:[(0,b.jsx)(ac.Zap,{className:"w-5 h-5"}),"none"!==an&&(0,b.jsx)("span",{className:"absolute -bottom-1.5 left-1/2 -translate-x-1/2 px-1 py-0.5 rounded bg-orange-600 text-white text-[9px] leading-none uppercase tracking-wide",children:"confetti"===an?"C":"F"})]}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("button",{onClick:()=>A(!z),className:(0,h.cn)("p-2 rounded-full transition-colors",z?"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-600":"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800"),title:"Add emoji",children:(0,b.jsx)(Y,{className:"w-5 h-5"})}),(0,b.jsx)(o.AnimatePresence,{children:z&&(0,b.jsx)(n.motion.div,{initial:{opacity:0,y:10,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:10,scale:.95},className:"absolute bottom-full left-0 mb-2 p-3 bg-white dark:bg-gray-800 shadow-xl rounded-xl border border-gray-200 dark:border-gray-700 z-20",children:(0,b.jsx)("div",{className:"grid grid-cols-5 gap-1 w-[200px]",children:["ðŸ˜€","ðŸ˜‚","â¤ï¸","ðŸ‘","ðŸ”¥","ðŸŽ‰","ðŸ˜Š","ðŸ™","ðŸ’¯","âœ¨","ðŸ˜","ðŸ¤”","ðŸ‘€","ðŸ™Œ","ðŸ’ª"].map(a=>(0,b.jsx)("button",{onClick:()=>{w(b=>b+a),A(!1),aq.current?.focus()},className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg text-xl transition-transform hover:scale-110",children:a},a))})})})]}),N?(0,b.jsxs)("div",{className:"flex-1 flex items-center gap-3 px-4 py-2.5 bg-red-50 dark:bg-red-900/20 rounded-2xl",children:[(0,b.jsx)("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}),(0,b.jsx)("span",{className:"text-red-600 dark:text-red-400 font-medium",children:aJ(Q)}),(0,b.jsx)("span",{className:"text-sm text-gray-500 flex-1",children:"Recording..."}),(0,b.jsx)("button",{onClick:()=>{au.current&&au.current.stream.getTracks().forEach(a=>a.stop()),O(!1),T(null),R(0),ay.current&&(clearInterval(ay.current),ay.current=null)},className:"p-2 text-gray-500 hover:text-red-500 hover:bg-red-100 dark:hover:bg-red-900/30 rounded-full transition-colors",title:"Cancel",children:(0,b.jsx)(t.Trash2,{className:"w-5 h-5"})}),(0,b.jsx)("button",{onClick:()=>{au.current&&N&&(au.current.stop(),O(!1),ay.current&&(clearInterval(ay.current),ay.current=null))},className:"p-2 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors",title:"Stop recording",children:(0,b.jsx)(Z,{className:"w-4 h-4"})})]}):S?(0,b.jsxs)("div",{className:"flex-1 flex items-center gap-3 px-4 py-2.5 bg-green-50 dark:bg-green-900/20 rounded-2xl",children:[(0,b.jsx)(W,{className:"w-5 h-5 text-green-600"}),(0,b.jsxs)("span",{className:"text-sm text-green-700 dark:text-green-400 flex-1",children:["Voice message (",aJ(Q),")"]}),(0,b.jsx)("button",{onClick:()=>{T(null),R(0)},className:"p-1.5 text-gray-500 hover:text-red-500 hover:bg-red-100 dark:hover:bg-red-900/30 rounded-full transition-colors",title:"Delete recording",children:(0,b.jsx)(G.X,{className:"w-4 h-4"})})]}):(0,b.jsx)("div",{className:"flex-1 relative",children:(0,b.jsx)("textarea",{ref:aq,value:v,onChange:a=>{w(a.target.value),aD()},onKeyDown:a=>{"Enter"!==a.key||a.shiftKey||(a.preventDefault(),aK())},placeholder:"Type a message...",disabled:k,rows:1,className:(0,h.cn)("w-full resize-none rounded-2xl px-4 py-2.5","bg-gray-100 dark:bg-gray-800","border border-transparent focus:border-blue-500","focus:outline-none focus:ring-2 focus:ring-blue-500/20","text-gray-900 dark:text-white placeholder-gray-500","disabled:opacity-50 disabled:cursor-not-allowed","max-h-32")})}),v.trim()||0!==L.length||S||N?(0,b.jsxs)(b.Fragment,{children:[v.trim()&&p&&(0,b.jsx)("button",{onClick:aL,disabled:F||k,className:(0,h.cn)("p-3 rounded-full transition-all","bg-purple-100 dark:bg-purple-900/30 text-purple-600 hover:bg-purple-200 dark:hover:bg-purple-800/40","disabled:opacity-50 disabled:cursor-not-allowed"),title:"Fix grammar with AI",children:F?(0,b.jsx)(_.Loader2,{className:"w-5 h-5 animate-spin"}):(0,b.jsx)(s.Pencil,{className:"w-5 h-5"})}),(0,b.jsx)("button",{onClick:aK,disabled:!v.trim()&&0===L.length&&!S||k||N,className:(0,h.cn)("p-3 rounded-full transition-all",v.trim()||L.length>0||S?"bg-blue-600 text-white hover:bg-blue-700 scale-100":"bg-gray-200 dark:bg-gray-700 text-gray-400 scale-95","disabled:opacity-50 disabled:cursor-not-allowed"),children:(0,b.jsx)(X.Send,{className:"w-5 h-5"})})]}):(0,b.jsx)("button",{onClick:aI,disabled:k,className:(0,h.cn)("p-3 rounded-full transition-all","bg-gray-200 dark:bg-gray-700 text-gray-500 hover:bg-gray-300 dark:hover:bg-gray-600","disabled:opacity-50 disabled:cursor-not-allowed"),title:"Record voice message",children:(0,b.jsx)(W,{className:"w-5 h-5"})})]})]})}a.s(["default",()=>ay],92368);var az=a.i(38246),aA=a.i(18422),aB=a.i(79360);function aC({user:a,conversationId:d,onBack:e,onInfo:h}){let[i,j]=(0,c.useState)(a.isOnline||!1),[k,l]=(0,c.useState)(a.lastActiveAt),[m,n]=(0,c.useState)(!1),[o,p]=(0,c.useState)(!1),q=(0,c.useRef)(null);return(0,c.useEffect)(()=>{let a=a=>{q.current&&!q.current.contains(a.target)&&n(!1)};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[]),(0,c.useEffect)(()=>{let b=(0,f.getSocket)();if(!b)return;let c=b=>{b.userId===a.id&&j(!0)},d=b=>{b.userId===a.id&&(j(!1),l(new Date().toISOString()))},e=b=>{b.userId===a.id&&(j(b.isOnline),b.isOnline||l(new Date().toISOString()))};return b.on("user:online",c),b.on("user:offline",d),b.on("user:status",e),()=>{b.off("user:online",c),b.off("user:offline",d),b.off("user:status",e)}},[a.id]),(0,c.useEffect)(()=>{j(a.isOnline||!1),l(a.lastActiveAt)},[a.isOnline,a.lastActiveAt]),(0,b.jsxs)("div",{className:"flex items-center gap-3 p-4 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900",children:[e&&(0,b.jsx)("button",{onClick:e,className:"p-2 -ml-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full md:hidden",children:(0,b.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),(0,b.jsxs)(az.default,{href:`/profile/${a.username}`,className:"relative flex-shrink-0",children:[(0,b.jsx)("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center text-white font-semibold",children:a.profileImage?(0,b.jsx)("img",{src:a.profileImage,alt:a.name,className:"w-10 h-10 rounded-full object-cover"}):a.name.charAt(0).toUpperCase()}),i&&(0,b.jsx)("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-white dark:border-gray-900"})]}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)(az.default,{href:`/profile/${a.username}`,className:"font-semibold text-gray-900 dark:text-white hover:underline truncate block",children:a.name}),(0,b.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:i?(0,b.jsx)("span",{className:"text-green-600 dark:text-green-400",children:"Online"}):k?`Last seen ${(0,g.formatDistanceToNow)(new Date(k),{addSuffix:!0})}`:`@${a.username}`})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("button",{className:"p-2 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition-colors",title:"Voice call (coming soon)",disabled:!0,children:(0,b.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})})}),(0,b.jsx)("button",{className:"p-2 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition-colors",title:"Video call (coming soon)",disabled:!0,children:(0,b.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),h&&(0,b.jsx)("button",{onClick:h,className:"p-2 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition-colors",title:"Chat info",children:(0,b.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,b.jsxs)("div",{className:"relative",ref:q,children:[(0,b.jsx)("button",{onClick:()=>n(!m),className:"p-2 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition-colors",title:"More options",children:(0,b.jsx)(aB.MoreVertical,{className:"w-5 h-5"})}),m&&(0,b.jsx)("div",{className:"absolute right-0 top-full mt-1 w-48 py-1 rounded-lg bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 shadow-lg z-50",children:(0,b.jsxs)("button",{onClick:()=>{p(!0),n(!1)},className:"flex items-center gap-2 w-full px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-gray-100 dark:hover:bg-gray-700",children:[(0,b.jsx)(N.Flag,{className:"w-4 h-4"}),"Report User"]})})]})]}),(0,b.jsx)(aA.default,{isOpen:o,onClose:()=>p(!1),type:"chat",targetId:d,targetName:a.name,conversationId:d,reportedUserId:a.id})]})}a.s(["default",()=>aC],46296),a.s([],96331)}];

//# sourceMappingURL=src_components_chat_index_ts_15cedf5b._.js.map