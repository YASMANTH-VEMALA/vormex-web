{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 31, "column": 0}, "map": {"version":3,"sources":["file:///home/yasmanth/Pictures/vormex/vormex-web/src/app/messages/%5BconversationId%5D/page.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useState, use, useCallback } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { useAuth } from '@/lib/auth/useAuth';\nimport { ChatMessages, ChatInput, ChatHeader, type UploadingMessage } from '@/components/chat';\nimport ChatSettingsPanel from '@/components/chat/ChatSettingsPanel';\nimport { getConversation, Conversation } from '@/lib/api/chat';\nimport { initializeSocket } from '@/lib/socket';\n\ninterface ConversationPageProps {\n  params: Promise<{ conversationId: string }>;\n}\n\n// This page only renders the chat area - the layout.tsx handles the sidebar with ChatList\nexport default function ConversationPage({ params }: ConversationPageProps) {\n  const resolvedParams = use(params);\n  const router = useRouter();\n  const { user } = useAuth();\n  const [conversation, setConversation] = useState<Conversation | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [replyTo, setReplyTo] = useState<{ id: string; content: string; senderName: string } | null>(null);\n  const [showSettings, setShowSettings] = useState(false);\n  const [wallpaper, setWallpaper] = useState('default');\n  const [uploadingMessages, setUploadingMessages] = useState<UploadingMessage[]>([]);\n  const [lastReceivedMessage, setLastReceivedMessage] = useState<string>('');\n\n  // Callback to track the last message received from other user\n  const handleLastMessageUpdate = useCallback((message: string) => {\n    setLastReceivedMessage(message);\n  }, []);\n\n  // Load wallpaper preference from localStorage\n  useEffect(() => {\n    if (resolvedParams.conversationId) {\n      const savedWallpaper = localStorage.getItem(`chat_wallpaper_${resolvedParams.conversationId}`);\n      if (savedWallpaper) {\n        setWallpaper(savedWallpaper);\n      } else {\n        setWallpaper('default');\n      }\n    }\n  }, [resolvedParams.conversationId]);\n\n  // Save wallpaper preference\n  const handleWallpaperChange = (newWallpaper: string) => {\n    setWallpaper(newWallpaper);\n    localStorage.setItem(`chat_wallpaper_${resolvedParams.conversationId}`, newWallpaper);\n  };\n\n  // Initialize socket\n  useEffect(() => {\n    if (user?.id) {\n      initializeSocket();\n    }\n  }, [user?.id]);\n\n  // Fetch conversation\n  useEffect(() => {\n    const fetchConversation = async () => {\n      try {\n        setLoading(true);\n        setError(null);\n        const conv = await getConversation(resolvedParams.conversationId);\n        setConversation(conv);\n        // Clear reply and uploading messages when switching conversations\n        setReplyTo(null);\n        setUploadingMessages([]);\n      } catch (err: any) {\n        setError(err.message || 'Failed to load conversation');\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    if (resolvedParams.conversationId && user?.id) {\n      fetchConversation();\n    }\n  }, [resolvedParams.conversationId, user?.id]);\n\n  const handleBack = () => {\n    router.push('/messages');\n  };\n\n  const otherUser = conversation?.otherParticipant;\n\n  // Loading state\n  if (loading) {\n    return (\n      <div className=\"flex-1 flex items-center justify-center\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\n      </div>\n    );\n  }\n\n  // Error state\n  if (error || !conversation || !otherUser) {\n    return (\n      <div className=\"flex-1 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <p className=\"text-red-500 mb-4\">{error || 'Conversation not found'}</p>\n          <button\n            onClick={handleBack}\n            className=\"text-blue-600 hover:underline\"\n          >\n            Go back to messages\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <>\n      <div className=\"flex-1 flex flex-col h-full overflow-hidden\">\n        {/* Chat Header */}\n        <ChatHeader \n          user={otherUser}\n          conversationId={resolvedParams.conversationId}\n          onBack={handleBack}\n          onInfo={() => setShowSettings(true)}\n        />\n\n        {/* Messages */}\n        <ChatMessages\n          key={resolvedParams.conversationId}\n          conversationId={resolvedParams.conversationId}\n          currentUserId={user!.id}\n          otherUser={otherUser}\n          wallpaper={wallpaper}\n          onReply={(msg) => setReplyTo(msg)}\n          uploadingMessages={uploadingMessages}\n          onLastMessageUpdate={handleLastMessageUpdate}\n        />\n\n        {/* Input */}\n        <ChatInput\n          key={`input-${resolvedParams.conversationId}`}\n          conversationId={resolvedParams.conversationId}\n          replyTo={replyTo || undefined}\n          onCancelReply={() => setReplyTo(null)}\n          onUploadingMessagesChange={setUploadingMessages}\n          otherUserId={otherUser.id}\n          otherUserName={otherUser.name}\n          lastReceivedMessage={lastReceivedMessage}\n        />\n      </div>\n\n      {/* Settings Panel */}\n      <ChatSettingsPanel\n        isOpen={showSettings}\n        onClose={() => setShowSettings(false)}\n        conversationId={resolvedParams.conversationId}\n        otherUser={otherUser}\n        currentWallpaper={wallpaper}\n        onWallpaperChange={handleWallpaperChange}\n      />\n    </>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}