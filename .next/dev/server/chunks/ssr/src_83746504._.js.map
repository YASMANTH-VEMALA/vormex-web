{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 31, "column": 0}, "map": {"version":3,"sources":["file:///home/yasmanth/Pictures/vormex/vormex-web/src/lib/api/store.ts"],"sourcesContent":["import apiClient from './client';\n\nexport interface StoreItem {\n  id: string;\n  slug: string;\n  name: string;\n  description?: string;\n  imageUrl?: string;\n  category: string;\n  type: string;\n  xpCost: number;\n  isFeatured?: boolean;\n  metadata?: Record<string, unknown>;\n  isActive: boolean;\n  stock?: number;\n  createdAt?: string;\n  updatedAt?: string;\n}\n\nexport interface StoreCategoryCount {\n  category: string;\n  count: number;\n}\n\nexport interface StorePurchase {\n  id: string;\n  userId: string;\n  itemId: string;\n  item: StoreItem;\n  xpSpent: number;\n  purchasedAt: string;\n}\n\nexport interface UserInventory {\n  id: string;\n  userId: string;\n  itemType: string;\n  itemSlug: string;\n  isEquipped: boolean;\n  acquiredAt: string;\n  item?: StoreItem;\n}\n\n// Get all store items\nexport const getStoreItems = async (category?: string): Promise<StoreItem[]> => {\n  const response = await apiClient.get('/store/items', { params: { category } });\n  return response.data;\n};\n\n// Get store item by slug\nexport const getStoreItem = async (slug: string): Promise<StoreItem> => {\n  const response = await apiClient.get(`/store/items/${slug}`);\n  return response.data;\n};\n\n// Get store categories\nexport const getStoreCategories = async (): Promise<StoreCategoryCount[]> => {\n  const response = await apiClient.get('/store/categories');\n  return response.data;\n};\n\n// Purchase an item\nexport const purchaseItem = async (itemSlug: string) => {\n  const response = await apiClient.post('/store/purchase', { itemSlug });\n  return response;\n};\n\n// Get my inventory\nexport const getMyInventory = async (): Promise<UserInventory[]> => {\n  const response = await apiClient.get('/store/inventory');\n  // Ensure we always return an array, even if backend returns null/undefined\n  return Array.isArray(response.data) ? response.data : [];\n};\n\n// Get my purchase history\nexport const getMyPurchases = async (): Promise<StorePurchase[]> => {\n  const response = await apiClient.get('/store/history');\n  return response.data;\n};\n\n// Activate an item\nexport const activateItem = async (inventoryId: string) => {\n  const response = await apiClient.post(`/store/inventory/${inventoryId}/activate`);\n  return response;\n};\n\n// Get my XP balance\nexport const getXPBalance = async (): Promise<number> => {\n  const response = await apiClient.get('/store/balance');\n  return response.data?.balance ?? response.data ?? 0;\n};\n\n// Get purchase history\nexport const getPurchaseHistory = async (): Promise<StorePurchase[]> => {\n  const response = await apiClient.get('/store/purchases');\n  return response.data;\n};\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;;AA4CO,MAAM,gBAAgB,OAAO;IAClC,MAAM,WAAW,MAAM,sIAAS,CAAC,GAAG,CAAC,gBAAgB;QAAE,QAAQ;YAAE;QAAS;IAAE;IAC5E,OAAO,SAAS,IAAI;AACtB;AAGO,MAAM,eAAe,OAAO;IACjC,MAAM,WAAW,MAAM,sIAAS,CAAC,GAAG,CAAC,CAAC,aAAa,EAAE,MAAM;IAC3D,OAAO,SAAS,IAAI;AACtB;AAGO,MAAM,qBAAqB;IAChC,MAAM,WAAW,MAAM,sIAAS,CAAC,GAAG,CAAC;IACrC,OAAO,SAAS,IAAI;AACtB;AAGO,MAAM,eAAe,OAAO;IACjC,MAAM,WAAW,MAAM,sIAAS,CAAC,IAAI,CAAC,mBAAmB;QAAE;IAAS;IACpE,OAAO;AACT;AAGO,MAAM,iBAAiB;IAC5B,MAAM,WAAW,MAAM,sIAAS,CAAC,GAAG,CAAC;IACrC,2EAA2E;IAC3E,OAAO,MAAM,OAAO,CAAC,SAAS,IAAI,IAAI,SAAS,IAAI,GAAG,EAAE;AAC1D;AAGO,MAAM,iBAAiB;IAC5B,MAAM,WAAW,MAAM,sIAAS,CAAC,GAAG,CAAC;IACrC,OAAO,SAAS,IAAI;AACtB;AAGO,MAAM,eAAe,OAAO;IACjC,MAAM,WAAW,MAAM,sIAAS,CAAC,IAAI,CAAC,CAAC,iBAAiB,EAAE,YAAY,SAAS,CAAC;IAChF,OAAO;AACT;AAGO,MAAM,eAAe;IAC1B,MAAM,WAAW,MAAM,sIAAS,CAAC,GAAG,CAAC;IACrC,OAAO,SAAS,IAAI,EAAE,WAAW,SAAS,IAAI,IAAI;AACpD;AAGO,MAAM,qBAAqB;IAChC,MAAM,WAAW,MAAM,sIAAS,CAAC,GAAG,CAAC;IACrC,OAAO,SAAS,IAAI;AACtB"}},
    {"offset": {"line": 100, "column": 0}, "map": {"version":3,"sources":["file:///home/yasmanth/Pictures/vormex/vormex-web/src/app/messages/%5BconversationId%5D/page.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useState, use, useCallback } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { useAuth } from '@/lib/auth/useAuth';\nimport { ChatMessages, ChatInput, ChatHeader, type UploadingMessage, type OptimisticMessage } from '@/components/chat';\nimport ChatSettingsPanel from '@/components/chat/ChatSettingsPanel';\nimport { getConversation, Conversation } from '@/lib/api/chat';\nimport { initializeSocket } from '@/lib/socket';\nimport * as storeAPI from '@/lib/api/store';\nimport {\n  buildChatCustomizationEntitlements,\n  DEFAULT_CHAT_CUSTOMIZATION_ENTITLEMENTS,\n  isWallpaperUnlocked,\n} from '@/lib/chat/customization';\n\ninterface ConversationPageProps {\n  params: Promise<{ conversationId: string }>;\n}\n\n// This page only renders the chat area - the layout.tsx handles the sidebar with ChatList\nexport default function ConversationPage({ params }: ConversationPageProps) {\n  const resolvedParams = use(params);\n  const router = useRouter();\n  const { user } = useAuth();\n  const [conversation, setConversation] = useState<Conversation | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [replyTo, setReplyTo] = useState<{ id: string; content: string; senderName: string } | null>(null);\n  const [showSettings, setShowSettings] = useState(false);\n  const [wallpaper, setWallpaper] = useState('default');\n  const [uploadingMessages, setUploadingMessages] = useState<UploadingMessage[]>([]);\n  const [optimisticMessages, setOptimisticMessages] = useState<OptimisticMessage[]>([]);\n  const [lastReceivedMessage, setLastReceivedMessage] = useState<string>('');\n  const [chatCustomization, setChatCustomization] = useState(DEFAULT_CHAT_CUSTOMIZATION_ENTITLEMENTS);\n\n  // Callback to track the last message received from other user\n  const handleLastMessageUpdate = useCallback((message: string) => {\n    setLastReceivedMessage(message);\n  }, []);\n\n  // Handle optimistic message - add to list for immediate display\n  const handleOptimisticMessage = useCallback((message: OptimisticMessage) => {\n    setOptimisticMessages(prev => [...prev, message]);\n  }, []);\n\n  // Remove optimistic messages when real messages arrive\n  const handleMessageConfirmed = useCallback((confirmedContent: string) => {\n    // Remove the first optimistic message with matching content\n    setOptimisticMessages(prev => {\n      const idx = prev.findIndex(m => m.content === confirmedContent);\n      if (idx >= 0) {\n        const updated = [...prev];\n        updated.splice(idx, 1);\n        return updated;\n      }\n      return prev;\n    });\n  }, []);\n\n  // Load wallpaper preference from localStorage\n  useEffect(() => {\n    if (resolvedParams.conversationId) {\n      const savedWallpaper = localStorage.getItem(`chat_wallpaper_${resolvedParams.conversationId}`);\n      if (savedWallpaper) {\n        setWallpaper(savedWallpaper);\n      } else {\n        setWallpaper('default');\n      }\n    }\n  }, [resolvedParams.conversationId]);\n\n  // Load purchased chat customization packs from inventory\n  useEffect(() => {\n    const loadChatCustomization = async () => {\n      if (!user?.id) return;\n\n      try {\n        const inventory = await storeAPI.getMyInventory();\n        // Handle case where inventory is undefined or not an array\n        const ownedSlugs = Array.isArray(inventory) ? inventory.map((item) => item.itemSlug) : [];\n        setChatCustomization(buildChatCustomizationEntitlements(ownedSlugs));\n      } catch (error) {\n        console.error('Failed to load chat customization packs:', error);\n        setChatCustomization(DEFAULT_CHAT_CUSTOMIZATION_ENTITLEMENTS);\n      }\n    };\n\n    loadChatCustomization();\n  }, [user?.id]);\n\n  // If current wallpaper is locked and user no longer owns required pack, fallback to default\n  useEffect(() => {\n    if (!isWallpaperUnlocked(wallpaper, chatCustomization.ownedThemePacks)) {\n      setWallpaper('default');\n      localStorage.setItem(`chat_wallpaper_${resolvedParams.conversationId}`, 'default');\n    }\n  }, [wallpaper, chatCustomization.ownedThemePacks, resolvedParams.conversationId]);\n\n  // Save wallpaper preference\n  const handleWallpaperChange = (newWallpaper: string) => {\n    setWallpaper(newWallpaper);\n    localStorage.setItem(`chat_wallpaper_${resolvedParams.conversationId}`, newWallpaper);\n  };\n\n  // Initialize socket\n  useEffect(() => {\n    if (user?.id) {\n      initializeSocket();\n    }\n  }, [user?.id]);\n\n  // Fetch conversation\n  useEffect(() => {\n    const fetchConversation = async () => {\n      try {\n        setLoading(true);\n        setError(null);\n        const conv = await getConversation(resolvedParams.conversationId);\n        setConversation(conv);\n        // Clear reply, uploading and optimistic messages when switching conversations\n        setReplyTo(null);\n        setUploadingMessages([]);\n        setOptimisticMessages([]);\n      } catch (err: unknown) {\n        setError(err instanceof Error ? err.message : 'Failed to load conversation');\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    if (resolvedParams.conversationId && user?.id) {\n      fetchConversation();\n    }\n  }, [resolvedParams.conversationId, user?.id]);\n\n  const handleBack = () => {\n    router.push('/messages');\n  };\n\n  const otherUser = conversation?.otherParticipant;\n\n  // Loading state\n  if (loading) {\n    return (\n      <div className=\"flex-1 flex items-center justify-center\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\n      </div>\n    );\n  }\n\n  // Error state\n  if (error || !conversation || !otherUser) {\n    return (\n      <div className=\"flex-1 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <p className=\"text-red-500 mb-4\">{error || 'Conversation not found'}</p>\n          <button\n            onClick={handleBack}\n            className=\"text-blue-600 hover:underline\"\n          >\n            Go back to messages\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <>\n      <div className=\"flex-1 flex flex-col h-full overflow-hidden\">\n        {/* Chat Header */}\n        <ChatHeader \n          user={otherUser}\n          conversationId={resolvedParams.conversationId}\n          onBack={handleBack}\n          onInfo={() => setShowSettings(true)}\n        />\n\n        {/* Messages */}\n        <ChatMessages\n          key={resolvedParams.conversationId}\n          conversationId={resolvedParams.conversationId}\n          currentUserId={user!.id}\n          otherUser={otherUser}\n          wallpaper={wallpaper}\n          availableReactions={chatCustomization.availableReactions}\n          animatedBubbles={chatCustomization.animatedBubbles}\n          onReply={(msg) => setReplyTo(msg)}\n          uploadingMessages={uploadingMessages}\n          optimisticMessages={optimisticMessages}\n          onLastMessageUpdate={handleLastMessageUpdate}\n          onMessageConfirmed={handleMessageConfirmed}\n        />\n\n        {/* Input */}\n        <ChatInput\n          key={`input-${resolvedParams.conversationId}`}\n          conversationId={resolvedParams.conversationId}\n          currentUserId={user!.id}\n          replyTo={replyTo || undefined}\n          onCancelReply={() => setReplyTo(null)}\n          onUploadingMessagesChange={setUploadingMessages}\n          onOptimisticMessage={handleOptimisticMessage}\n          otherUserId={otherUser.id}\n          otherUserName={otherUser.name}\n          lastReceivedMessage={lastReceivedMessage}\n          enabledMessageEffects={chatCustomization.messageEffects}\n        />\n      </div>\n\n      {/* Settings Panel */}\n      <ChatSettingsPanel\n        key={`settings-${resolvedParams.conversationId}`}\n        isOpen={showSettings}\n        onClose={() => setShowSettings(false)}\n        conversationId={resolvedParams.conversationId}\n        otherUser={otherUser}\n        currentWallpaper={wallpaper}\n        onWallpaperChange={handleWallpaperChange}\n        ownedThemePacks={chatCustomization.ownedThemePacks}\n        onOpenStore={() => router.push('/store')}\n      />\n    </>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}