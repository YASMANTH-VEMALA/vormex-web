(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,7794,e=>{"use strict";var t=e.i(61238);let a=async e=>(await t.default.get("/store/items",{params:{category:e}})).data,s=async e=>await t.default.post("/store/purchase",{itemSlug:e}),n=async()=>{let e=await t.default.get("/store/inventory");return Array.isArray(e.data)?e.data:[]},o=async()=>(await t.default.get("/store/history")).data,r=async()=>{let e=await t.default.get("/store/balance");return e.data?.balance??e.data??0};e.s(["getMyInventory",0,n,"getMyPurchases",0,o,"getStoreItems",0,a,"getXPBalance",0,r,"purchaseItem",0,s])},82556,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(18566),n=e.i(52962);e.i(81174);var o=e.i(55306),o=o,r=e.i(19684),r=r,i=e.i(68527),i=i,l=e.i(21790),c=e.i(22651),d=e.i(13751),u=e.i(7794),f=e.i(44171);function m({params:e}){let m=(0,a.use)(e),v=(0,s.useRouter)(),{user:p}=(0,n.useAuth)(),[h,I]=(0,a.useState)(null),[g,y]=(0,a.useState)(!0),[b,x]=(0,a.useState)(null),[T,S]=(0,a.useState)(null),[C,w]=(0,a.useState)(!1),[E,j]=(0,a.useState)("default"),[M,U]=(0,a.useState)([]),[N,k]=(0,a.useState)([]),[A,_]=(0,a.useState)(""),[O,P]=(0,a.useState)(f.DEFAULT_CHAT_CUSTOMIZATION_ENTITLEMENTS),R=(0,a.useCallback)(e=>{_(e)},[]),B=(0,a.useCallback)(e=>{k(t=>[...t,e])},[]),F=(0,a.useCallback)(e=>{k(t=>{let a=t.findIndex(t=>t.content===e);if(a>=0){let e=[...t];return e.splice(a,1),e}return t})},[]);(0,a.useEffect)(()=>{if(m.conversationId){let e=localStorage.getItem(`chat_wallpaper_${m.conversationId}`);e?j(e):j("default")}},[m.conversationId]),(0,a.useEffect)(()=>{(async()=>{if(p?.id)try{let e=await u.getMyInventory(),t=Array.isArray(e)?e.map(e=>e.itemSlug):[];P((0,f.buildChatCustomizationEntitlements)(t))}catch(e){console.error("Failed to load chat customization packs:",e),P(f.DEFAULT_CHAT_CUSTOMIZATION_ENTITLEMENTS)}})()},[p?.id]),(0,a.useEffect)(()=>{(0,f.isWallpaperUnlocked)(E,O.ownedThemePacks)||(j("default"),localStorage.setItem(`chat_wallpaper_${m.conversationId}`,"default"))},[E,O.ownedThemePacks,m.conversationId]),(0,a.useEffect)(()=>{p?.id&&(0,d.initializeSocket)()},[p?.id]),(0,a.useEffect)(()=>{let e=async()=>{try{y(!0),x(null);let e=await (0,c.getConversation)(m.conversationId);I(e),S(null),U([]),k([])}catch(e){x(e instanceof Error?e.message:"Failed to load conversation")}finally{y(!1)}};m.conversationId&&p?.id&&e()},[m.conversationId,p?.id]);let L=()=>{v.push("/messages")},$=h?.otherParticipant;return g?(0,t.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):!b&&h&&$?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex-1 flex flex-col h-full overflow-hidden",children:[(0,t.jsx)(i.default,{user:$,conversationId:m.conversationId,onBack:L,onInfo:()=>w(!0)}),(0,t.jsx)(o.default,{conversationId:m.conversationId,currentUserId:p.id,otherUser:$,wallpaper:E,availableReactions:O.availableReactions,animatedBubbles:O.animatedBubbles,onReply:e=>S(e),uploadingMessages:M,optimisticMessages:N,onLastMessageUpdate:R,onMessageConfirmed:F},m.conversationId),(0,t.jsx)(r.default,{conversationId:m.conversationId,currentUserId:p.id,replyTo:T||void 0,onCancelReply:()=>S(null),onUploadingMessagesChange:U,onOptimisticMessage:B,otherUserId:$.id,otherUserName:$.name,lastReceivedMessage:A,enabledMessageEffects:O.messageEffects},`input-${m.conversationId}`)]}),(0,t.jsx)(l.default,{isOpen:C,onClose:()=>w(!1),conversationId:m.conversationId,otherUser:$,currentWallpaper:E,onWallpaperChange:e=>{j(e),localStorage.setItem(`chat_wallpaper_${m.conversationId}`,e)},ownedThemePacks:O.ownedThemePacks,onOpenStore:()=>v.push("/store")},`settings-${m.conversationId}`)]}):(0,t.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("p",{className:"text-red-500 mb-4",children:b||"Conversation not found"}),(0,t.jsx)("button",{onClick:L,className:"text-blue-600 hover:underline",children:"Go back to messages"})]})})}e.s(["default",()=>m],82556)}]);