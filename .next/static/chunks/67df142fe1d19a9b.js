(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,53070,e=>{"use strict";var t=e.i(43476),o=e.i(932),i=e.i(71645),r=e.i(18566),s=e.i(28352),a=e.i(931),n=e.i(32409),l=e.i(75298);function c(){let e=(0,r.useRouter)(),o=(0,r.useSearchParams)(),{setAuth:c}=(0,a.useAuthContext)(),[h,m]=(0,i.useState)(null),[d,g]=(0,i.useState)(!0);return(0,i.useEffect)(()=>{(async()=>{try{let t=o.get("code"),i=o.get("state"),r=o.get("error");if(r){m(`Google OAuth error: ${r}`),g(!1),setTimeout(()=>e.push("/login"),3e3);return}let a=sessionStorage.getItem("oauth_state");if(!i||i!==a){m("Invalid state parameter. Please try again."),g(!1),sessionStorage.removeItem("oauth_state"),sessionStorage.removeItem("oauth_code_verifier"),setTimeout(()=>e.push("/login"),3e3);return}if(!t){m("Authorization code not found. Please try again."),g(!1),sessionStorage.removeItem("oauth_state"),sessionStorage.removeItem("oauth_code_verifier"),setTimeout(()=>e.push("/login"),3e3);return}let l=`${window.location.origin}/auth/google/callback`,h=sessionStorage.getItem("oauth_code_verifier");if(!h)throw Error("Code verifier not found. Please try signing in again.");let d=await fetch("/api/auth/google/callback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:t,codeVerifier:h,redirectUri:l})});if(!d.ok){let e=await d.json().catch(()=>({}));throw Error(e.error||e.error_description||"Failed to exchange authorization code")}let u=(await d.json()).idToken;if(!u)throw Error("ID token not found in token response");let p=await s.authAPI.googleSignIn(u);c(p),(0,n.setPendingUser)(p.user),sessionStorage.removeItem("oauth_state"),sessionStorage.removeItem("oauth_code_verifier"),window.location.replace("/")}catch(t){console.error("Google OAuth callback error:",t),m((0,l.handleApiError)(t)),g(!1),sessionStorage.removeItem("oauth_state"),sessionStorage.removeItem("oauth_code_verifier"),setTimeout(()=>e.push("/login"),3e3)}})()},[o,e,c]),(0,t.jsx)("div",{className:"auth-page-wrapper",children:(0,t.jsx)("div",{className:"main",style:{maxWidth:"500px",width:"100%"},children:(0,t.jsxs)("div",{className:"form",children:[(0,t.jsx)("h2",{className:"form_title title",children:"Signing in with Google..."}),d&&(0,t.jsx)("p",{className:"description",style:{marginTop:"20px"},children:"Please wait while we complete your sign-in."}),h&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"error-message",style:{marginTop:"20px"},children:h}),(0,t.jsx)("p",{className:"description",style:{marginTop:"10px"},children:"Redirecting to login page..."})]})]})})})}function h(){let e,r,s,a=(0,o.c)(3);return a[0]===Symbol.for("react.memo_cache_sentinel")?(e={maxWidth:"500px",width:"100%"},a[0]=e):e=a[0],a[1]===Symbol.for("react.memo_cache_sentinel")?(r=(0,t.jsx)("h2",{className:"form_title title",children:"Signing in with Google..."}),a[1]=r):r=a[1],a[2]===Symbol.for("react.memo_cache_sentinel")?(s=(0,t.jsx)(i.Suspense,{fallback:(0,t.jsx)("div",{className:"auth-page-wrapper",children:(0,t.jsx)("div",{className:"main",style:e,children:(0,t.jsxs)("div",{className:"form",children:[r,(0,t.jsx)("p",{className:"description",style:{marginTop:"20px"},children:"Loading..."})]})})}),children:(0,t.jsx)(c,{})}),a[2]=s):s=a[2],s}e.s(["default",()=>h])}]);